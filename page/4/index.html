<!DOCTYPE html>
<html lang=zh>
<head>
    <meta charset="utf-8">
    
    <title>code dog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="什么鬼...">
<meta property="og:type" content="website">
<meta property="og:title" content="code dog">
<meta property="og:url" content="http://xxyxpy.pub/page/4/index.html">
<meta property="og:site_name" content="code dog">
<meta property="og:description" content="什么鬼...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="code dog">
<meta name="twitter:description" content="什么鬼...">
    

    
        <link rel="alternate" href="/" title="code dog" type="application/atom+xml" />
    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    
    


</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">code dog</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
                    <a class="main-nav-link" href="/categories">Categories</a>
                
                    <a class="main-nav-link" href="/tags">Tags</a>
                
                    <a class="main-nav-link" href="https://github.com/xxyxpy/boot-my">Boot</a>
                
                    <a class="main-nav-link" href="/about">About</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/css/images/avatar.png" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="想要查找什么..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                    <td><a class="main-nav-link" href="/categories">Categories</a></td>
                
                    <td><a class="main-nav-link" href="/tags">Tags</a></td>
                
                    <td><a class="main-nav-link" href="https://github.com/xxyxpy/boot-my">Boot</a></td>
                
                    <td><a class="main-nav-link" href="/about">About</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/css/images/avatar.png" />
            <h2 id="name">xxyxpy</h2>
            <h3 id="title">代码狗</h3>
            <span id="location"><i class="fa fa-map-marker"></i>苏州</span>
            <a id="follow" target="_blank" href="https://github.com/xxyxpy/">关注我</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                48
                <span>文章</span>
            </div>
            <div class="article-info-block">
                41
                <span>标签</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="http://github.com/xxyxpy/" target="_blank" title="github" class=tooltip>
                            <i class="fa fa-github"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="twitter" class=tooltip>
                            <i class="fa fa-twitter"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="facebook" class=tooltip>
                            <i class="fa fa-facebook"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="dribbble" class=tooltip>
                            <i class="fa fa-dribbble"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="rss" class=tooltip>
                            <i class="fa fa-rss"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main">
    <article id="post-java/hibernate/hibernate-01入门和单表使用" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/08/04/java/hibernate/hibernate-01入门和单表使用/">hibernate-01入门和单表使用</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/08/04/java/hibernate/hibernate-01入门和单表使用/">
            <time datetime="2017-08-04T02:42:53.957Z" itemprop="datePublished">2017-08-04</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/java/">java</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/java/ssh/">ssh</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/java/ssh/hibernate/">hibernate</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/hiberante/">hiberante</a>, <a class="tag-link" href="/tags/java/">java</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h3 id="hibernate框架概述"><a href="#hibernate框架概述" class="headerlink" title="hibernate框架概述"></a>hibernate框架概述</h3><p>Hibernate是一个开放源代码的对象关系映射（ORM）框架，它对JDBC进行了非常轻量级的对象封装，使得Java程序员可以随心所欲的使用对象编程思维来操纵数据库。可以应用在任何使用JDBC的场合，既可以在Java的客户端程序使用，也可以在Servlet/JSP的Web应用中使用。</p>
<p>Hibernate能使程序员通过操作对象来操作数据库表记录。</p>
<h4 id="什么是ORM"><a href="#什么是ORM" class="headerlink" title="什么是ORM"></a>什么是ORM</h4><p>ORM即对象关系映射（Object Relational Mapping）</p>
<ul>
<li>O：面向对象领域的Object（JavaBean对象）</li>
<li>R：关系数据库领域的Relational（表结构）</li>
<li>M：映射Mapping（xml的配置文件）</li>
</ul>
<h4 id="Hibernate的优点"><a href="#Hibernate的优点" class="headerlink" title="Hibernate的优点"></a>Hibernate的优点</h4><ul>
<li>对jdbc访问数据库的代码做了封装，大大简化了数据访问层繁琐的重复性代码</li>
<li>是基于jdbc的主流持久化框架，是一个优秀的orm实现，它很大程度简化了dao层编码工作</li>
<li>轻量级框架并且性能好。映射的灵活性很出色。支持多种数据库和多种（一对多，多对多）映射关系。</li>
</ul>
<h3 id="入门案例"><a href="#入门案例" class="headerlink" title="入门案例"></a>入门案例</h3><h4 id="下载hibernate5运行环境"><a href="#下载hibernate5运行环境" class="headerlink" title="下载hibernate5运行环境"></a>下载hibernate5运行环境</h4><p><a href="https://sourceforge.net/projects/hibernate/files/hibernate-orm/5.0.7.Final/hibernate-release-5.0.7.Final.zip/download" target="_blank" rel="external">hibernate5-5.0.7final</a></p>
<p>度盘（链接: <a href="http://pan.baidu.com/s/1slHg2Ep" target="_blank" rel="external">http://pan.baidu.com/s/1slHg2Ep</a> 密码: nuj1）</p>
<h4 id="建cst-customer表"><a href="#建cst-customer表" class="headerlink" title="建cst_customer表"></a>建cst_customer表</h4><p>基于mysql数据库创建的表，可以自己创建相应的数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">CREATE TABLE `cst_customer` (</div><div class="line">  `cust_id` bigint(32) NOT NULL AUTO_INCREMENT COMMENT &apos;客户编号(主键)&apos;,</div><div class="line">  `cust_name` varchar(32) NOT NULL COMMENT &apos;客户名称(公司名称)&apos;,</div><div class="line">  `cust_user_id` bigint(32) DEFAULT NULL COMMENT &apos;负责人id&apos;,</div><div class="line">  `cust_create_id` bigint(32) DEFAULT NULL COMMENT &apos;创建人id&apos;,</div><div class="line">  `cust_source` varchar(32) DEFAULT NULL COMMENT &apos;客户信息来源&apos;,</div><div class="line">  `cust_industry` varchar(32) DEFAULT NULL COMMENT &apos;客户所属行业&apos;,</div><div class="line">  `cust_level` varchar(32) DEFAULT NULL COMMENT &apos;客户级别&apos;,</div><div class="line">  `cust_linkman` varchar(64) DEFAULT NULL COMMENT &apos;联系人&apos;,</div><div class="line">  `cust_phone` varchar(64) DEFAULT NULL COMMENT &apos;固定电话&apos;,</div><div class="line">  `cust_mobile` varchar(16) DEFAULT NULL COMMENT &apos;移动电话&apos;,</div><div class="line">  PRIMARY KEY (`cust_id`)</div><div class="line">) ENGINE=InnoDB AUTO_INCREMENT=94 DEFAULT CHARSET=utf8;</div></pre></td></tr></table></figure>
<h4 id="搭建hibernate开发环境"><a href="#搭建hibernate开发环境" class="headerlink" title="搭建hibernate开发环境"></a>搭建hibernate开发环境</h4><ul>
<li>创建web工程</li>
<li>引入mysql的驱动包jar（链接: <a href="http://pan.baidu.com/s/1nuEW3Rb" target="_blank" rel="external">http://pan.baidu.com/s/1nuEW3Rb</a> 密码: 8tp8）</li>
<li>引入hibernate开发需要的jar（hibernate-release-5.0.7.Final/lib/required目录下所有jar包）</li>
<li>日志jar包（链接: <a href="http://pan.baidu.com/s/1jI65xpc" target="_blank" rel="external">http://pan.baidu.com/s/1jI65xpc</a> 密码: msvk）</li>
</ul>
<h4 id="编写JavaBean类"><a href="#编写JavaBean类" class="headerlink" title="编写JavaBean类"></a>编写JavaBean类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.HashSet;</div><div class="line"><span class="keyword">import</span> java.util.Set;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Long cust_id;</div><div class="line">    <span class="keyword">private</span> String cust_name;</div><div class="line">    <span class="keyword">private</span> Long cust_user_id;</div><div class="line">    <span class="keyword">private</span> Long cust_create_id;</div><div class="line">    <span class="keyword">private</span> String cust_source;</div><div class="line">    <span class="keyword">private</span> String cust_industry;</div><div class="line">    <span class="keyword">private</span> String cust_level;</div><div class="line">    <span class="keyword">private</span> String cust_linkman;</div><div class="line">    <span class="keyword">private</span> String cust_phone;</div><div class="line">    <span class="keyword">private</span> String cust_mobile;</div><div class="line">    </div><div class="line">    生成get，set方法。省略此部分代码</div><div class="line">    </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"Customer&#123;"</span> +</div><div class="line">                <span class="string">"cust_id="</span> + cust_id +</div><div class="line">                <span class="string">", cust_name='"</span> + cust_name + <span class="string">'\''</span> +</div><div class="line">                <span class="string">", cust_user_id="</span> + cust_user_id +</div><div class="line">                <span class="string">", cust_create_id="</span> + cust_create_id +</div><div class="line">                <span class="string">", cust_source='"</span> + cust_source + <span class="string">'\''</span> +</div><div class="line">                <span class="string">", cust_industry='"</span> + cust_industry + <span class="string">'\''</span> +</div><div class="line">                <span class="string">", cust_level='"</span> + cust_level + <span class="string">'\''</span> +</div><div class="line">                <span class="string">", cust_linkman='"</span> + cust_linkman + <span class="string">'\''</span> +</div><div class="line">                <span class="string">", cust_phone='"</span> + cust_phone + <span class="string">'\''</span> +</div><div class="line">                <span class="string">", cust_mobile='"</span> + cust_mobile + <span class="string">'\''</span> +</div><div class="line">                <span class="string">'&#125;'</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="创建映射文件"><a href="#创建映射文件" class="headerlink" title="创建映射文件"></a>创建映射文件</h4><p>一般映射文件的命名为<code>实体名.hbm.xml</code>，并且放在JavaBean的包下面。</p>
<ul>
<li>&lt;class&gt; 标签 用来将类与数据库表建立映射关系<ul>
<li>name 类的全路径</li>
<li>table 表名（如果类名与表名相同可以省略不配置）</li>
<li>catalog 数据库名称，因为在连接字符串中已经配置所以一般都省略不写</li>
<li>可选配置dynamic-insert和dynamic-update，动态插入和更新，默认值是false。表示在执行插入和更新时对于null值的字段是否执行插入或更新操作</li>
</ul>
</li>
<li><p>&lt;id&gt;标签 用来将类中的属性与表中的主键建立映射      </p>
<ul>
<li>name 类中的属性名</li>
<li>column 表中的字段名（如果属性名和字段名相同可以省略不配置）</li>
<li>length字段的长度。如果表已存在可不指定，如果表不存在需要由hibernate生成表结构，最好指定，否则使用hibernate默认值 </li>
<li>generator指主键的<a href="http://blog.csdn.net/itmyhome1990/article/details/54863822" target="_blank" rel="external">生成策略</a>  <a href="http://www.cnblogs.com/flyoung2008/articles/2165759.html" target="_blank" rel="external">生成策略2</a><blockquote>
<ul>
<li>assigned 由程序员负责生成，在save之前必须设置值</li>
<li>sequence 采用数据库提供的sequence机制生成主键，比如oracle数据库</li>
<li>identity由数据库自己生成的自增主键，比如sqlserver、mysql等数据库</li>
<li>native 框架根据数据库自动判断支持的策略，从identity、sequence和hilo中选择一个</li>
<li>uuid 使用guid作为主建</li>
<li>increment 由hibernate在内存中生成主键，每次增量为1。由于是hibernate生成所以只能有一个hibernate应用进程访问数据库，否则就产生主建冲突，不能在集群情况下使用</li>
</ul>
</blockquote>
</li>
</ul>
</li>
<li><p>&lt;property&gt;标签 用来将类中的普通属性与表中的字段建立映射</p>
<ul>
<li>name 类中的属性名</li>
<li>column 表中的字段名（同样的如果属性名与字段名相同可以省略不配置）</li>
<li>length 数据的长度，一般不配置</li>
<li>type 数据类型，不般不配置</li>
</ul>
</li>
</ul>
   <figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version='1.0' encoding='UTF-8'?&gt;</div><div class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC</span></div><div class="line">        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</div><div class="line">        "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</div><div class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 配置类和表结构的映射 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"com.domain.Customer"</span> <span class="attr">table</span>=<span class="string">"cst_customer"</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- 配置id </span></div><div class="line">			见到name属性，JavaBean的属性</div><div class="line">			见到column属性，是表结构的字段</div><div class="line">		--&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"cust_id"</span> <span class="attr">column</span>=<span class="string">"cust_id"</span>&gt;</span></div><div class="line">            <span class="comment">&lt;!-- 主键的生成策略 --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- 配置其他的属性 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_name"</span> <span class="attr">column</span>=<span class="string">"cust_name"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_user_id"</span> <span class="attr">column</span>=<span class="string">"cust_user_id"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_create_id"</span> <span class="attr">column</span>=<span class="string">"cust_create_id"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_source"</span> <span class="attr">column</span>=<span class="string">"cust_source"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_industry"</span> <span class="attr">column</span>=<span class="string">"cust_industry"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_level"</span> <span class="attr">column</span>=<span class="string">"cust_level"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_linkman"</span> <span class="attr">column</span>=<span class="string">"cust_linkman"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_phone"</span> <span class="attr">column</span>=<span class="string">"cust_phone"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_mobile"</span> <span class="attr">column</span>=<span class="string">"cust_mobile"</span>/&gt;</span></div><div class="line">        </div><div class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="hibernate核心配置文件"><a href="#hibernate核心配置文件" class="headerlink" title="hibernate核心配置文件"></a>hibernate核心配置文件</h4><p>需要在src目录下面进行创建。</p>
<p>有两种方式去实现配置，一种是通过properties文件配置。这种方式下需要手动加载映射配置文件，然后读取其中的内容。比较麻烦。一般使用另外一种即xml文件的方式，此种方式下可以自动加载映射的配置文件。</p>
<ul>
<li>数据库连接（必须配置）</li>
<li>数据库方言，指定哪种数据库（必须配置）</li>
<li>是否显示语句，是否格式化语句，是否自动更新等（可选配置）</li>
<li>引入映射配置文件</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version='1.0' encoding='UTF-8'?&gt;</div><div class="line"><span class="meta">&lt;!DOCTYPE hibernate-configuration PUBLIC</span></div><div class="line">        "-//Hibernate/Hibernate Configuration DTD 3.0//EN"</div><div class="line">        "http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"&gt;</div><div class="line"><span class="tag">&lt;<span class="name">hibernate-configuration</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 先配置SessionFactory标签，一个数据库对应一个SessionFactory标签 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">session-factory</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/mytest?useUnicode=true&amp;amp;characterEncoding=UTF-8&amp;amp;useSSL=false<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.username"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.password"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="comment">&lt;!-- 数据库的方言 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="comment">&lt;!-- 可选配置 --&gt;</span></div><div class="line">        <span class="comment">&lt;!-- 显示SQL语句，在控制台显示 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.show_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- 格式化SQL语句 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.format_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!--生成表结构--&gt;</span></div><div class="line">        <span class="comment">&lt;!--&lt;property name="hibernate.hbm2ddl.auto"&gt;create&lt;/property&gt;--&gt;</span></div><div class="line">        <span class="comment">&lt;!--更新表结构--&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">        </div><div class="line">        <span class="comment">&lt;!-- 映射配置文件，需要引入映射的配置文件 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"com/domain/Customer.hbm.xml"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">session-factory</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">hibernate-configuration</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h4><p>这里使用junit进行测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test1</span> </span>&#123;</div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSave</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">//读取hibernate.cfg.xml文件</span></div><div class="line">        Configuration cfg = <span class="keyword">new</span> Configuration();</div><div class="line">        cfg.configure();</div><div class="line">        </div><div class="line">        <span class="comment">//如果cfg文件中没配置mapping需要自己手动加载配置文件</span></div><div class="line">        <span class="comment">//cfg.addResource("com/domain/Customer.hbm.xml")</span></div><div class="line">        <span class="comment">//创建sessionFactory</span></div><div class="line">        SessionFactory factory = cfg.buildSessionFactory();</div><div class="line">        <span class="comment">//取得session</span></div><div class="line">        Session session = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="comment">//开启session</span></div><div class="line">            session = factory.openSession();</div><div class="line">            <span class="comment">//开启事务</span></div><div class="line">            Transaction tr = session.beginTransaction();</div><div class="line">            Customer c = <span class="keyword">new</span> Customer();</div><div class="line">            c.setCust_name(<span class="string">"测试"</span>);</div><div class="line">            c.setCust_level(<span class="string">"1"</span>);</div><div class="line">            c.setCust_phone(<span class="string">"110"</span>);</div><div class="line">            <span class="comment">//保存数据</span></div><div class="line">            session.save(c);</div><div class="line">            <span class="comment">//提交事务</span></div><div class="line">            tr.commit();</div><div class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125; <span class="keyword">finally</span> &#123;</div><div class="line">            <span class="comment">//释放资源</span></div><div class="line">            <span class="keyword">if</span> (session != <span class="keyword">null</span>) &#123;</div><div class="line">                session.close();</div><div class="line">            &#125;</div><div class="line">            factory.close();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="hibernate常用的接口和类"><a href="#hibernate常用的接口和类" class="headerlink" title="hibernate常用的接口和类"></a>hibernate常用的接口和类</h3><h4 id="Configuration类"><a href="#Configuration类" class="headerlink" title="Configuration类"></a>Configuration类</h4><p>用于配置并启动Hibernate，hibernate通过该对象来获得对象-关系映射文件中的元数据以及动态配置的hibernate属性，然后创建SessionFactory对象。</p>
<p>加载映射文件的方式根据核心配置文件配置的格式不同而不同，这里只说最常用的使用xml配置核心配置文件时的加载方式。使用<code>Configuration configuration = new Configuration().configure();</code>即可完成配置的加载。调用configure()方法时要求核心</p>
<h4 id="SessionFactory类"><a href="#SessionFactory类" class="headerlink" title="SessionFactory类"></a>SessionFactory类</h4><p>是一个工厂类，用于生成Session对象。一般在应用启动时初始化完成。</p>
<h5 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h5><ul>
<li><p>由Configuration通过加载配置文件创建该对象</p>
</li>
<li><p>SessionFactory对象中保存了当前的数据库配置信息和所有的映射关系以及预定义的sql语句。同时还负责维护Hibernate的二级缓存</p>
<blockquote>
<p>关于预定义的sql语句</p>
<ul>
<li>使用Configuration类创建SessionFactory对象时已经在此对象中缓存了一些sql语句</li>
<li>常见的缓存语句有通过主键执行的crud操作</li>
<li>这样实现的目的是为了效率更高</li>
</ul>
</blockquote>
</li>
<li><p>一个SessionFactory即对应一个数据库，应该用从该对象中获得Session实例</p>
</li>
<li><p>SessionFactory是线程安全的，它的一个实现可以被应用的多线程共享</p>
</li>
<li><p>SessionFactory重量级的，不能随意的创建或销毁它的实例</p>
</li>
<li><p>SessionFactory需要一个较大的缓存，用来存放预定义的sql语句及实体的映射信息。另外可以配置一个缓存插件，这个插件被称之为hibernate的二级缓存，被多线程所共享</p>
</li>
</ul>
<h5 id="工具类"><a href="#工具类" class="headerlink" title="工具类"></a>工具类</h5><p>由于SessionFactory如此的重，所以不能每次调用都创建一次。抽取一个工具类<code>HibernateUtils</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> org.hibernate.Session;</div><div class="line"><span class="keyword">import</span> org.hibernate.SessionFactory;</div><div class="line"><span class="keyword">import</span> org.hibernate.cfg.Configuration;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HibernateUtils</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Configuration CONFIG;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> SessionFactory FACTORY;</div><div class="line">    <span class="keyword">static</span> &#123;</div><div class="line">        CONFIG = <span class="keyword">new</span> Configuration().configure();</div><div class="line">        FACTORY = CONFIG.buildSessionFactory();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Session <span class="title">openSession</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> FACTORY.openSession();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 从ThreadLocal实例中获取当前线程的session</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Session <span class="title">getCurrentSession</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> FACTORY.getCurrentSession();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>测试一下调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSave2</span><span class="params">()</span> </span>&#123;</div><div class="line">  Session session = HibernateUtils.openSession();</div><div class="line">  Transaction transaction = session.beginTransaction();</div><div class="line">  Customer c = <span class="keyword">new</span> Customer();</div><div class="line">  c.setCust_name(<span class="string">"aaaa"</span>);</div><div class="line">  session.save(c);</div><div class="line">  transaction.commit();</div><div class="line">  session.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Session接口"><a href="#Session接口" class="headerlink" title="Session接口"></a>Session接口</h4><h5 id="特点-1"><a href="#特点-1" class="headerlink" title="特点"></a>特点</h5><ul>
<li>是在hibernate中最常用的接口，也被称为持久化管理器。它提供了和持久化相关的操作。比如crud，加载和查询实例对象</li>
<li>Session是应用程序与数据库之间交互操作的一个单线程对象。是hibernate的运作中心</li>
<li>Session不是线程安全的，避免多个线程使用同一个Session</li>
<li>所有的持久化对象必须在session的管理下才可以进行持久化操作</li>
<li>Session对象有一个一级缓存，显示的执行flush之前所有的持久化操作的数据都缓存在Session对象中。每个实例都有自己的一级缓存</li>
<li>轻量级，创建和销毁不消耗资源，每次请求都分配独立的Session实例</li>
<li>持久化类与Session关联起来后就具有了持久化的能力</li>
</ul>
<h5 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h5><ul>
<li>save(obj)</li>
<li>delete(obj)</li>
<li>get(class,id)</li>
<li>update(obj)</li>
<li>saveOrUpdate(obj)</li>
<li>createQuery()</li>
</ul>
<h4 id="Transaction接口"><a href="#Transaction接口" class="headerlink" title="Transaction接口"></a>Transaction接口</h4><p>事务的接口。常用的方法有commit和rollback</p>
<h5 id="特点-2"><a href="#特点-2" class="headerlink" title="特点"></a>特点</h5><ul>
<li>hibernate默认情况下事务不自动提交，需要自己手动提交</li>
<li>如果没有开启事务，那么每一个Session操作都是独立的一个事务</li>
</ul>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://xxyxpy.pub/2017/08/04/java/hibernate/hibernate-01入门和单表使用/" data-id="cjblrl7dw002yqwhqzapq6j5e" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-java/web/web-06Listener,Filter" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/08/03/java/web/web-06Listener,Filter/">web-06Listener,Filter</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/08/03/java/web/web-06Listener,Filter/">
            <time datetime="2017-08-03T06:01:49.325Z" itemprop="datePublished">2017-08-03</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/java/">java</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/java/web/">web</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/filter/">filter</a>, <a class="tag-link" href="/tags/java/">java</a>, <a class="tag-link" href="/tags/listener/">listener</a>, <a class="tag-link" href="/tags/web/">web</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h3 id="Listener"><a href="#Listener" class="headerlink" title="Listener"></a>Listener</h3><p>一般自定义的Listener使用的比较少。</p>
<h4 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h4><p>监听web服务器中域对象ServletContext、ServletRequest、HttpSession。比如spring的监听器ContextLoaderListener可以在web应用程序启动时自动的实例化配置的bean对象。</p>
<h4 id="监听内容"><a href="#监听内容" class="headerlink" title="监听内容"></a>监听内容</h4><ul>
<li>监听三个对象的创建和销毁；</li>
<li>监听三个对象属性的变化；</li>
<li>监听session中的JavaBean的状态。</li>
</ul>
<h4 id="常用的接口"><a href="#常用的接口" class="headerlink" title="常用的接口"></a>常用的接口</h4><h5 id="监听三个对象的创建和销毁"><a href="#监听三个对象的创建和销毁" class="headerlink" title="监听三个对象的创建和销毁"></a>监听三个对象的创建和销毁</h5><ul>
<li>ServletContextListener</li>
<li>ServletRequestListener</li>
<li>HttpSessionListener</li>
</ul>
<h5 id="监听三个对象属性的变化"><a href="#监听三个对象属性的变化" class="headerlink" title="监听三个对象属性的变化"></a>监听三个对象属性的变化</h5><ul>
<li>ServletContextAttributeListener</li>
<li>ServletRequestAttributeListener</li>
<li>HttpSessionAttributeListener</li>
</ul>
<h5 id="监听session中的JavaBean的状态"><a href="#监听session中的JavaBean的状态" class="headerlink" title="监听session中的JavaBean的状态"></a>监听session中的JavaBean的状态</h5><ul>
<li>HttpSessionActivationListener(钝化和活化)</li>
<li>HttpSessionBindingListener(绑定和解绑)</li>
</ul>
<h4 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h4><ol>
<li>编写一个类实现要相应的接口</li>
<li>实现接口中的方法</li>
<li>在web.xml中编写配置文件</li>
</ol>
<h4 id="监听ServletContext"><a href="#监听ServletContext" class="headerlink" title="监听ServletContext"></a>监听ServletContext</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 服务器启动时为每个项目创建(init)</div><div class="line"> * 在正常关闭时调用destroy</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyServletContextLis</span> <span class="keyword">implements</span> <span class="title">ServletContextListener</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent servletContextEvent)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"servletContext init..."</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextDestroyed</span><span class="params">(ServletContextEvent servletContextEvent)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"servletContext destroyed"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在web.xml中进行配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>com.listener.MyServletContextLis<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h3><p>filter实现对请求和响应的修改。比如实现对编码的处理，对是登录的校验等。需要在web.xml中配置定义的filter类以及相应要拦截的请求规则。</p>
<h4 id="作用-1"><a href="#作用-1" class="headerlink" title="作用"></a>作用</h4><ul>
<li>在HttpServletRequest到达Servlet之前，拦截HttpServletRequest</li>
<li>对HttpServletRequest进行处理，可以修改其头部或请求数据</li>
<li>在HttpServletResponse到达浏览器之前拦截HttpServletResponse</li>
<li>对HttpServletResponse进行处理，可以修改其问部或响应数据</li>
</ul>
<h4 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h4><p>一般有如下分类的filter</p>
<ul>
<li>权限验证filter：比如有些页面必须要登录才可以查看</li>
<li>日志filter：记录某些特殊的用户请求</li>
<li>编码filter：解决请求和响应的乱码问题，典型的如spring中的CharacterEncodingFilter</li>
<li>能改变xml内容的XSLT Filter等</li>
<li>可以进行filter链过滤，即一个请求可以经过多个filter。执行的顺序根据web.xml中配置的顺序从上到下执行</li>
</ul>
<h4 id="接口方法"><a href="#接口方法" class="headerlink" title="接口方法"></a>接口方法</h4><ul>
<li>init：初始化操作</li>
<li>doFilter：处理业务逻辑</li>
<li>destroy：销毁操作</li>
</ul>
<h4 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h4><p>filter和servlet一样是单实例多线程。在服务器启动时进行创建，调用init方法进行初始化。当请求过来时创建一个线程，根据路径调用相应filter的doFilter方法执行业务处理。当filter被移除或服务器正常关闭时调用destroy方法执行销毁操作。</p>
<h4 id="使用步骤-1"><a href="#使用步骤-1" class="headerlink" title="使用步骤"></a>使用步骤</h4><ol>
<li><p>编写一个类实现filter接口</p>
</li>
<li><p>在web.xml中进行配置并绑定路径</p>
<p>默认是对浏览器过来的请求进行过滤，如果需要更改通过dispatcher指定相应的值。REQUEST（浏览器过来的请求）；FORWARD（转发过来的请求）； ERROR（因服务器错误而发送过来的请求）； INCLUDE（包含过来的请求）。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>DispatcherFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/e/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">dispatcher</span>&gt;</span>FORWARD<span class="tag">&lt;/<span class="name">dispatcher</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">dispatcher</span>&gt;</span>REQUEST<span class="tag">&lt;/<span class="name">dispatcher</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">dispatcher</span>&gt;</span>ERROR<span class="tag">&lt;/<span class="name">dispatcher</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="解决请求参数中文乱码"><a href="#解决请求参数中文乱码" class="headerlink" title="解决请求参数中文乱码"></a>解决请求参数中文乱码</h4><p>EncodingFilter实现，对获取参数值的方法进行了加强</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> javax.servlet.*;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequestWrapper;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</div><div class="line"><span class="keyword">import</span> java.util.Map;</div><div class="line"><span class="comment">/**</span></div><div class="line"> * 统一编码</div><div class="line"> * <span class="doctag">@author</span> Administrator</div><div class="line"> *</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EncodingFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest req, ServletResponse resp, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</div><div class="line">		<span class="comment">//1.强转</span></div><div class="line">		HttpServletRequest request=(HttpServletRequest) req;</div><div class="line">		HttpServletResponse response=(HttpServletResponse) resp;</div><div class="line">		<span class="comment">//2.放行</span></div><div class="line">		chain.doFilter(<span class="keyword">new</span> MyRequest2(request), response);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyRequest2</span> <span class="keyword">extends</span> <span class="title">HttpServletRequestWrapper</span></span>&#123;</div><div class="line">	<span class="keyword">private</span> HttpServletRequest request;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">boolean</span> flag=<span class="keyword">true</span>;</div><div class="line">	</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MyRequest2</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</div><div class="line">		<span class="keyword">super</span>(request);</div><div class="line">		<span class="keyword">this</span>.request=request;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getParameter</span><span class="params">(String name)</span> </span>&#123;  </div><div class="line">		<span class="keyword">if</span>(name==<span class="keyword">null</span> || name.trim().length()==<span class="number">0</span>)&#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">		&#125;</div><div class="line">		String[] values = getParameterValues(name);</div><div class="line">		<span class="keyword">if</span>(values==<span class="keyword">null</span> || values.length==<span class="number">0</span>)&#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> values[<span class="number">0</span>];</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * hobby=[eat,drink]</div><div class="line">	 */</div><div class="line">	<span class="keyword">public</span> String[] getParameterValues(String name) &#123;</div><div class="line">		<span class="keyword">if</span>(name==<span class="keyword">null</span> || name.trim().length()==<span class="number">0</span>)&#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">		&#125;</div><div class="line">		Map&lt;String, String[]&gt; map = getParameterMap();</div><div class="line">		<span class="keyword">if</span>(map==<span class="keyword">null</span> || map.size()==<span class="number">0</span>)&#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		<span class="keyword">return</span> map.get(name);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * map&#123; username=[tom],password=[123],hobby=[eat,drink]&#125;</div><div class="line">	 */</div><div class="line">	<span class="keyword">public</span> Map&lt;String,String[]&gt; getParameterMap() &#123;  </div><div class="line">		<span class="comment">/**</span></div><div class="line">		 * 首先判断请求方式</div><div class="line">		 * 若为post  request.setchar...(utf-8)</div><div class="line">		 * 若为get 将map中的值遍历编码就可以了</div><div class="line">		 */</div><div class="line">		String method = request.getMethod();</div><div class="line">		<span class="keyword">if</span>(<span class="string">"post"</span>.equalsIgnoreCase(method))&#123;</div><div class="line">			<span class="keyword">try</span> &#123;</div><div class="line">				request.setCharacterEncoding(<span class="string">"utf-8"</span>);</div><div class="line">				<span class="keyword">return</span> request.getParameterMap();</div><div class="line">			&#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</div><div class="line"></div><div class="line">				e.printStackTrace();</div><div class="line">			&#125;</div><div class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">"get"</span>.equalsIgnoreCase(method))&#123;</div><div class="line">			Map&lt;String,String[]&gt; map = request.getParameterMap();</div><div class="line">			<span class="keyword">if</span>(flag)&#123;</div><div class="line">				<span class="keyword">for</span> (String key:map.keySet()) &#123;</div><div class="line">					String[] arr = map.get(key);</div><div class="line">					<span class="comment">//继续遍历数组</span></div><div class="line">					<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;arr.length;i++)&#123;</div><div class="line">						<span class="comment">//编码</span></div><div class="line">						<span class="keyword">try</span> &#123;</div><div class="line">							arr[i]=<span class="keyword">new</span> String(arr[i].getBytes(<span class="string">"iso8859-1"</span>),<span class="string">"utf-8"</span>);</div><div class="line">						&#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</div><div class="line">							e.printStackTrace();</div><div class="line">						&#125;</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">				flag=<span class="keyword">false</span>;</div><div class="line">			&#125;</div><div class="line">			<span class="comment">//需要遍历map 修改value的每一个数据的编码</span></div><div class="line">			<span class="keyword">return</span> map;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">super</span>.getParameterMap();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>web.xml配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>EncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.filter.EncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>EncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></div></pre></td></tr></table></figure>
<p>参考：</p>
<p><a href="http://www.cnblogs.com/doit8791/p/4209442.html" target="_blank" rel="external">servlet/filter/listener/interceptor区别与联系</a></p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://xxyxpy.pub/2017/08/03/java/web/web-06Listener,Filter/" data-id="cjblrl7fn005oqwhqqlbpi9s3" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-java/web/web-05事务" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/08/01/java/web/web-05事务/">web-05事务</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/08/01/java/web/web-05事务/">
            <time datetime="2017-08-01T08:48:36.374Z" itemprop="datePublished">2017-08-01</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/java/">java</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/java/web/">web</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/java/">java</a>, <a class="tag-link" href="/tags/web/">web</a>, <a class="tag-link" href="/tags/事务/">事务</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h3 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h3><h4 id="什么是事务"><a href="#什么是事务" class="headerlink" title="什么是事务"></a>什么是事务</h4><p>完成一件事情需要分多步执行，只要其中有一步出错执行过的所有操作全部回滚。要么全部成功，要么全部失败。</p>
<h4 id="事务的特性ACID"><a href="#事务的特性ACID" class="headerlink" title="事务的特性ACID"></a>事务的特性ACID</h4><ul>
<li>原子性：事务里面的操作单元不可切割,要么全部成功,要么全部失败</li>
<li>一致性：事务执行前后,业务状态和其他业务状态保持一致</li>
<li>隔离性：一个事务执行的时候最好不要受到其他事务的影响</li>
<li>持久性：一旦事务提交或者回滚.这个状态都要持久化到数据库中</li>
</ul>
<p>如果不保证一致性会存在如下的问题：</p>
<ul>
<li><p>脏读：在一个事务中读取到另一个事务没有提交的数据</p>
<p>事务T1将某一值修改，然后事务T2读取该值，此后T1因为某种原因撤销对该值的修改，这就导致了T2所读取到的数据是无效的</p>
</li>
<li><p>不可重复读：在一个事务中，两次查询的结果不一致。由于查询时其它事务进行了修改（update）操作引起的。</p>
<p>比如事务T1读取某一数据，事务T2读取并修改了该数据，T1为了对读取值进行检验而再次读取该数据，便得到了不同的结果</p>
</li>
<li><p>虚读(幻读)：在一个事务中，两次查询的结果不一致。由于查询时其它事务进行了插入操作。</p>
<p>例如第一个事务对一个表中的数据进行了修改，比如这种修改涉及到表中的“全部数据行”。同时，第二个事务也修改这个表中的数据，这种修改是向表中插入“一行新数据”。那么，以后就会发生操作第一个事务的用户发现表中还有没有修改的数据行，就好象发生了幻觉一样</p>
</li>
</ul>
<h4 id="经典案例：转帐"><a href="#经典案例：转帐" class="headerlink" title="经典案例：转帐"></a>经典案例：转帐</h4><p>A转帐给B，先发生A帐户金额的扣减，再发生B帐户金额的增加。一旦扣减成功而增加失败需要把扣减的金额再加回去。在java中实现此功能，需要手动管理事务提交，一般数据库都是自动提交事务的。</p>
<p>注意：一旦使用手动事务,调用方法的时候都需要手动传入connection,并且需要手动关闭连接。下面这个实现是通过将connection绑定到线路上解决connection一致的问题</p>
<p><code>DataSourceUtils</code>类，此类用到了c3p0工具包。可以查看前面的jdbc内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> com.mchange.v2.c3p0.ComboPooledDataSource;</div><div class="line"><span class="keyword">import</span> javax.sql.DataSource;</div><div class="line"><span class="keyword">import</span> java.sql.Connection;</div><div class="line"><span class="keyword">import</span> java.sql.SQLException;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSourceUtils</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ComboPooledDataSource dataSource = <span class="keyword">new</span> ComboPooledDataSource();</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;Connection&gt; tl = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DataSource <span class="title">getDataSource</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> dataSource;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</div><div class="line">        Connection con = tl.get();</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == con)&#123;</div><div class="line">            con = dataSource.getConnection();</div><div class="line">            tl.set(con);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> con;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">beginTransaction</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</div><div class="line">        <span class="comment">//获取连接并关闭自动提交</span></div><div class="line">        getConnection().setAutoCommit(<span class="keyword">false</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">commitTransaction</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            Connection con = getConnection();</div><div class="line">            con.commit();</div><div class="line">            con.close();</div><div class="line">            tl.remove();</div><div class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">rollBackTransaction</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            Connection con = getConnection();</div><div class="line">            con.rollback();</div><div class="line">            con.close();</div><div class="line">            tl.remove();</div><div class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 关闭连接,Statement或ResultSet</div><div class="line">     * <span class="doctag">@param</span> closeables</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(AutoCloseable... closeables)</span></span>&#123;</div><div class="line">        <span class="keyword">for</span> (AutoCloseable a : closeables) &#123;</div><div class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> == a)&#123;</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                a.close();</div><div class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>AccountService</code>类，三层架构中的service层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountService</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AccountDao dao = <span class="keyword">new</span> AccountDao();</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">account</span><span class="params">(String from, String to, String money)</span> <span class="keyword">throws</span> SQLException </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            DataSourceUtils.beginTransaction();</div><div class="line">            dao.accountOut(from, money);</div><div class="line">            <span class="comment">//int i = 1/0;</span></div><div class="line">            dao.accountIn(to, money);</div><div class="line">            DataSourceUtils.commitTransaction();</div><div class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</div><div class="line">            DataSourceUtils.rollBackTransaction();</div><div class="line">            <span class="keyword">throw</span> e;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>AccountDao</code>类，三层架构中的dao层。这里用到了dbutils工具包</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountDao</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accountIn</span><span class="params">(String to, String money)</span> <span class="keyword">throws</span> SQLException </span>&#123;</div><div class="line">        QueryRunner qr = <span class="keyword">new</span> QueryRunner();</div><div class="line">        String sql = <span class="string">"update account set money=money+? where name=?"</span>;</div><div class="line">        qr.update(DataSourceUtils.getConnection(), sql, money, to);</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accountOut</span><span class="params">(String from, String money)</span> <span class="keyword">throws</span> SQLException </span>&#123;</div><div class="line">        QueryRunner qr = <span class="keyword">new</span> QueryRunner();</div><div class="line">        String sql = <span class="string">"update account set money=money-? where name=?"</span>;</div><div class="line">        qr.update(DataSourceUtils.getConnection(), sql, money, from);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="事务的隔离级别"><a href="#事务的隔离级别" class="headerlink" title="事务的隔离级别"></a>事务的隔离级别</h3><p><a href="http://www.jianshu.com/p/4e3edbedb9a8" target="_blank" rel="external">五分钟搞清楚MySQL事务隔离级别</a></p>
<p><a href="http://www.hollischuang.com/archives/943" target="_blank" rel="external">深入分析事务的隔离级别</a></p>
<p><a href="https://tech.meituan.com/innodb-lock.html" target="_blank" rel="external">美团点评-Innodb中的事务隔离级别和锁的关系</a></p>
<ul>
<li><p>读未提交（Read Uncommitted）：最低的隔离级别。一个事务可以读取到另外一个事务未提交的数据</p>
</li>
<li><p>读已提交（Read Committed）：在一个事务修改数据过程中，如果事务还没提交，其他事务不能读该数据。但是不能解决<strong>不可重复读</strong>的问题。比如事务一第一读读取时发生在事务二还未提交，读取结果为A。事务二提交后再次读取结果是B。存在AB两次结果不一致的问题。</p>
</li>
<li><p>可重复读（Repeatable reads）：由于提交读隔离级别会产生不可重复读的读现象。所以，比提交读更高一个级别的隔离级别就可以解决不可重复读的问题。但是它解决不了<strong>幻读（虚读）</strong>的问题，因为可重复读时共享锁是加在已经存在的表上面的。如查此时再进行插入操作，再次查询的结果就会不同而产生幻读。</p>
</li>
<li><p>可序列化（Serializable）：是最高的隔离级别，前面提到的所有的隔离级别都无法解决的幻读，在可序列化的隔离级别中可以解决。</p>
<ul>
<li>事务在读取数据时，必须先对其加 表级共享锁 ，直到事务结束才释放；事务1正在读取A表中的记录时，则事务2也能读取A表，但不能对A表做更新、新增、删除，直到事务1结束。(因为事务一对表增加了表级共享锁，其他事务只能增加共享锁读取数据，不能进行其他任何操作）</li>
<li>事务在更新数据时，必须先对其加 表级排他锁 ，直到事务结束才释放。事务1正在更新A表中的记录时，则事务2不能读取A表的任意记录，更不可能对A表做更新、新增、删除，直到事务1结束。（事务一对表增加了表级排他锁，其他事务不能对表增加共享锁或排他锁，也就无法进行任何操作）</li>
</ul>
<p>​</p>
</li>
</ul>
<p>虽然可序列化解决了脏读、不可重复读、幻读等读现象。但是序列化事务会产生以下效果：</p>
<p>1.无法读取其它事务已修改但未提交的记录。</p>
<p>2.在当前事务完成之前，其它事务不能修改目前事务已读取的记录。</p>
<p>3.在当前事务完成之前，其它事务所插入的新记录，其索引键值不能在当前事务的任何语句所读取的索引键范围中。</p>
<hr>
<p>四种事务隔离级别从隔离程度上越来越高，但同时在并发性上也就越来越低。之所以有这么几种隔离级别，就是为了方便开发人员在开发过程中根据业务需要选择最合适的隔离级别。</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://xxyxpy.pub/2017/08/01/java/web/web-05事务/" data-id="cjblrl7fl005lqwhq4pw00fr5" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-java/web/web-04Jsp,El,Jstl" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/07/27/java/web/web-04Jsp,El,Jstl/">web-04Jsp,El,Jstl</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/07/27/java/web/web-04Jsp,El,Jstl/">
            <time datetime="2017-07-27T03:00:07.492Z" itemprop="datePublished">2017-07-27</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/java/">java</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/java/web/">web</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/el/">el</a>, <a class="tag-link" href="/tags/java/">java</a>, <a class="tag-link" href="/tags/jsp/">jsp</a>, <a class="tag-link" href="/tags/jstl/">jstl</a>, <a class="tag-link" href="/tags/web/">web</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h3 id="jsp"><a href="#jsp" class="headerlink" title="jsp"></a>jsp</h3><p>本质上jsp就是一个servlet，在html代码中嵌套java代码，运行在服务器端，处理请求，生成动态的内容。<br>对应的java和class文件在tomcat目录下的work目录。</p>
<ul>
<li>三种脚本编写方式。上一篇讲过了，简单提一下<ul>
<li>&lt;%..%&gt; java代码片段</li>
<li>&lt;%=..%&gt; 输出表达式 相当于out.print()</li>
<li>&lt;%!…%&gt; 声明成员</li>
</ul>
</li>
</ul>
<h4 id="jsp指令"><a href="#jsp指令" class="headerlink" title="jsp指令"></a>jsp指令</h4><p>一个页面可以出现多个指令，指令可以放在任意位置，一般都放在jsp页面的顶部。</p>
<ul>
<li>作用：声明 jsp页面的一些属性和动作</li>
<li>格式：&lt;%@指令名称 属性=”值” 属性=”值”%&gt;</li>
<li>指令的分类<ul>
<li>page：主要声明jsp页面的一些属性</li>
<li>include：静态包含</li>
<li>taglib：导入标签库</li>
</ul>
</li>
</ul>
<h5 id="page"><a href="#page" class="headerlink" title="page"></a>page</h5><table>
<thead>
<tr>
<th style="text-align:center">属性</th>
<th style="text-align:left">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>pageEncoding</strong></td>
<td style="text-align:left">设置页面的编码</td>
</tr>
<tr>
<td style="text-align:center"><strong>contentType</strong></td>
<td style="text-align:left">设置响应流的编码,及通知浏览器用什么编码打开.设置文件的mimetype</td>
</tr>
<tr>
<td style="text-align:center"><strong>import</strong></td>
<td style="text-align:left">导入所需要的包</td>
</tr>
<tr>
<td style="text-align:center">language</td>
<td style="text-align:left">当前jsp页面里面可以嵌套的语言</td>
</tr>
<tr>
<td style="text-align:center">buffer</td>
<td style="text-align:left">设置jsp页面的流的缓冲区的大小</td>
</tr>
<tr>
<td style="text-align:center">autoFlush</td>
<td style="text-align:left">是否自动刷新</td>
</tr>
<tr>
<td style="text-align:center">extends</td>
<td style="text-align:left">声明当前jsp的页面继承于那个类.必须继承的是httpservlet 及其子类</td>
</tr>
<tr>
<td style="text-align:center">session</td>
<td style="text-align:left">设置jsp页面是否可以使用session内置对象</td>
</tr>
<tr>
<td style="text-align:center">isELIgnored</td>
<td style="text-align:left">是否忽略el表达式</td>
</tr>
<tr>
<td style="text-align:center">errorPage</td>
<td style="text-align:left">当前jsp页面出现异常的时候要跳转到的jsp页面</td>
</tr>
<tr>
<td style="text-align:center">isErrorPage</td>
<td style="text-align:left">当前jsp页面是否是一个错误页面若值为true,可以使用jsp页面的一个内置对象 exception</td>
</tr>
</tbody>
</table>
<p>contentType和pageEncoding的关系：</p>
<ul>
<li>两个都设置时使用各自的编码</li>
<li>只设置一个两个都使用出现的这个编码</li>
<li>两个都不设置使用tomcat默认的编码，tomcat8开始默认是utf-8，之前默认是ios8859-1</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">// 一般页面</div><div class="line">&lt;%@ page contentType="text/html;charset=UTF-8" pageEncoding="utf-8" language="java" errorPage="error.jsp" %&gt;</div><div class="line">// 错误页面</div><div class="line">&lt;%@ page contentType="text/html;charset=UTF-8" language="java" isErrorPage="true" %&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">    &lt;title&gt;error page&lt;/title&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">    &lt;h3&gt;error page&lt;/h3&gt;&lt;br&gt;</div><div class="line">    &lt;%=exception.getMessage()</div><div class="line">    %&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<h5 id="include"><a href="#include" class="headerlink" title="include"></a>include</h5><p>静态包含，就是将其他页面或者servlet的内容包含进来，一起编译运行。生成一个java文件。可以理解为这两个页面的代码写在了同一个页面里。</p>
<p>格式：<code>&lt;%@include file=&quot;相对路径或者是内部路径&quot;</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">    &lt;title&gt;include&lt;/title&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">    &lt;%@include file="/jsp/include/i1.jsp"%&gt;</div><div class="line">    &lt;hr&gt;</div><div class="line">    &lt;%@include file="/jsp/include/i2.jsp"%&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<h5 id="taglib"><a href="#taglib" class="headerlink" title="taglib"></a>taglib</h5><p>导入标签库。导入之后可以使用标签库中的一些功能</p>
<p>格式：<code>&lt;%@taglib prefix=&quot;前缀名&quot; uri=&quot;名称空间&quot; %&gt;</code></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;%<span class="meta">@taglib</span> prefix=<span class="string">"fn"</span> uri=<span class="string">"http://java.sun.com/jsp/jstl/functions"</span> %&gt;</div><div class="line">&lt;%<span class="meta">@taglib</span> prefix=<span class="string">"c"</span> uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> %&gt;</div><div class="line"><span class="comment">// 使用</span></div><div class="line">$&#123;fn:toUpperCase(<span class="string">"hello"</span>)&#125;</div></pre></td></tr></table></figure>
<h4 id="jsp内置对象"><a href="#jsp内置对象" class="headerlink" title="jsp内置对象"></a>jsp内置对象</h4><p>在jsp页面上可以直接使用的对象</p>
<table>
<thead>
<tr>
<th>内置对象</th>
<th>类型</th>
</tr>
</thead>
<tbody>
<tr>
<td>out</td>
<td>JspWriter</td>
</tr>
<tr>
<td>request</td>
<td>HttpServletRequest</td>
</tr>
<tr>
<td>response</td>
<td>HttpServletResponse</td>
</tr>
<tr>
<td>session</td>
<td>HttpSession</td>
</tr>
<tr>
<td>exception</td>
<td>Throwable</td>
</tr>
<tr>
<td>page</td>
<td>Servlet(this)</td>
</tr>
<tr>
<td>config</td>
<td>ServletConfig</td>
</tr>
<tr>
<td>application</td>
<td>ServletContext</td>
</tr>
<tr>
<td>pageContext</td>
<td>PageContext</td>
</tr>
</tbody>
</table>
<h4 id="pageContext域对象"><a href="#pageContext域对象" class="headerlink" title="pageContext域对象"></a>pageContext域对象</h4><ul>
<li>pageContext是servlet中第四个域对象，作用的范围是当前的jsp页面。</li>
<li>通过getXXX方法可以获取request，response，session等其他对象<code>pageContext.getRequest()</code></li>
<li>通过set/get/reomverAtrribute方法可以操作自己和其它的域对象。操作其他域对象时通过指定scope枚举实现。如：<code>pageContext.setAttribute(&quot;rkey&quot;, &quot;rvalue&quot;, PageContext.REQUEST_SCOPE);</code></li>
<li>通过findAttribute方法实现遍历查找。依次从pageContext,request,session,application四个域中查找相应的属性。如果查找到返回对应的属性值，如果查找不到返回null。一旦查找到立即返回。</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">    &lt;title&gt;Title&lt;/title&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">&lt;%</div><div class="line">    pageContext.setAttribute("pkey", "pvalue");</div><div class="line">	// 操作request域对象</div><div class="line">    pageContext.setAttribute("rkey", "rvalue", PageContext.REQUEST_SCOPE);</div><div class="line">    session.setAttribute("rkey", "svalue");</div><div class="line">%&gt;</div><div class="line"></div><div class="line">&lt;%=pageContext.getAttribute("pkey")%&gt; &lt;br&gt;</div><div class="line">  &lt;!--便捷查找--&gt;</div><div class="line">&lt;%=pageContext.findAttribute("rkey")%&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<h4 id="servlet四大域对象总结"><a href="#servlet四大域对象总结" class="headerlink" title="servlet四大域对象总结"></a>servlet四大域对象总结</h4><table>
<thead>
<tr>
<th>域对象</th>
<th>作用范围</th>
<th>生命周期</th>
</tr>
</thead>
<tbody>
<tr>
<td>PageContext</td>
<td>整个jsp页面，作用域最小的一个</td>
<td>当对jsp请求时开始，响应结束时销毁</td>
</tr>
<tr>
<td>ServletRequest</td>
<td>整个请求链，包括请求转发</td>
<td>请求到达服务器，service方法调用前由服务器创建。请求结束时销毁</td>
</tr>
<tr>
<td>Session</td>
<td>一次会话</td>
<td>第一次调用request.getSession方法时。session到期、手动关闭或服务器非正常关闭时</td>
</tr>
<tr>
<td>ServletContext</td>
<td>整个web应用</td>
<td>web程序启动时生成，当服务器关闭或者web应用被移除时销毁</td>
</tr>
</tbody>
</table>
<h4 id="jsp动作标签"><a href="#jsp动作标签" class="headerlink" title="jsp动作标签"></a>jsp动作标签</h4><ul>
<li><p>请求转发</p>
<p>相当于java中  request.getRequestDispatcher(..).forward(..);使用<code>&lt;jsp:forward page=&quot;内部路径&quot;&gt;&lt;/jsp:forward&gt;</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">    &lt;title&gt;Title&lt;/title&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">&lt;jsp:forward page="for1.jsp"&gt;&lt;/jsp:forward&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>动态包含</p>
<p>将被包含页面或servlet的运行结果包含到当前页面中</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">    &lt;title&gt;include&lt;/title&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">    &lt;%--&lt;%@include file="/jsp/include/i1.jsp"%&gt;--%&gt;</div><div class="line">    &lt;jsp:include page="i1.jsp"&gt;&lt;/jsp:include&gt;</div><div class="line">    &lt;hr&gt;</div><div class="line">    &lt;%--&lt;%@include file="/jsp/include/i2.jsp"%&gt;--%&gt;</div><div class="line">    &lt;jsp:include page="i2.jsp"&gt;&lt;/jsp:include&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="静态包含VS动态包含"><a href="#静态包含VS动态包含" class="headerlink" title="静态包含VS动态包含"></a>静态包含VS动态包含</h4><p>简单的理解静态包含就是两个页面代码合并在同一个页面中。查看html源只有一个html节点。而动态包含中当向这个页面发出请求后会转发到include的那个页面去执行。执行完之后接着执行本页面下面的代码。查看html源有多个html节点，动态包含一次多一个。更详情的解释如下：</p>
<p>1)    静态包含在转换成为java文件的时候将要包含的文件包含进来，作为一个整体编译。动态包含是各个包含文件分别转换，分别编译。<br>2)    静态包含在两个文件中不能有相同的变量，动态包含允许<br>3)    静态包含只能包含文件，动态包含还可以包含servlet输出的结果<br>4)    静态包含不能使用变量作为文件名，动态包含可以使用变量作为文件名<br>5)    动态包含文件发生变化，包含文件会感知变化。</p>
<h3 id="el"><a href="#el" class="headerlink" title="el"></a>el</h3><p>EL（Expression Language） 是为了使JSP写起来更加简单。表达式语言的灵感来自于 ECMAScript 和 XPath 表达式语言，它提供了在 JSP 中简化表达式的方法，让Jsp的代码更加简化。用于替代&lt;%=…%&gt;</p>
<h4 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h4><ul>
<li><strong>获取域中的数据</strong></li>
<li><strong>执行运算</strong></li>
<li>获取常见的web对象</li>
<li>调用java的方法</li>
</ul>
<h4 id="获取域中数据"><a href="#获取域中数据" class="headerlink" title="获取域中数据"></a>获取域中数据</h4><ul>
<li><p>简单数据获取</p>
<p>数据获取时可以不使用xxScope直接使用${属性}</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">    &lt;title&gt;el语言&lt;/title&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">&lt;%</div><div class="line">    pageContext.setAttribute("pkey", "pvalue");</div><div class="line">    request.setAttribute("rkey", "rvalue");</div><div class="line">    session.setAttribute("skey", "svalue");</div><div class="line">    application.setAttribute("akey", "avalue");</div><div class="line">%&gt;</div><div class="line">get pageContext value &lt;br&gt;</div><div class="line">&lt;%=pageContext.getAttribute("pkey")%&gt; &lt;br&gt;</div><div class="line">$&#123;pageScope.pkey&#125;</div><div class="line">&lt;hr&gt;</div><div class="line">get request value &lt;br&gt;</div><div class="line">&lt;%=request.getAttribute("rkey")%&gt; &lt;br&gt;</div><div class="line">$&#123;requestScope.rkey&#125;</div><div class="line">&lt;hr&gt;</div><div class="line">get session value &lt;br&gt;</div><div class="line">&lt;%=session.getAttribute("skey")%&gt; &lt;br&gt;</div><div class="line">$&#123;sessionScope.skey&#125;</div><div class="line">&lt;hr&gt;</div><div class="line">get application value &lt;br&gt;</div><div class="line">&lt;%=application.getAttribute("akey")%&gt; &lt;br&gt;</div><div class="line">$&#123;applicationScope.akey&#125;</div><div class="line">&lt;hr&gt;</div><div class="line">便捷获取</div><div class="line">$&#123;pkey&#125;,$&#123;rkey&#125;,$&#123;skey&#125;,$&#123;akey&#125;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>复杂数据获取</p>
<p>若属性名中出现了”.”|”+”|”-“等特殊符号,需要使用scope获取。例如：<code>${requestScope[&quot;arr.age&quot;] }</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">    &lt;title&gt;el处理复杂数据&lt;/title&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">&lt;%</div><div class="line">    //array</div><div class="line">    request.setAttribute("arr", new String[]&#123;"a", "b", "c"&#125;);</div><div class="line">    //list</div><div class="line">    List&lt;String&gt; list = new ArrayList&lt;&gt;();</div><div class="line">    list.add("aa");</div><div class="line">    list.add("bb");</div><div class="line">    list.add("cc");</div><div class="line">    request.setAttribute("list", list);</div><div class="line">    //map</div><div class="line">    Map m = new HashMap();</div><div class="line">    m.put("name", "tom");</div><div class="line">    m.put("age", 18);</div><div class="line">    request.setAttribute("map", m);</div><div class="line">    //带特殊符号的数据</div><div class="line">    request.setAttribute("arr.age", 18);</div><div class="line">%&gt;</div><div class="line">get array &lt;br&gt;</div><div class="line">old:&lt;%=((String[])request.getAttribute("arr"))[0]%&gt; &lt;br&gt;</div><div class="line">new:$&#123;arr[0]&#125;</div><div class="line">&lt;hr&gt;</div><div class="line"></div><div class="line">get list &lt;br&gt;</div><div class="line">old:&lt;%=((List&lt;String&gt;)request.getAttribute("list")).get(1)%&gt; &lt;br&gt;</div><div class="line">new:$&#123;list[1]&#125;</div><div class="line">&lt;hr&gt;</div><div class="line">  </div><div class="line">get map &lt;br&gt;</div><div class="line">old:&lt;%=((Map)request.getAttribute("map")).get("name")%&gt; &lt;br&gt;</div><div class="line">new:$&#123;map.get("name")&#125;</div><div class="line">&lt;hr&gt;</div><div class="line"></div><div class="line">获取特殊名称数据 &lt;br&gt;</div><div class="line">$&#123;requestScope["arr.age"]&#125;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>获取javaBean数据</p>
<p>直接使用<code>${javaBean名称.bean属性}</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">    &lt;title&gt;Title&lt;/title&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">&lt;%</div><div class="line">    User user = new User();</div><div class="line">    user.setId("001");</div><div class="line">    user.setName("jack");</div><div class="line">    user.setPassword("abc");</div><div class="line">    request.setAttribute("u", user);</div><div class="line">%&gt;</div><div class="line">$&#123;u.name&#125;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="执行运算"><a href="#执行运算" class="headerlink" title="执行运算"></a>执行运算</h4><ul>
<li>+:只能进行加法运算,字符串形式数字可以进行加法运算</li>
<li>empty:判断一个容器的长度是否为0(array set list map),还可以判断一个对象是否为空<code>${empty 域中的对象名称}</code></li>
<li>支持三元运算符</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">    &lt;title&gt;Title&lt;/title&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">&lt;%</div><div class="line">    request.setAttribute("i", 3);</div><div class="line">    request.setAttribute("j", 4);</div><div class="line">    List&lt;String&gt; list = null;</div><div class="line">    request.setAttribute("list", list);</div><div class="line">%&gt;</div><div class="line">$&#123;i+j&#125; &lt;br&gt;</div><div class="line">$&#123;empty list&#125; &lt;br&gt;</div><div class="line">$&#123;i &gt; j ? "yes" : "no"&#125; &lt;br&gt;</div><div class="line">$&#123;i == 3&#125;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<h4 id="el内置对象"><a href="#el内置对象" class="headerlink" title="el内置对象"></a>el内置对象</h4><p>总人有11个内置对象，除了pageContext其余对象获取的全是map集合。</p>
<p>pageScope、requestScope、sessionScope、applicationScope、param、paramValues、header、haederValues、initParam、cookie★、pageContext★</p>
<p>参数相关：param、paramValues</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$&#123;param&#125; &lt;br&gt;</div><div class="line">$&#123;param.password&#125; &lt;br&gt;</div><div class="line">$&#123;paramValues&#125; &lt;br&gt;</div><div class="line">$&#123;paramValues.get(<span class="string">"hobby"</span>)[<span class="number">1</span>]&#125; &lt;br&gt;</div><div class="line">$&#123;paramValues.hobby[<span class="number">1</span>]&#125; &lt;br&gt;</div></pre></td></tr></table></figure>
<p>请求头相关：header、haederValues</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$&#123;header&#125; &lt;br&gt;</div><div class="line">$&#123;headerValues&#125; &lt;br&gt;</div><div class="line">&lt;hr&gt;</div><div class="line">accept:$&#123;header.accept&#125;&lt;br&gt;</div><div class="line">user-agent:$&#123;headerValues[<span class="string">"user-agent"</span>][<span class="number">0</span>]&#125;</div></pre></td></tr></table></figure>
<p>全局初始化参数相关：initParam</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$&#123;initParam&#125;</div></pre></td></tr></table></figure>
<p>Cookie相关：cookie</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="formula">$&#123;cookie&#125; 获取map&#123;key=Cookie&#125;</span></div><div class="line">例如:创建cookie</div><div class="line">Cookie c=new Cookie("username","tom");</div><div class="line">通过$&#123;cookie&#125;获取相当于	</div><div class="line">&#123;username=new Cookie("username","tom")&#125;</div><div class="line">相当于map的key是cookie的键</div><div class="line">map的value是当前cookie</div><div class="line"></div><div class="line">若想获取名称username的cookie的value值(获取tom)</div><div class="line"><span class="formula">$&#123;cookie.username.value&#125;--javabean导航</span></div><div class="line">注意:</div><div class="line">java中Cookie的api</div><div class="line">getName():获取cookie的名称</div><div class="line">getValue():获取cookie的value值</div><div class="line">我们称name和value是cookie的bean属性</div><div class="line"></div><div class="line">使用cookie内置对象:</div><div class="line">$&#123;cookie.给cookie起名字.value&#125;</div><div class="line"></div><div class="line">例如:</div><div class="line">获取jsession的值</div><div class="line"><span class="formula">$&#123;cookie.JSESSIONID.value&#125;</span></div></pre></td></tr></table></figure>
<h3 id="jstl"><a href="#jstl" class="headerlink" title="jstl"></a>jstl</h3><p>jsp标准的标签库语言，主要用来替代java脚本。如果要使用标签库必须要导入<code>jstl.jar</code>和<code>standard.jar</code>两个jar包。</p>
<p>更多关于标签库的内容可以查看<a href="http://pan.baidu.com/s/1kV40Zor" target="_blank" rel="external">文档</a></p>
<p>分类：</p>
<ul>
<li>core：<strong>核心类库</strong></li>
<li>fmt：格式化，国际化</li>
<li>xml：已过时</li>
<li>sql：已过时</li>
<li>fn：函数库，比较少使用</li>
</ul>
<h4 id="core的使用"><a href="#core的使用" class="headerlink" title="core的使用"></a>core的使用</h4><p>主要有if判断，forEach循环，choose类似switch等</p>
<p>使用<code>&lt;%@taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %&gt;</code>引入core标签库</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div></pre></td><td class="code"><pre><div class="line">&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %&gt;</div><div class="line">&lt;%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">    &lt;title&gt;Title&lt;/title&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">&lt;%</div><div class="line">    //list</div><div class="line">    List&lt;String&gt; list = new ArrayList&lt;&gt;();</div><div class="line">    list.add("a");</div><div class="line">    list.add("b");</div><div class="line">    list.add("c");</div><div class="line">    request.setAttribute("list", list);</div><div class="line">    //set</div><div class="line">    Set&lt;String&gt; set = new HashSet&lt;&gt;();</div><div class="line">    set.add("aa");</div><div class="line">    set.add("bb");</div><div class="line">    set.add("cc");</div><div class="line">    request.setAttribute("set", set);</div><div class="line">//map</div><div class="line">    Map&lt;String, String&gt; map = new HashMap&lt;&gt;();</div><div class="line">    map.put("ak", "av");</div><div class="line">    map.put("bk", "bv");</div><div class="line">    map.put("ck", "cv");</div><div class="line">    request.setAttribute("map", map);</div><div class="line">    request.setAttribute("aa", "bb");</div><div class="line">%&gt;</div><div class="line">    &lt;c:if test='$&#123;aa=="bb"&#125;'&gt;</div><div class="line">        true</div><div class="line">    &lt;/c:if&gt;</div><div class="line">&lt;hr/&gt;</div><div class="line">    &lt;c:if test="$&#123;aa=='cc'&#125;"&gt;</div><div class="line">        true</div><div class="line">    &lt;/c:if&gt;</div><div class="line">  </div><div class="line"></div><div class="line"> </div><div class="line">&lt;c:forEach begin="1" end="10" step="1" var="i"&gt;</div><div class="line">$&#123;i&#125;</div><div class="line">&lt;/c:forEach&gt;</div><div class="line">&lt;hr&gt;</div><div class="line">&lt;c:forEach begin="1" end="20" step="2" var="i" varStatus="vs"&gt;</div><div class="line">    $&#123;i&#125;--$&#123;vs.count&#125;--$&#123;vs.first&#125;--$&#123;vs.last&#125; &lt;br&gt;</div><div class="line">&lt;/c:forEach&gt;</div><div class="line">  &lt;c:forEach items="$&#123;list&#125;" var="l"&gt;</div><div class="line">    $&#123;l&#125;</div><div class="line">&lt;/c:forEach&gt;</div><div class="line">&lt;hr&gt;</div><div class="line">&lt;c:forEach items="$&#123;set&#125;" var="s" varStatus="ss"&gt;</div><div class="line">    $&#123;s&#125;--$&#123;ss.count&#125;</div><div class="line">&lt;/c:forEach&gt;</div><div class="line">&lt;hr&gt;</div><div class="line">&lt;c:forEach items="$&#123;map&#125;" var="m"&gt;</div><div class="line">    $&#123;m.key&#125;--$&#123;m.value&#125; &lt;br&gt;</div><div class="line">&lt;/c:forEach&gt;</div><div class="line">  </div><div class="line">&lt;c:set var="day" value="3"/&gt;</div><div class="line">&lt;c:choose&gt;</div><div class="line">    &lt;c:when test="$&#123;day==1 &#125;"&gt;</div><div class="line">        周1</div><div class="line">    &lt;/c:when&gt;</div><div class="line">    &lt;c:when test="$&#123;day==2&#125;"&gt;</div><div class="line">        周2</div><div class="line">    &lt;/c:when&gt;</div><div class="line">    &lt;c:when test="$&#123;day==3 &#125;"&gt;</div><div class="line">        周3</div><div class="line">    &lt;/c:when&gt;</div><div class="line">    &lt;c:otherwise&gt;</div><div class="line">        其他</div><div class="line">    &lt;/c:otherwise&gt;</div><div class="line">&lt;/c:choose&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<h4 id="fn标签库的使用"><a href="#fn标签库的使用" class="headerlink" title="fn标签库的使用"></a>fn标签库的使用</h4><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %&gt;</div><div class="line">&lt;%@taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">    &lt;title&gt;Title&lt;/title&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">$&#123;fn:toUpperCase("hello")&#125;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://xxyxpy.pub/2017/07/27/java/web/web-04Jsp,El,Jstl/" data-id="cjblrl7fh005dqwhqw5czyno9" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-java/web/web-03Cookie,Session" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/07/26/java/web/web-03Cookie,Session/">web-03Cookie,Session</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/07/26/java/web/web-03Cookie,Session/">
            <time datetime="2017-07-26T08:46:29.082Z" itemprop="datePublished">2017-07-26</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/java/">java</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/java/web/">web</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/cookie/">cookie</a>, <a class="tag-link" href="/tags/java/">java</a>, <a class="tag-link" href="/tags/session/">session</a>, <a class="tag-link" href="/tags/web/">web</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h3 id="jsp"><a href="#jsp" class="headerlink" title="jsp"></a>jsp</h3><p>本质上jsp就是一个servlet，在html代码中嵌套java代码，运行在服务器端，处理请求，生成动态的内容。<br>对应的java和class文件在tomcat目录下的work目录。</p>
<ul>
<li>执行流程</li>
</ul>
<ol>
<li>浏览器发送请求，访问jsp页面</li>
<li>服务器接收到请求，jspServlet查询对应的jsp文件</li>
<li>服务器将jsp页面翻译成java文件</li>
<li>jvm会java文件编译成.class文件</li>
<li>服务器运行.class文件，生成动态的内容</li>
<li>将内容发送给服务器</li>
<li>服务器组成响应信息，发送给浏览器</li>
<li>浏览器接收数据，解析展示</li>
</ol>
<ul>
<li><p>脚本</p>
<ul>
<li>程序片断</li>
<li>直接输出</li>
<li>成员声明</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">    &lt;title&gt;Title&lt;/title&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">    &lt;% int i = 4;</div><div class="line">        System.out.println(i);</div><div class="line">        out.print(i);</div><div class="line">        out.print(j);</div><div class="line">		// 因为本质是servlet所以有getServletContext方法</div><div class="line">        ServletContext sc = getServletContext();</div><div class="line">        //获取运行路径 "/"表示应用在tomcat中的根路径</div><div class="line">        out.write("&lt;h4&gt;运行路径:" + sc.getRealPath("/") + "&lt;h4&gt;");</div><div class="line">    %&gt;</div><div class="line">    &lt;%--直接输出--%&gt;</div><div class="line">    &lt;%=11%&gt;</div><div class="line">    &lt;%--全局常量--%&gt;</div><div class="line">    &lt;%!</div><div class="line">        int j = 8;</div><div class="line">    %&gt;</div><div class="line">    &lt;%=j%&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h3><p>由服务器生成,通过response将cookie写回浏览器(set-cookie),保留在浏览器上,下一次访问时浏览器根据一定的规则携带不同的cookie(通过request的头 cookie),服务器就可以接受cookie</p>
<h4 id="cookie的使用"><a href="#cookie的使用" class="headerlink" title="cookie的使用"></a>cookie的使用</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 添加cookie</span></div><div class="line">Cookie c = <span class="keyword">new</span> Cookie(key, <span class="string">"value"</span> + i);</div><div class="line"><span class="comment">// 设置过期时间</span></div><div class="line">c.setMaxAge(<span class="number">3600</span>);</div><div class="line"><span class="comment">// 设置路径，类似于域名的概念。将主站或各个子站的cookie分开管理</span></div><div class="line">c.setPath(req.getContextPath() + <span class="string">"/"</span>);</div><div class="line">resp.addCookie(c);</div><div class="line"><span class="comment">// 获取cookie，通过request拿到的是cookie的数组集合</span></div><div class="line"><span class="comment">// 所以要查询cookie时只需要遍历这个集合就可以了</span></div><div class="line">Cookie[] cookies = req.getCookies();</div><div class="line"><span class="keyword">for</span> (Cookie cookie : cookies) &#123;</div><div class="line">  <span class="keyword">if</span>(cookie.getName().equals(<span class="string">"abc"</span>)) &#123;</div><div class="line">    System.out.println(cookie.getValue());</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>以下是封装的cookie操作相关的工具类，实现获取所有cookie、通过key查询cookie等功能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CookieUtil</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">//获取所有的key,返回List&lt;String&gt;</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">getKeys</span><span class="params">(Cookie[] cookies)</span></span>&#123;</div><div class="line">        List&lt;String&gt; keys = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        <span class="keyword">if</span> (cookies == <span class="keyword">null</span>) <span class="keyword">return</span> keys;</div><div class="line">        <span class="keyword">for</span> (Cookie cookie : cookies) &#123;</div><div class="line">            keys.add(cookie.getName());</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> keys;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//通过key返回一个cookie</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Cookie <span class="title">getCookieByKey</span><span class="params">(String key, Cookie[] cookies)</span></span>&#123;</div><div class="line">        Cookie c = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">if</span> (cookies == <span class="keyword">null</span>) <span class="keyword">return</span> c;</div><div class="line">        <span class="keyword">for</span> (Cookie cookie : cookies) &#123;</div><div class="line">            <span class="keyword">if</span> (cookie.getName().equals(key))&#123;</div><div class="line">                c = cookie;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> c;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//判断此key是否在cookie数组中</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isExistKey</span><span class="params">(String key, Cookie[] cookies)</span></span>&#123;</div><div class="line">        List&lt;String&gt; keys = getKeys(cookies);</div><div class="line">        <span class="keyword">return</span> keys.contains(key);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h4><p>不能跨浏览器，不支持中文</p>
<h3 id="session"><a href="#session" class="headerlink" title="session"></a>session</h3><h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//自动添加session</span></div><div class="line">HttpSession session = req.getSession();</div><div class="line">session.setAttribute(<span class="string">"cart"</span>, <span class="string">"abc"</span>);</div><div class="line"><span class="comment">//清空此session</span></div><div class="line">req.getSession().invalidate();</div></pre></td></tr></table></figure>
<h4 id="失效时间"><a href="#失效时间" class="headerlink" title="失效时间"></a>失效时间</h4><p>有三种方式可以设置session的失效时间。优先级分别是java代码&gt;项目中配置&gt;tomcat中配置</p>
<ul>
<li><p>web容器中设置</p>
<p>tomcat的conf目录下的web.xml文件中，时间单位为分钟</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- ==================== Default Session Configuration ================= --&gt;</span></div><div class="line"><span class="comment">&lt;!-- You can set the default session timeout (in minutes) for all newly   --&gt;</span></div><div class="line"><span class="comment">&lt;!-- created sessions by modifying the value below.                       --&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">session-config</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">session-timeout</span>&gt;</span>30<span class="tag">&lt;/<span class="name">session-timeout</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">session-config</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>项目的web.xml中配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--设置session的过期时间，单位为分钟--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">session-config</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">session-timeout</span>&gt;</span>30<span class="tag">&lt;/<span class="name">session-timeout</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">session-config</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>java代码设置，时间单位为秒</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">HttpSession session = req.getSession();</div><div class="line">session.setMaxInactiveInterval(<span class="number">30</span> * <span class="number">60</span>);</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="钝化和活化"><a href="#钝化和活化" class="headerlink" title="钝化和活化"></a>钝化和活化</h4><p>session的活化与钝化就是当用户访问时网站异常，不能丢掉session，钝化时采用文件的方式保存session，恢复时再通过文件活化到内存中。如果要实现此目标首先需要保存的对象可以被序列化，另外还要有类去进读取和写入。所以被钝化的对象需要实现两个接口：Serializable和HttpSessionActivationListener</p>
<p>Serializable为序列化接口，没有什么好说的。说一说HttpSessionActivationListener接口，实现此接口的JavaBean,可以感知自己被活化(从硬盘到内存)和钝化(从内存到硬盘)的过程，包含两个方法分别可以在钝化和活化时做另外的处理。以下为实现：</p>
<ul>
<li><p>要钝化的JavaBean必须实现两个接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person2</span> <span class="keyword">implements</span> <span class="title">HttpSessionActivationListener</span>,<span class="title">Serializable</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</div><div class="line">    <span class="keyword">private</span> String name;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person2</span><span class="params">()</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person2</span><span class="params">(<span class="keyword">int</span> id, String name)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.id = id;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> id;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.id = id;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionWillPassivate</span><span class="params">(HttpSessionEvent httpSessionEvent)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"钝化,写入磁盘"</span>);</div><div class="line">        <span class="comment">//web 下面新建 Meta-inf 目录 ,新建Context.xml文件</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionDidActivate</span><span class="params">(HttpSessionEvent httpSessionEvent)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"活化,写入内存"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>文件配置</p>
<p>web目录下创建META-INF目录并添加context.xml配置文件。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">Context</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- maxIdleSwap :1分钟 如果session不使用就会序列化到硬盘. directory :d:\a 序列化到硬盘的文件存放的位置. --&gt;</span></div><div class="line">    <span class="comment">&lt;!--saveOnRestart －当服务器关闭时是否要将所有的session持久化--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">Manager</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.session.PersistentManager"</span></span></div><div class="line">             <span class="attr">maxIdleSwap</span>=<span class="string">"1"</span> <span class="attr">saveOnRestart</span>=<span class="string">"true"</span>&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">Store</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.session.FileStore"</span></span></div><div class="line">               <span class="attr">directory</span>=<span class="string">"d:\a"</span> /&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">Manager</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">Context</span>&gt;</span></div></pre></td></tr></table></figure>
<p>​</p>
</li>
</ul>
<h4 id="域对象"><a href="#域对象" class="headerlink" title="域对象"></a>域对象</h4><p>前面陆续介绍了javaweb的两个域对象：ServletContext和Request。Session也是四大域对象之一。</p>
<p>此域对象的作用范围是一次会话。生命周期是在第一次调用request.getSession()方法时，服务器会检查是否已经有对应的session,如果没有就在内存中创建一个session并返回。当一段时间内session没有被使用（默认为30分钟），则服务器会销毁该session。如果服务器非正常关闭（强行关闭），没有到期的session也会跟着销毁。如果调用session提供的invalidate（） ，可以立即销毁session。</p>
<p>注意：服务器正常关闭，再启动，Session对象会进行钝化和活化操作。同时如果服务器钝化的时间在session 默认销毁时间之内，则活化后session还是存在的。否则Session不存在。  如果JavaBean 数据在session钝化时，没有实现Serializable 则当Session活化时，会消失</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://xxyxpy.pub/2017/07/26/java/web/web-03Cookie,Session/" data-id="cjblrl7fi005gqwhq0b48lcg6" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-java/web/web-02Request,Response" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/07/25/java/web/web-02Request,Response/">web-02Request，Response</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/07/25/java/web/web-02Request,Response/">
            <time datetime="2017-07-25T07:12:12.390Z" itemprop="datePublished">2017-07-25</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/java/">java</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/java/web/">web</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/java/">java</a>, <a class="tag-link" href="/tags/request/">request</a>, <a class="tag-link" href="/tags/response/">response</a>, <a class="tag-link" href="/tags/web/">web</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h2 id="request"><a href="#request" class="headerlink" title="request"></a>request</h2><h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><p>获取浏览器发送过来的数据</p>
<h3 id="内容组成"><a href="#内容组成" class="headerlink" title="内容组成"></a>内容组成</h3><p>请求行，请求头，请求体</p>
<h3 id="操作请求行"><a href="#操作请求行" class="headerlink" title="操作请求行"></a>操作请求行</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 获取请求方式</span></div><div class="line">String method = req.getMethod();</div><div class="line"><span class="comment">// 获取ip地址</span></div><div class="line">String ip = req.getRemoteAddr();</div><div class="line"><span class="comment">// 在java中获取项目名称</span></div><div class="line">String projectName = req.getContextPath();</div><div class="line"><span class="comment">// 获取的是 从项目名到参数之前的内容  /servlet_test/regist</span></div><div class="line">String uri = req.getRequestURI();</div><div class="line"><span class="comment">// getRequestURL 获取的带协议的完整路径   http://localhost/servlet_test/regist</span></div><div class="line">String url = req.getRequestURL().toString();</div><div class="line"><span class="comment">// get请求的所有参数   username=tom&amp;password=123</span></div><div class="line">String queryString = req.getQueryString();</div><div class="line"><span class="comment">// 获取协议和版本 如：HTTP/1.1</span></div><div class="line">String protocol = req.getProtocol();</div></pre></td></tr></table></figure>
<h3 id="操作请求头"><a href="#操作请求头" class="headerlink" title="操作请求头"></a>操作请求头</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// String getHeader(String key):通过key获取指定的value (一个)</span></div><div class="line"><span class="comment">// user-agent:浏览器内核 msie firefox chrome</span></div><div class="line"><span class="comment">// referer:页面从那里来 防盗链</span></div><div class="line">String agent = req.getHeader(<span class="string">"user-agent"</span>);</div><div class="line">String referer = req.getHeader(<span class="string">"referer"</span>);</div><div class="line">String temp = <span class="string">""</span>;</div><div class="line"><span class="keyword">if</span> (referer == <span class="keyword">null</span>)&#123;</div><div class="line">  temp = <span class="string">"地址栏"</span>;</div><div class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (referer.contains(<span class="string">"localhost"</span>))&#123;</div><div class="line">  System.out.println(<span class="string">"自己"</span>);</div><div class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(referer.contains(<span class="string">"192.168."</span>))&#123;</div><div class="line">  <span class="comment">// 假设内网地址是192.168开始，当然也有10.开始</span></div><div class="line">  System.out.println(<span class="string">"内网"</span>);</div><div class="line">&#125;<span class="keyword">else</span>&#123;</div><div class="line">  System.out.println(<span class="string">"盗链"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="操作请求参数"><a href="#操作请求参数" class="headerlink" title="操作请求参数"></a>操作请求参数</h3><p>假设请求参数为：username=tom&amp;password=123&amp;hobby=drink&amp;hobby=sleep</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 获取单个值</span></div><div class="line">String username = req.getParameter(<span class="string">"username"</span>);</div><div class="line"><span class="comment">// 通过一个key获取多个值，一般用于多选的控件</span></div><div class="line">String[] hobbies = req.getParameterValues(<span class="string">"hobby"</span>);</div><div class="line"><span class="comment">// 获取所有的参数和值，放在一个map集合中</span></div><div class="line">Map&lt;String, String[]&gt; parameterMap = req.getParameterMap();</div></pre></td></tr></table></figure>
<h3 id="请求转发"><a href="#请求转发" class="headerlink" title="请求转发"></a>请求转发</h3><p>指的是服务器内部的转发行为，发生在不同的servlet之间的。一般需要传递原servlet的request和response对象。</p>
<p>转发时指定的path不需要包含项目名称，直接用web.xml中配置的路径即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">resp.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</div><div class="line">req.setAttribute(<span class="string">"newName"</span>, <span class="string">"heihei"</span>);</div><div class="line"><span class="comment">// 设置的newName的值会经过请求转发发送到另外一个servlet中</span></div><div class="line">req.getRequestDispatcher(<span class="string">"reqTrans2"</span>).forward(req, resp);</div></pre></td></tr></table></figure>
<ul>
<li>请求转发和重定向的区别<ul>
<li>重定向发送两次请求,请求转发一次请求</li>
<li>重定向是从浏览器发送,请求转发是服务器内部</li>
<li>重定向原来的request域对象销毁,请求转发可以使用原来的request域对象</li>
<li>重定向是response的方法,请求转发是request的方法</li>
<li>重定向可以请求站外资源,请求转发不可以</li>
</ul>
</li>
</ul>
<h3 id="域对象"><a href="#域对象" class="headerlink" title="域对象"></a>域对象</h3><p>上一次讲到了servlet的第一个域对象ServletContext。Request是第二个域对象。</p>
<p>作用范围是整个请求链（请求转发也存在）；生命周期是在service方法调用前由服务器创建，传入service方法。</p>
<p>整个请求结束，request生命结束。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">req.setAttribute(<span class="string">"newName"</span>, <span class="string">"heihei"</span>);</div><div class="line">String newName = req.getAttribute(<span class="string">"newName"</span>).toString();</div></pre></td></tr></table></figure>
<h2 id="response"><a href="#response" class="headerlink" title="response"></a>response</h2><h3 id="作用-1"><a href="#作用-1" class="headerlink" title="作用"></a>作用</h3><p>给浏览器返回响应信息</p>
<h3 id="内容组成-1"><a href="#内容组成-1" class="headerlink" title="内容组成"></a>内容组成</h3><p>响应行，响应头，响应体</p>
<h3 id="响应的状态码"><a href="#响应的状态码" class="headerlink" title="响应的状态码"></a>响应的状态码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 设置一般响应状态</span></div><div class="line">resp.setStatus(<span class="keyword">int</span>);</div><div class="line"><span class="comment">// 设置错误响应，一般用于error类的，比如4XX和5XX</span></div><div class="line">resp.sendError(<span class="keyword">int</span>);</div><div class="line"><span class="comment">// 重定向，传入重定向的地址</span></div><div class="line">resp.sendRedirect(<span class="string">"/servlet_test/show"</span>);</div></pre></td></tr></table></figure>
<p>常见的状态码：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">1xx:已发送请求</div><div class="line">2xx:已完成响应</div><div class="line">200:正常响应</div><div class="line">3xx:还需浏览器进一步操作</div><div class="line">302:重定向 配合响应头:location</div><div class="line">304:读缓存</div><div class="line">4xx:用户操作错误</div><div class="line">404:用户操作错误.</div><div class="line">405:访问的方法不存在</div><div class="line">5xx:服务器错误</div><div class="line">500:内部异常</div></pre></td></tr></table></figure>
<h3 id="操作响应头"><a href="#操作响应头" class="headerlink" title="操作响应头"></a>操作响应头</h3><p>常用方法</p>
<ul>
<li><strong>setHeader(String key,String value):设置字符串形式的响应头</strong></li>
<li>setIntHeader(String key,int value):设值整形的响应头</li>
<li>setDateHeader(String key,long value):设值时间的响应头</li>
<li><strong>addHeader(String key,String value):添加置字符串形式的响应头 之前设置过则追加,若没有设置过则设置</strong></li>
<li>addIntHeader(String key,int value):添加整形的响应头</li>
<li>addDateHeader(String key,long value):添加时间的响应头</li>
</ul>
<p>常用的响应头</p>
<ul>
<li>location:重定向</li>
<li>refresh:定时刷新</li>
<li>content-type:设置文件的mime类型，以及响应流的编码</li>
<li>content-disposition:文件下载</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 响应头设置自动刷新</span></div><div class="line">resp.setHeader(<span class="string">"Refresh"</span>, <span class="string">"2;url=/servlet_test/show"</span>);</div><div class="line"><span class="comment">// 文件下载响应头</span></div><div class="line">resp.setHeader(<span class="string">"content-disposition"</span>, <span class="string">"attachment;filename="</span>+_filename);</div></pre></td></tr></table></figure>
<h3 id="操作响应体"><a href="#操作响应体" class="headerlink" title="操作响应体"></a>操作响应体</h3><p>页面上要展示的内容。常用两种流进行输出，字符流和字节流。字节流一般用于文件下载。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 字符流</span></div><div class="line">resp.getWriter();</div><div class="line"><span class="comment">// 字节流</span></div><div class="line">resp.getOutputStream();</div></pre></td></tr></table></figure>
<h2 id="文件下载功能实现"><a href="#文件下载功能实现" class="headerlink" title="文件下载功能实现"></a>文件下载功能实现</h2><p>通过响应字节流来实现文件下载的功能。</p>
<p>html文件dowload.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>文件下载<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/servlet_test/download?name=2.txt"</span>&gt;</span>2.txt<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/servlet_test/download?name=我是.txt"</span>&gt;</span>我是.txt<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>DownServlet.java。这里使用commons.io工具来进行流的拷贝，返回输出的是字节流</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</div><div class="line">        <span class="comment">//获取下载的文件名</span></div><div class="line">        String fileName = req.getParameter(<span class="string">"name"</span>);</div><div class="line">        <span class="comment">//注意中文乱码:</span></div><div class="line">        <span class="comment">//fileName = new String(fileName.getBytes("iso8859-1"), "utf-8");</span></div><div class="line">        <span class="comment">//设置MIME类型</span></div><div class="line">        ServletContext servletContext = getServletContext();</div><div class="line">        String mimeType = servletContext.getMimeType(fileName);</div><div class="line">        resp.setContentType(mimeType);</div><div class="line">        <span class="comment">// 通过工具类编码</span></div><div class="line">        String _filename= DownLoadUtils.getName(req.getHeader(<span class="string">"user-agent"</span>), fileName);</div><div class="line">        resp.setHeader(<span class="string">"content-disposition"</span>, <span class="string">"attachment;filename="</span>+_filename);</div><div class="line"></div><div class="line">        <span class="comment">//流拷贝</span></div><div class="line">        <span class="comment">//1)生写</span></div><div class="line">        ServletOutputStream os = resp.getOutputStream();</div><div class="line">        InputStream is = servletContext.getResourceAsStream(<span class="string">"/download/"</span> + fileName);</div><div class="line">        <span class="comment">/*byte[] b = new byte[1024];</span></div><div class="line">        int len = -1;</div><div class="line">        while ((len = is.read(b)) != -1) &#123;</div><div class="line">            os.write(b, 0, len);</div><div class="line">        &#125;</div><div class="line">        os.flush();*/</div><div class="line">        <span class="comment">//2)使用第三方工具类</span></div><div class="line">        IOUtils.copy(is, os);</div><div class="line">        is.close();</div><div class="line">        os.close();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>DownLoadUtils.java 编码转换，防止文件名中文乱码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownLoadUtils</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getName</span><span class="params">(String agent, String filename)</span> <span class="keyword">throws</span> UnsupportedEncodingException </span>&#123;</div><div class="line">        <span class="keyword">if</span> (agent.contains(<span class="string">"MSIE"</span>)) &#123;</div><div class="line">            <span class="comment">// IE浏览器</span></div><div class="line">            filename = URLEncoder.encode(filename, <span class="string">"utf-8"</span>);</div><div class="line">            filename = filename.replace(<span class="string">"+"</span>, <span class="string">" "</span>);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (agent.contains(<span class="string">"Firefox"</span>)) &#123;</div><div class="line">            <span class="comment">// 火狐浏览器</span></div><div class="line">            BASE64Encoder base64Encoder = <span class="keyword">new</span> BASE64Encoder();</div><div class="line">            filename = <span class="string">"=?utf-8?B?"</span> + base64Encoder.encode(filename.getBytes(<span class="string">"utf-8"</span>)) + <span class="string">"?="</span>;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="comment">// 其它浏览器</span></div><div class="line">            filename = URLEncoder.encode(filename, <span class="string">"utf-8"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> filename;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>web.xml中的配置 </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DownServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.servlet.rr.DownServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DownServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/download<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="验证码功能实现"><a href="#验证码功能实现" class="headerlink" title="验证码功能实现"></a>验证码功能实现</h2><p>实现点击后验证码自动重新生成</p>
<p>jsp文件。code.jsp</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %&gt;</div><div class="line">&lt;html&gt;</div><div class="line">  &lt;head&gt;</div><div class="line">    &lt;title&gt;$Title$&lt;/title&gt;</div><div class="line">  &lt;/head&gt;</div><div class="line">  &lt;body&gt;</div><div class="line">    &lt;div&gt;&lt;img alt="验证码" src="code" title="看不清除,换一张" onclick="changeImg(this)"&gt;&lt;/div&gt;</div><div class="line">  &lt;script&gt;</div><div class="line">      function changeImg(obj) &#123;</div><div class="line">          // 通过随机数src的方式才能实现刷新功能</div><div class="line">          obj.src = "$&#123;pageContext.request.contextPath&#125;/code?i=" + Math.random();</div><div class="line">      &#125;</div><div class="line">  &lt;/script&gt;</div><div class="line">  &lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<p>图片流生成的类CodeServlet.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CodeServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</div><div class="line">        <span class="comment">// 使用java图形界面技术绘制一张图片</span></div><div class="line">        <span class="keyword">int</span> charNum = <span class="number">4</span>;</div><div class="line">        <span class="keyword">int</span> width = <span class="number">30</span> * charNum;</div><div class="line">        <span class="keyword">int</span> height = <span class="number">30</span>;</div><div class="line"></div><div class="line">        <span class="comment">// 1. 创建一张内存图片</span></div><div class="line">        BufferedImage bufferedImage = <span class="keyword">new</span> BufferedImage(width, height, BufferedImage.TYPE_INT_RGB);</div><div class="line"></div><div class="line">        <span class="comment">// 2.获得绘图对象</span></div><div class="line">        Graphics graphics = bufferedImage.getGraphics();</div><div class="line"></div><div class="line">        <span class="comment">// 3、绘制背景颜色</span></div><div class="line">        graphics.setColor(Color.YELLOW);</div><div class="line">        graphics.fillRect(<span class="number">0</span>, <span class="number">0</span>, width, height);</div><div class="line"></div><div class="line">        <span class="comment">// 4、绘制图片边框</span></div><div class="line">        graphics.setColor(Color.BLUE);</div><div class="line">        graphics.drawRect(<span class="number">0</span>, <span class="number">0</span>, width - <span class="number">1</span>, height - <span class="number">1</span>);</div><div class="line"></div><div class="line">        <span class="comment">// 5、输出验证码内容</span></div><div class="line">        graphics.setColor(Color.RED);</div><div class="line">        graphics.setFont(<span class="keyword">new</span> Font(<span class="string">"宋体"</span>, Font.BOLD, <span class="number">20</span>));</div><div class="line"></div><div class="line">        <span class="comment">// 随机输出4个字符</span></div><div class="line">        Graphics2D graphics2d = (Graphics2D) graphics;</div><div class="line">      	<span class="comment">// 去掉容易混淆的数字及字母</span></div><div class="line">        String s = <span class="string">"ABCDEFGHGKLMNPQRSTUVWXYZ23456789"</span>;</div><div class="line">        Random random = <span class="keyword">new</span> Random();</div><div class="line">        <span class="comment">// session中要用到，要校验是否正确的话需要保存在session中</span></div><div class="line">        String msg = <span class="string">""</span>;</div><div class="line">        <span class="keyword">int</span> x = <span class="number">5</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; charNum; i++) &#123;</div><div class="line">            <span class="keyword">int</span> index = random.nextInt(<span class="number">32</span>);</div><div class="line">            String content = String.valueOf(s.charAt(index));</div><div class="line">            msg += content;</div><div class="line">            <span class="keyword">double</span> theta = random.nextInt(<span class="number">45</span>) * Math.PI / <span class="number">180</span>;</div><div class="line">            <span class="comment">// 让字体扭曲</span></div><div class="line">            graphics2d.rotate(theta, x, <span class="number">18</span>);</div><div class="line">            graphics2d.drawString(content, x, <span class="number">18</span>);</div><div class="line">            graphics2d.rotate(-theta, x, <span class="number">18</span>);</div><div class="line">            x += <span class="number">30</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// 6、绘制干扰线</span></div><div class="line">        graphics.setColor(Color.GRAY);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</div><div class="line">            <span class="keyword">int</span> x1 = random.nextInt(width);</div><div class="line">            <span class="keyword">int</span> x2 = random.nextInt(width);</div><div class="line"></div><div class="line">            <span class="keyword">int</span> y1 = random.nextInt(height);</div><div class="line">            <span class="keyword">int</span> y2 = random.nextInt(height);</div><div class="line">            graphics.drawLine(x1, y1, x2, y2);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// 释放资源</span></div><div class="line">        graphics.dispose();</div><div class="line"></div><div class="line">        <span class="comment">// 图片输出 ImageIO</span></div><div class="line">        ImageIO.write(bufferedImage, <span class="string">"jpg"</span>, resp.getOutputStream());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>web.xml配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>CodeServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.servlet.rr.CodeServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>CodeServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/code<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></div></pre></td></tr></table></figure>
        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://xxyxpy.pub/2017/07/25/java/web/web-02Request,Response/" data-id="cjblrl7fd0059qwhq4ndvlnep" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-java/web/web-01Servlet" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/07/24/java/web/web-01Servlet/">web-01Servlet</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/07/24/java/web/web-01Servlet/">
            <time datetime="2017-07-24T06:25:25.025Z" itemprop="datePublished">2017-07-24</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/java/">java</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/java/web/">web</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/java/web/servlet/">servlet</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/java/">java</a>, <a class="tag-link" href="/tags/web/">web</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h3 id="什么是servlet"><a href="#什么是servlet" class="headerlink" title="什么是servlet?"></a>什么是<a href="https://baike.baidu.com/item/servlet/477555" target="_blank" rel="external">servlet</a>?</h3><p>Servlet（Server Applet）是Java Servlet的简称，是为小服务程序或服务连接器，用Java编写的服务器端程序，主要功能在于交互式地浏览和修改数据，生成动态Web内容。</p>
<h3 id="编写一个servlet"><a href="#编写一个servlet" class="headerlink" title="编写一个servlet"></a>编写一个servlet</h3><ul>
<li><p>新建类继承<code>HttpServlet</code>.重写<code>doPost</code>或<code>doGet</code>方法.分别对应post和get请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</div><div class="line">        <span class="comment">// 获取请求参数</span></div><div class="line">        String userName = req.getParameter(<span class="string">"userName"</span>);</div><div class="line">        String passWord = req.getParameter(<span class="string">"password"</span>);</div><div class="line">        <span class="comment">// 设置响应类型和字符编码</span></div><div class="line">        resp.setContentType(<span class="string">"text/html; charset=utf-8"</span>);</div><div class="line">        <span class="comment">// 响应</span></div><div class="line">        resp.getWriter().print(<span class="string">"userName:"</span> + userName + <span class="string">"; passWord:"</span> + passWord);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</div><div class="line">        doGet(req, resp);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>编写配置文件web.xml(web-inf目录下).配置servlet和servlet-mapping</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.servlet.use.HelloServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></div><div class="line">  <span class="comment">&lt;!--表示加载顺序--&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>2<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/hello<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>浏览器中请求此servlet路径</p>
<p>部署项目名为：servlet</p>
<blockquote>
<p><a href="http://localhost:8080/servlet/hello?userName=张三&amp;password=123456" target="_blank" rel="external">http://localhost:8080/servlet/hello?userName=张三&amp;password=123456</a></p>
</blockquote>
<img title="servlet_hello" alt="servlet_hello" src="http://oo0vldwkt.bkt.clouddn.com/static/images/java\web\01servlet_hello.png">
<p>​</p>
</li>
</ul>
<h3 id="接收和回写"><a href="#接收和回写" class="headerlink" title="接收和回写"></a>接收和回写</h3><ul>
<li><p>接收处理参数</p>
<p>这里先简单的说一下如何去接收请求参数,具体的更详情内容放在request中描述。</p>
<p>参数的传递是通过key-value的方式进行的,所以在获取值的时候用<code>getParameter(key)</code>即可,需要说明的是所有的参数都是以字符串进行传递的</p>
</li>
<li><p>回写内容</p>
<p>通过<code>Response</code>对象中的<code>PrinterWriter</code>对象进行回写操作，设置返回的内容格式和编码。具体内容放在response中描述。</p>
</li>
<li><p>乱码问题</p>
<p>无论是请求还是响应都会有乱码问题，响应时指定编码格式为utf-8即可解决响应中文的编码，如上面的<code>resp.setContentType(&quot;text/html; charset=utf-8&quot;)</code>。</p>
<p>对于请求的乱码根据请求方式的不同处理方式也不一样:</p>
<ul>
<li>get请求：new String(参数.getBytes(“iso-8859-1”),”utf-8”)，但此方法并不适用所有的环境，本地；java8+tomcat8不添加也不产生乱码。</li>
<li>post请求：request.setCharacterEncoding(“utf-8”)</li>
</ul>
</li>
</ul>
<h3 id="servlet体系结构"><a href="#servlet体系结构" class="headerlink" title="servlet体系结构"></a>servlet体系结构</h3><ul>
<li><p>类层次结构</p>
<p>Servlet接口→GenericServlet抽象类→HttpServlet抽象类→自定义Servlet</p>
</li>
<li><p>常用方法</p>
<p>Servlet接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 初始化</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(ServletConfig config)</span></span>;</div><div class="line"><span class="comment">// 服务 处理业务逻辑，最重要的方法。请求过来时service方法最先被调用</span></div><div class="line"><span class="comment">// 具体可参考http://java-admin.iteye.com/blog/194455</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest request,ServletResponse response)</span></span>;</div><div class="line"><span class="comment">// 销毁</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span></span>;</div><div class="line"><span class="comment">// 获取当前servlet的配置对象</span></div><div class="line"><span class="function">ServletConfig <span class="title">getServletConfig</span><span class="params">()</span></span>;</div></pre></td></tr></table></figure>
<p>GenericServlet抽象类</p>
<ul>
<li>实现除<code>service</code>方法外的所有接口方法；</li>
<li><code>init</code>和<code>destroy</code>方法都是空实现，有相应业务场景时重写即可。</li>
</ul>
<p>HttpServlet抽象类</p>
<ul>
<li>对<code>service</code>方法做了实现，实际上请求过来时是调用的<code>service</code>方法。自定义servlet时只需要重写<code>doXX</code>方法即可。程序根据请求类型来判断走哪一个do方法。</li>
</ul>
</li>
</ul>
<h3 id="servlet生命周期"><a href="#servlet生命周期" class="headerlink" title="servlet生命周期"></a>servlet生命周期</h3><p>serlvet是单实例多线程<br>默认第一次访问的时候,服务器创建servlet,并调用init实现初始化操作.并调用一次service方法<br>每当请求来的时候,服务器创建一个线程,调用service方法执行自己的业务逻辑<br>当serlvet被移除的时候服务器正常关闭的时候,服务器调用servlet的destroy方法实现销毁操作.</p>
<ul>
<li><p>void init(ServletConfig config):初始化</p>
<p>只执行一次，默认在第一次访问时执行</p>
</li>
<li><p>void service(ServletRequest request,ServletResponse response):服务 处理业务逻辑</p>
<p>请求过来的时候请求一次执行一次</p>
</li>
<li><p>void destroy():销毁</p>
<p>只执行一次，在servelet被移除或服务器正常关闭时</p>
</li>
</ul>
<h3 id="url路径匹配"><a href="#url路径匹配" class="headerlink" title="url路径匹配"></a>url路径匹配</h3><p>优先级 完全匹配&gt;目录匹配&gt;后缀名匹配</p>
<ul>
<li><p>完全匹配</p>
<p>必须以”/“开始。例如：/hello /a/b/c</p>
</li>
<li><p>目录匹配</p>
<p>必须以”/“开始，以”*“结束。例如：/a/* /*</p>
</li>
<li><p>后缀名匹配</p>
<p>以”*“开始，以字符结尾。例如：*.jsp *.do *.action</p>
</li>
</ul>
<h3 id="ServletConfig"><a href="#ServletConfig" class="headerlink" title="ServletConfig"></a>ServletConfig</h3><p>servlet的配置对象，在创建servlet的同时进行创建，通过<code>getServletConfig()</code>方法获取。主要有以下作用：</p>
<ul>
<li>获取当前servlet的名称</li>
<li>获取当前servlet的初始化参数。放在了Enumeration<string>中，需要遍历</string></li>
<li>获取全局管理者ServletContext</li>
</ul>
<p>web.xml配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>ShowServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.servlet.use.ShowServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>user<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>root<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>password<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>1234<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>ShowServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/show<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Servlet中使用ServletConfig</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//获取ServletConfig</span></div><div class="line">ServletConfig config = getServletConfig();</div><div class="line">String servletName = config.getServletName();</div><div class="line">String user = config.getInitParameter(<span class="string">"user"</span>);</div><div class="line">Enumeration&lt;String&gt; initParameterNames = config.getInitParameterNames();</div><div class="line">writer.write(<span class="string">"&lt;h4&gt;ServletName:"</span> + servletName + <span class="string">"&lt;h4&gt;"</span>);</div><div class="line">writer.write(<span class="string">"&lt;h4&gt;user:"</span> + user + <span class="string">"&lt;h4&gt;"</span>);</div><div class="line"><span class="keyword">while</span> (initParameterNames.hasMoreElements())&#123;</div><div class="line">  String p = initParameterNames.nextElement();</div><div class="line">  writer.write(<span class="string">"&lt;h4&gt;"</span> + p + <span class="string">":"</span> + config.getInitParameter(p) + <span class="string">"&lt;h4&gt;"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>输出：</p>
<blockquote>
<p>ServletName:ShowServlet<br>user:root<br>password:1234<br>user:root</p>
</blockquote>
<h3 id="ServletContext"><a href="#ServletContext" class="headerlink" title="ServletContext"></a>ServletContext</h3><p>一个项目的引用，代表了当前项目。使用get</p>
<p>当项目启动时，服务器为每一个web项目创建一个ServletContext对象。</p>
<p>当项目移除或服务器关闭的时候销毁。主要作用：</p>
<ul>
<li><p>获取全局初始化参数</p>
<p>在根标签下使用context-param子标签 用来存放初始化参数</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>获取共享资源数据</p>
<p>作为域对象，设置和获取的是全局的属性。内部是<code>LinkedHashMap</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ServletContext sc = getServletContext();</div><div class="line"><span class="keyword">int</span> count = Integer.valueOf(sc.getAttribute(<span class="string">"count"</span>).toString());</div><div class="line">sc.setAttribute(<span class="string">"count"</span>, ++count);</div></pre></td></tr></table></figure>
</li>
<li><p>获取文件资源</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//ServletContext使用</span></div><div class="line"><span class="comment">//获取运行路径 "/"表示应用在tomcat中的根路径</span></div><div class="line">writer.write(<span class="string">"&lt;h4&gt;运行路径:"</span> + sc.getRealPath(<span class="string">"/"</span>) + <span class="string">"&lt;h4&gt;"</span>);</div><div class="line">writer.write(<span class="string">"&lt;h4&gt;运行路径:"</span> + sc.getRealPath(<span class="string">"/WEB-INF/web.xml"</span>) + <span class="string">"&lt;h4&gt;"</span>);</div><div class="line"><span class="comment">//以流的形式返回一个文件</span></div><div class="line">InputStream inputStream = sc.getResourceAsStream(<span class="string">"/2.txt"</span>);</div><div class="line">System.out.println(inputStream);</div><div class="line"><span class="comment">//获取文件的mime类型,此类型的集合配置在tomcat的web.xml中</span></div><div class="line">writer.write(<span class="string">"&lt;h4&gt;2.txt的类型:"</span> + sc.getMimeType(<span class="string">"2.txt"</span>) + <span class="string">"&lt;h4&gt;"</span>);</div></pre></td></tr></table></figure></li>
</ul>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://xxyxpy.pub/2017/07/24/java/web/web-01Servlet/" data-id="cjblrl7fb0055qwhqy7g87vse" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-java/tool/获取泛型参数的Class对象" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/07/21/java/tool/获取泛型参数的Class对象/">获取泛型参数的Class对象</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/07/21/java/tool/获取泛型参数的Class对象/">
            <time datetime="2017-07-21T05:29:08.534Z" itemprop="datePublished">2017-07-21</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/java/">java</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/java/tool/">tool</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/java/">java</a>, <a class="tag-link" href="/tags/泛型/">泛型</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>在三层架构中的Dao层对于CRUD的处理方法基本相同.如会有save,add,update,delete,查询列表等.基于此可以封装一个Dao层的基类BaseDao,泛型结构的.T为实际要操作的JavaBean.</p>
<p>对于save,add等方法的提取非常的简单,参数直接用泛型怼上去就行.如:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">save</span><span class="params">(T t)</span></span>&#123;</div><div class="line">  <span class="comment">// 使用orm进行保存.比如hibernate</span></div><div class="line">  <span class="keyword">this</span>.getHibernateTemplate().save(t);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>但是对于其它的如查询所有的T对应的记录在hibernate中就需要用到T的类名.</p>
<h3 id="处理"><a href="#处理" class="headerlink" title="处理"></a>处理</h3><p><code>BaseDao</code>类,Dao层基类,泛型类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.lang.reflect.ParameterizedType;</div><div class="line"><span class="keyword">import</span> java.lang.reflect.Type;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 假设为dao层的基类</div><div class="line"> * Created on 2017/7/21.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseDao</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">    </div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 泛型T的Class对象</div><div class="line">     * 在构造函数中获取该值</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> Class clazz;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BaseDao</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// 1.获取子类的Class对象,此处的this指向子类</span></div><div class="line">        Class c = <span class="keyword">this</span>.getClass();</div><div class="line">        <span class="comment">// 2.获取带有泛型的父类</span></div><div class="line">        <span class="comment">// Type是 Java 编程语言中所有类型的公共高级接口。</span></div><div class="line">        <span class="comment">// 它们包括原始类型、参数化类型、数组类型、类型变量和基本类型。</span></div><div class="line">        Type type = c.getGenericSuperclass();</div><div class="line">        System.out.println(<span class="string">"泛型父类:"</span> + type);</div><div class="line">        <span class="comment">// 3.获取参数化类型,即泛型</span></div><div class="line">        <span class="keyword">if</span> (type <span class="keyword">instanceof</span> ParameterizedType) &#123;</div><div class="line">            ParameterizedType p = (ParameterizedType) type;</div><div class="line">            <span class="comment">// 获取参数化类型的数组，泛型可能有多个</span></div><div class="line">            Type[] arguments = p.getActualTypeArguments();</div><div class="line">            clazz = (Class) arguments[<span class="number">0</span>];</div><div class="line">            System.out.println(<span class="string">"泛型T全限定名:"</span> + clazz.getName() + <span class="string">";类名:"</span> + clazz.getSimpleName());</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 假如此时执行一个Hql查询,需要用到泛型T的类名</div><div class="line">     * 查询所有数据</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findAll</span><span class="params">()</span> </span>&#123;</div><div class="line">        </div><div class="line">        System.out.println(<span class="string">"from "</span> + clazz.getSimpleName());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>子类<code>user</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 用户类</div><div class="line"> * Created on 2017/7/21.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">BaseDao</span>&lt;<span class="title">User</span>&gt; </span>&#123;</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo1</span> </span>&#123;</div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// 调用findAll方法查询所有记录</span></div><div class="line">        User u = <span class="keyword">new</span> User();</div><div class="line">        u.findAll();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p> 泛型父类:com.superclass.BaseDao<com.superclass.user></com.superclass.user></p>
<p>泛型T全限定名:com.superclass.User;类名:User</p>
<p>from User</p>
</blockquote>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://xxyxpy.pub/2017/07/21/java/tool/获取泛型参数的Class对象/" data-id="cjblrl7fa0052qwhqlfwl2oea" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-java/tool/流之间的互相转换" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/07/20/java/tool/流之间的互相转换/">流之间的互相转换</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/07/20/java/tool/流之间的互相转换/">
            <time datetime="2017-07-20T05:28:34.166Z" itemprop="datePublished">2017-07-20</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/java/">java</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/java/tool/">tool</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/io/">io</a>, <a class="tag-link" href="/tags/java/">java</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p><code>ConvertIOUtil</code>类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</div><div class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</div><div class="line"><span class="keyword">import</span> java.io.InputStream;</div><div class="line"><span class="keyword">import</span> java.io.OutputStream;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * io流之间的互相转换</div><div class="line"> * Created on 2017/7/10.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConvertIOUtil</span> </span>&#123;</div><div class="line">    <span class="comment">//inputStream转outputStream</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ByteArrayOutputStream <span class="title">parse</span><span class="params">(InputStream in)</span> <span class="keyword">throws</span> Exception</span></div><div class="line">    &#123;</div><div class="line">        ByteArrayOutputStream swapStream = <span class="keyword">new</span> ByteArrayOutputStream();</div><div class="line">        <span class="keyword">int</span> ch;</div><div class="line">        <span class="keyword">while</span> ((ch = in.read()) != -<span class="number">1</span>) &#123;</div><div class="line">            swapStream.write(ch);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> swapStream;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//outputStream转inputStream</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ByteArrayInputStream <span class="title">parse</span><span class="params">(OutputStream out)</span> <span class="keyword">throws</span> Exception</span></div><div class="line">    &#123;</div><div class="line">        ByteArrayOutputStream   baos=<span class="keyword">new</span>   ByteArrayOutputStream();</div><div class="line">        baos=(ByteArrayOutputStream) out;</div><div class="line">        ByteArrayInputStream swapStream = <span class="keyword">new</span> ByteArrayInputStream(baos.toByteArray());</div><div class="line">        <span class="keyword">return</span> swapStream;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//inputStream转String</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">parse_String</span><span class="params">(InputStream in)</span> <span class="keyword">throws</span> Exception</span></div><div class="line">    &#123;</div><div class="line">        ByteArrayOutputStream swapStream = <span class="keyword">new</span> ByteArrayOutputStream();</div><div class="line">        <span class="keyword">int</span> ch;</div><div class="line">        <span class="keyword">while</span> ((ch = in.read()) != -<span class="number">1</span>) &#123;</div><div class="line">            swapStream.write(ch);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> swapStream.toString();</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//OutputStream 转String</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">parse_String</span><span class="params">(OutputStream out)</span><span class="keyword">throws</span> Exception</span></div><div class="line">    &#123;</div><div class="line">        ByteArrayOutputStream   baos=<span class="keyword">new</span>   ByteArrayOutputStream();</div><div class="line">        baos=(ByteArrayOutputStream) out;</div><div class="line">        ByteArrayInputStream swapStream = <span class="keyword">new</span> ByteArrayInputStream(baos.toByteArray());</div><div class="line">        <span class="keyword">return</span> swapStream.toString();</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//String转inputStream</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ByteArrayInputStream <span class="title">parse_inputStream</span><span class="params">(String in)</span><span class="keyword">throws</span> Exception</span></div><div class="line">    &#123;</div><div class="line">        ByteArrayInputStream input=<span class="keyword">new</span> ByteArrayInputStream(in.getBytes());</div><div class="line">        <span class="keyword">return</span> input;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//String 转outputStream</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ByteArrayOutputStream <span class="title">parse_outputStream</span><span class="params">(String in)</span><span class="keyword">throws</span> Exception</span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> parse(parse_inputStream(in));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://xxyxpy.pub/2017/07/20/java/tool/流之间的互相转换/" data-id="cjblrl7f7004xqwhq03y30c87" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-java/tool/Java邮件发送" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/07/19/java/tool/Java邮件发送/">Java邮件发送</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/07/19/java/tool/Java邮件发送/">
            <time datetime="2017-07-19T06:01:40.574Z" itemprop="datePublished">2017-07-19</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/java/">java</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/java/tool/">tool</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/java/">java</a>, <a class="tag-link" href="/tags/mail/">mail</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h3 id="添加引用"><a href="#添加引用" class="headerlink" title="添加引用"></a>添加引用</h3><ul>
<li>mail.jar</li>
<li>activation.jar</li>
</ul>
<p>对于使用maven的项目添加如下的配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.mail<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mail<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.activation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="功能实现"><a href="#功能实现" class="headerlink" title="功能实现"></a>功能实现</h3><p><code>MailUtil</code>类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> javax.mail.Authenticator;</div><div class="line"><span class="keyword">import</span> javax.mail.Message;</div><div class="line"><span class="keyword">import</span> javax.mail.Transport;</div><div class="line"><span class="keyword">import</span> javax.mail.internet.InternetAddress;</div><div class="line"><span class="keyword">import</span> javax.mail.internet.MimeMessage;</div><div class="line"><span class="keyword">import</span> java.util.Properties;</div><div class="line"><span class="keyword">import</span> java.util.ResourceBundle;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 发送邮件工具类</div><div class="line"> * Created on 2017/7/14.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MailUtil</span> </span>&#123;</div><div class="line">        </div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SMTP_MAIL_HOST;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String EMAIL_USERNAME;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String EMAIL_PASSWORD;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String EMAIL_FROM;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String EMAIL_TO;</div><div class="line">    </div><div class="line">    <span class="keyword">static</span> &#123;</div><div class="line">        ResourceBundle rb = ResourceBundle.getBundle(<span class="string">"other_config"</span>);</div><div class="line">        SMTP_MAIL_HOST = rb.getString(<span class="string">"mail.host"</span>);</div><div class="line">        EMAIL_USERNAME = rb.getString(<span class="string">"mail.user"</span>);</div><div class="line">        EMAIL_PASSWORD = rb.getString(<span class="string">"mail.password"</span>);</div><div class="line">        EMAIL_FROM = rb.getString(<span class="string">"mail.from"</span>);</div><div class="line">        EMAIL_TO = rb.getString(<span class="string">"mail.to"</span>);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">/**</span></div><div class="line">     *  发送文件邮件</div><div class="line">     * <span class="doctag">@param</span> subject   主题</div><div class="line">     * <span class="doctag">@param</span> body      内容</div><div class="line">     * <span class="doctag">@param</span> receiver  收件人,多个时逗号隔开</div><div class="line">     * <span class="doctag">@return</span>          返回是否成功</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">sendTextMail</span><span class="params">(String subject, String body, String receiver)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> sendMail(subject, body, receiver, <span class="number">1</span>);</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">/**</span></div><div class="line">     *  发送html邮件</div><div class="line">     * <span class="doctag">@param</span> subject   主题</div><div class="line">     * <span class="doctag">@param</span> body      内容</div><div class="line">     * <span class="doctag">@param</span> receiver  收件人,多个时逗号隔开</div><div class="line">     * <span class="doctag">@return</span>          返回是否成功</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">sendHtmlMail</span><span class="params">(String subject, String body, String receiver)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> sendMail(subject, body, receiver, <span class="number">2</span>);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 发送邮件</div><div class="line">     * <span class="doctag">@param</span> subject   主题</div><div class="line">     * <span class="doctag">@param</span> body      内容</div><div class="line">     * <span class="doctag">@param</span> receiver  收件人,多个时逗号隔开</div><div class="line">     * <span class="doctag">@param</span> type      类型.1:文本;2:html</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">sendMail</span><span class="params">(String subject, String body, String receiver, <span class="keyword">int</span> type)</span> </span>&#123;</div><div class="line">         <span class="comment">/* 服务器信息 */</span></div><div class="line">        Properties props = <span class="keyword">new</span> Properties();</div><div class="line">        props.put(<span class="string">"mail.smtp.host"</span>, SMTP_MAIL_HOST);</div><div class="line">        props.put(<span class="string">"mail.smtp.auth"</span>, <span class="string">"true"</span>);</div><div class="line">        <span class="keyword">boolean</span> result = <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="comment">/* 创建Session */</span></div><div class="line">            javax.mail.Session session = javax.mail.Session.getDefaultInstance(props, <span class="keyword">new</span> Authenticator() &#123;</div><div class="line">                <span class="meta">@Override</span></div><div class="line">                <span class="keyword">protected</span> javax.mail.<span class="function">PasswordAuthentication <span class="title">getPasswordAuthentication</span><span class="params">()</span> </span>&#123;</div><div class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> javax.mail.PasswordAuthentication(EMAIL_USERNAME, EMAIL_PASSWORD);</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">            <span class="comment">/* 邮件信息 */</span></div><div class="line">            MimeMessage message = <span class="keyword">new</span> MimeMessage(session);</div><div class="line">            <span class="comment">// 发件人</span></div><div class="line">            message.setFrom(<span class="keyword">new</span> InternetAddress(EMAIL_FROM));</div><div class="line">            <span class="comment">// 主题</span></div><div class="line">            message.setSubject(subject);</div><div class="line">            <span class="comment">// 添加收件人,和默认收件人组合</span></div><div class="line">            String res = EMAIL_TO;</div><div class="line">            <span class="keyword">if</span> (receiver != <span class="keyword">null</span> &amp;&amp; !receiver.isEmpty()) &#123;</div><div class="line">                res += <span class="string">","</span> + receiver;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>(<span class="keyword">null</span> != EMAIL_TO &amp;&amp; !EMAIL_TO.isEmpty())&#123;</div><div class="line">                InternetAddress[] internetAddressTo = <span class="keyword">new</span> InternetAddress().parse(res);</div><div class="line">                message.setRecipients(Message.RecipientType.TO, internetAddressTo);</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// 正文</span></div><div class="line">            <span class="keyword">if</span> (<span class="number">2</span> == type) &#123;</div><div class="line">                <span class="comment">// html信息</span></div><div class="line">                message.setContent(body, <span class="string">"text/html;charset=UTF-8"</span> );</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="comment">// 文本信息        </span></div><div class="line">                message.setText(body);</div><div class="line">            &#125;</div><div class="line">    </div><div class="line">            <span class="comment">// 附件部分</span></div><div class="line">            <span class="comment">//messageBodyPart = new MimeBodyPart();</span></div><div class="line">            <span class="comment">//String filename = "file.txt";</span></div><div class="line">            <span class="comment">//DataSource source = new FileDataSource(filename);</span></div><div class="line">            <span class="comment">//messageBodyPart.setDataHandler(new DataHandler(source));</span></div><div class="line">            <span class="comment">//messageBodyPart.setFileName(filename);</span></div><div class="line">            <span class="comment">//multipart.addBodyPart(messageBodyPart);</span></div><div class="line">            <span class="comment">// 发送</span></div><div class="line">            Transport.send(message);</div><div class="line">            result = <span class="keyword">true</span>;</div><div class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>配置文件<code>other_config.properties</code>, 放在src目录下面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># 邮件发送相关配置</div><div class="line">mail.host=mail.163.com</div><div class="line"># 根据邮箱服务器配置,见使用说明</div><div class="line">mail.user=user</div><div class="line">mail.password=password</div><div class="line">mail.from=user@163.com</div><div class="line"># 默认收件人</div><div class="line">mail.to=to@163.com</div></pre></td></tr></table></figure>
<h3 id="使用说明"><a href="#使用说明" class="headerlink" title="使用说明"></a>使用说明</h3><ul>
<li>实现了发送文本邮件和html邮件两种功能</li>
<li>发送附件功能没有使用场景所以未经过测试</li>
<li>可以在方法调用时指定添加收件人,默认的收件人是必须要有的</li>
<li>有一个user的坑需要注意.有的邮箱服务器是用的user@服务器作为用户名(如<code>user@163.com</code>),有的是直接用的user.配置不正确会报5XX错误</li>
</ul>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 文本邮件</span></div><div class="line">MailUtil.sendTextMail(<span class="string">"A text mail"</span>, <span class="string">"haha"</span>, <span class="string">""</span>);</div><div class="line"><span class="comment">// html邮件</span></div><div class="line">MailUtil.sendHtmlMail(<span class="string">"A html mail"</span>, <span class="string">"&lt;h1&gt;haha&lt;/h1&gt;"</span>, <span class="string">""</span>);</div></pre></td></tr></table></figure>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://xxyxpy.pub/2017/07/19/java/tool/Java邮件发送/" data-id="cjblrl7f0004mqwhqhrbuk11f" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <nav id="page-nav">
        <a class="extend prev" rel="prev" href="/page/3/">&laquo; 上一页</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/5/">下一页 &raquo;</a>
    </nav>
</section>
            
                
<aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">最新文章</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/12/25/linux/vps相关/" class="thumbnail">
    
    
        <span style="background-image:url(http://swiftlet.net/wp-content/uploads/2017/04/20170416204714_50373.jpg)" alt="vps相关" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/linux/">linux</a></p>
                            <p class="item-title"><a href="/2017/12/25/linux/vps相关/" class="title">vps相关</a></p>
                            <p class="item-date"><time datetime="2017-12-25T05:31:12.282Z" itemprop="datePublished">2017-12-25</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/12/21/linux/linux/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/linux/">linux</a></p>
                            <p class="item-title"><a href="/2017/12/21/linux/linux/" class="title">linux</a></p>
                            <p class="item-date"><time datetime="2017-12-21T01:22:22.788Z" itemprop="datePublished">2017-12-21</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/12/20/linux/docker/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/linux/">linux</a></p>
                            <p class="item-title"><a href="/2017/12/20/linux/docker/" class="title">docker</a></p>
                            <p class="item-date"><time datetime="2017-12-20T01:59:03.718Z" itemprop="datePublished">2017-12-20</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/12/15/java/tool/java_other/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/java/">java</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/java/tool/">tool</a></p>
                            <p class="item-title"><a href="/2017/12/15/java/tool/java_other/" class="title">java_other</a></p>
                            <p class="item-date"><time datetime="2017-12-15T10:14:54.963Z" itemprop="datePublished">2017-12-15</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/11/28/java/spring/spring boot点滴/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/spring/">spring</a></p>
                            <p class="item-title"><a href="/2017/11/28/java/spring/spring boot点滴/" class="title">spring boot点滴</a></p>
                            <p class="item-date"><time datetime="2017-11-28T09:24:59.869Z" itemprop="datePublished">2017-11-28</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">分类</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/IDE/">IDE</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/c/">c#</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/">database</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><span class="category-list-count">28</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/java/jdbc/">jdbc</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/ssh/">ssh</a><span class="category-list-count">14</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/java/ssh/hibernate/">hibernate</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/ssh/spring/">spring</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/ssh/struts2/">struts2</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/tool/">tool</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/web/">web</a><span class="category-list-count">6</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/java/web/servlet/">servlet</a><span class="category-list-count">1</span></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/myBlog/">myBlog</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/nosql/">nosql</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/spring/">spring</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据结构和算法/">数据结构和算法</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/激活码/">激活码</a><span class="category-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">归档</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a><span class="archive-list-count">2</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">标签</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Intellij/">Intellij</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/activemq/">activemq</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/annotaion/">annotaion</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ashx/">ashx</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cookie/">cookie</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/el/">el</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/filter/">filter</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hiberante/">hiberante</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/io/">io</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a><span class="tag-list-count">28</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jdbc/">jdbc</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jdk/">jdk</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jsp/">jsp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jstl/">jstl</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/listener/">listener</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mail/">mail</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/">mongodb</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nexT/">nexT</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rabbitmq/">rabbitmq</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/">redis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/request/">request</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/response/">response</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/session/">session</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/solr/">solr</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring/">spring</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring-boot/">spring boot</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqlserver/">sqlserver</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/struts2/">struts2</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vps/">vps</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/">web</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/事务/">事务</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/回文数/">回文数</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/套路/">套路</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/泛型/">泛型</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/激活码/">激活码</a><span class="tag-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">标签云</h3>
        <div class="widget tagcloud">
            <a href="/tags/Intellij/" style="font-size: 10px;">Intellij</a> <a href="/tags/activemq/" style="font-size: 10px;">activemq</a> <a href="/tags/annotaion/" style="font-size: 10px;">annotaion</a> <a href="/tags/ashx/" style="font-size: 10px;">ashx</a> <a href="/tags/cookie/" style="font-size: 10px;">cookie</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/el/" style="font-size: 10px;">el</a> <a href="/tags/filter/" style="font-size: 10px;">filter</a> <a href="/tags/hexo/" style="font-size: 12px;">hexo</a> <a href="/tags/hiberante/" style="font-size: 18px;">hiberante</a> <a href="/tags/io/" style="font-size: 10px;">io</a> <a href="/tags/java/" style="font-size: 20px;">java</a> <a href="/tags/jdbc/" style="font-size: 14px;">jdbc</a> <a href="/tags/jdk/" style="font-size: 10px;">jdk</a> <a href="/tags/jsp/" style="font-size: 10px;">jsp</a> <a href="/tags/jstl/" style="font-size: 10px;">jstl</a> <a href="/tags/linux/" style="font-size: 16px;">linux</a> <a href="/tags/listener/" style="font-size: 10px;">listener</a> <a href="/tags/mail/" style="font-size: 10px;">mail</a> <a href="/tags/mongodb/" style="font-size: 10px;">mongodb</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/nexT/" style="font-size: 10px;">nexT</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/rabbitmq/" style="font-size: 10px;">rabbitmq</a> <a href="/tags/redis/" style="font-size: 10px;">redis</a> <a href="/tags/request/" style="font-size: 10px;">request</a> <a href="/tags/response/" style="font-size: 10px;">response</a> <a href="/tags/session/" style="font-size: 10px;">session</a> <a href="/tags/solr/" style="font-size: 10px;">solr</a> <a href="/tags/spring/" style="font-size: 14px;">spring</a> <a href="/tags/spring-boot/" style="font-size: 10px;">spring boot</a> <a href="/tags/sqlserver/" style="font-size: 10px;">sqlserver</a> <a href="/tags/struts2/" style="font-size: 14px;">struts2</a> <a href="/tags/vps/" style="font-size: 10px;">vps</a> <a href="/tags/web/" style="font-size: 16px;">web</a> <a href="/tags/事务/" style="font-size: 10px;">事务</a> <a href="/tags/回文数/" style="font-size: 10px;">回文数</a> <a href="/tags/套路/" style="font-size: 12px;">套路</a> <a href="/tags/泛型/" style="font-size: 10px;">泛型</a> <a href="/tags/激活码/" style="font-size: 10px;">激活码</a>
        </div>
    </div>

    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">链接</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://hexo.io">Hexo</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>

            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2017 xxyxpy<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
        </div>
    </div>
</footer>
        


    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>