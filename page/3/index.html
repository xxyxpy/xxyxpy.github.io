<!DOCTYPE html>
<html lang=zh>
<head>
    <meta charset="utf-8">
    
    <title>code dog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="什么鬼...">
<meta property="og:type" content="website">
<meta property="og:title" content="code dog">
<meta property="og:url" content="http://xxyxpy.pub/page/3/index.html">
<meta property="og:site_name" content="code dog">
<meta property="og:description" content="什么鬼...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="code dog">
<meta name="twitter:description" content="什么鬼...">
    

    
        <link rel="alternate" href="/" title="code dog" type="application/atom+xml" />
    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    
    


</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">code dog</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">主页</a>
                
                    <a class="main-nav-link" href="/archives">归档</a>
                
                    <a class="main-nav-link" href="/categories">分类</a>
                
                    <a class="main-nav-link" href="/tags">标签</a>
                
                    <a class="main-nav-link" href="https://github.com/xxyxpy/boot-my">Boot</a>
                
                    <a class="main-nav-link" href="/about">关于</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/css/images/avatar.png" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="想要查找什么..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">主页</a></td>
                
                    <td><a class="main-nav-link" href="/archives">归档</a></td>
                
                    <td><a class="main-nav-link" href="/categories">分类</a></td>
                
                    <td><a class="main-nav-link" href="/tags">标签</a></td>
                
                    <td><a class="main-nav-link" href="https://github.com/xxyxpy/boot-my">Boot</a></td>
                
                    <td><a class="main-nav-link" href="/about">关于</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/css/images/avatar.png" />
            <h2 id="name">xxyxpy</h2>
            <h3 id="title">代码狗</h3>
            <span id="location"><i class="fa fa-map-marker"></i>苏州</span>
            <a id="follow" target="_blank" href="https://github.com/xxyxpy/">关注我</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                48
                <span>文章</span>
            </div>
            <div class="article-info-block">
                41
                <span>标签</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="http://github.com/xxyxpy/" target="_blank" title="github" class=tooltip>
                            <i class="fa fa-github"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="twitter" class=tooltip>
                            <i class="fa fa-twitter"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="facebook" class=tooltip>
                            <i class="fa fa-facebook"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="dribbble" class=tooltip>
                            <i class="fa fa-dribbble"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="rss" class=tooltip>
                            <i class="fa fa-rss"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main">
    <article id="post-java/spring/spring-01简单使用" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/08/30/java/spring/spring-01简单使用/">spring-01简单使用</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/08/30/java/spring/spring-01简单使用/">
            <time datetime="2017-08-30T02:18:38.193Z" itemprop="datePublished">2017-08-30</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/java/">java</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/java/ssh/">ssh</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/java/ssh/spring/">spring</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/java/">java</a>, <a class="tag-link" href="/tags/spring/">spring</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h3 id="什么是spring框架"><a href="#什么是spring框架" class="headerlink" title="什么是spring框架"></a>什么是spring框架</h3><p>2003年兴起的一个轻量级的java开源框架，替代之前的EJB。核心是控制反转（IoC）和面向切面编程（AOP）</p>
<p>框架特点：</p>
<ul>
<li>方便解耦，简化开发。Spring框架其实是一个大的工厂，可以将所有的对象创建和依赖关系维护交给spring来管理</li>
<li>AOP编程支持。提供切面编程，可以方便的实现对程序进行权限拦截、运维监控等</li>
<li>声明式事务支持。只需要通过配置就可以完成对事务的管理，无需手动编程</li>
<li>方便程序的测试。Spring对Junit的支持，可以通过注解方便的测试spring程序</li>
<li>方便集成各种优秀框架。提供各种优秀框架（如：Struts2、hibernate、Mybatis等）的插件整合包</li>
<li>降低JavaEE Api的使用难度。对JavaEE开发中非常駗的一些api（jdbc、javamail、远程调用等）都提供了封装，使用这些api的难度大大降低</li>
</ul>
<hr>
<h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><h4 id="下载框架开发包"><a href="#下载框架开发包" class="headerlink" title="下载框架开发包"></a>下载框架开发包</h4><p><a href="http://spring.io/" target="_blank" rel="external">官网</a>   <a href="http://repo.springsource.org/libs-release-local/org/springframework/spring" target="_blank" rel="external">下载地址</a></p>
<p>目录结构：</p>
<ul>
<li>docs api和开发规范</li>
<li>libs  jar包和源码</li>
<li>schema 约束</li>
</ul>
<h4 id="创建web项目，引入spring开发包"><a href="#创建web项目，引入spring开发包" class="headerlink" title="创建web项目，引入spring开发包"></a>创建web项目，引入spring开发包</h4><ul>
<li>核心功能包：Beans、Core、Context、Expression Language</li>
<li>日志包：com.springsource.org.apache.commons.logging-1.1.1.jar</li>
<li>log4j的jar包：com.springsource.org.apache.log4j-1.2.15.jar</li>
</ul>
<hr>
<h3 id="入门实例"><a href="#入门实例" class="headerlink" title="入门实例"></a>入门实例</h3><h4 id="使用spring框架必须编写接口和实现类"><a href="#使用spring框架必须编写接口和实现类" class="headerlink" title="使用spring框架必须编写接口和实现类"></a>使用spring框架必须编写接口和实现类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"hello~"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="在src目录添加配置文件application-xml"><a href="#在src目录添加配置文件application-xml" class="headerlink" title="在src目录添加配置文件application.xml"></a>在src目录添加配置文件application.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="comment">&lt;!--suppress SpringFacetInspection --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">       <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></div><div class="line">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"day1.demo1.UserServiceImpl"</span> <span class="attr">id</span>=<span class="string">"userService"</span>/&gt;</span></div><div class="line">    </div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="测试-加载配置文件中classpath是可选项"><a href="#测试-加载配置文件中classpath是可选项" class="headerlink" title="测试 加载配置文件中classpath是可选项"></a>测试 加载配置文件中classpath是可选项</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</div><div class="line">  ApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"classpath:applicationContext.xml"</span>);</div><div class="line">  UserService userService = (UserService) applicationContext.getBean(<span class="string">"userService"</span>);</div><div class="line">  userService.sayHello();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="入门总结"><a href="#入门总结" class="headerlink" title="入门总结"></a>入门总结</h4><p>从上面的测试类中可以看出来最重的一个角色是<code>ApplicationContext</code>接口，此接口用于加载配置文件并可以返回指定的Bean对象。此接口有如下两个实现类：</p>
<ul>
<li>ClassPathXmlApplicationContext 用于加载类路径下的Spring配置文件</li>
<li>FileSystemXmlApplicationContext 用于加载本地磁盘下面的Spring文件，用的比较少</li>
</ul>
<p>除了此接口外早期还提供了BeanFactory接口用于Bean的获取。用法如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</div><div class="line">  BeanFactory factory = <span class="keyword">new</span> XmlBeanFactory(<span class="keyword">new</span> ClassPathResource(<span class="string">"applicationContext.xml"</span>));</div><div class="line">  UserService us = (UserService) factory.getBean(<span class="string">"UserService"</span>);</div><div class="line">  us.sayHello();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>两者的主要区别为ApplicationContext接口在加载配置文件时就会创建具体的Bean对象的实例，而BeanFactory采用延迟加载策略，只有在第一次getBean的时候才会初始化Bean</p>
<hr>
<h3 id="配置文件中Bean标签的配置"><a href="#配置文件中Bean标签的配置" class="headerlink" title="配置文件中Bean标签的配置"></a>配置文件中Bean标签的配置</h3><ul>
<li><code>id</code> 给Bean起个名字，在约束中采用id的约束，具有唯一性</li>
<li><code>name</code> 一般不使用，不具有唯一性约束</li>
<li><code>class</code> Bean对象类的全路径</li>
<li>scope 代表Bean的作用范围。有以下几个取值 singleton（单例，默认取值）、prototype（多例，在整合Struts2框架时，Action类交给spring管理而每次请求的数据是不一样的所以必须配置成多例）、request（应用在web项目中，每次http请求创建一个新的bean）、session（应用在web项目中，同一个Session共享一个实例）、globalsession（应用在web项目中，多服务器间的session）</li>
<li>init-method 当bean被加载到容器时调用此属性指定的方法</li>
<li>destory-method 当bean从容器中删除时调用此属性指定的方法。在web容器中会自动调用，手工测试时需要使用ClassPathXmlApplicationContext的close()方法</li>
</ul>
<hr>
<h3 id="框架的DI（依赖注入）"><a href="#框架的DI（依赖注入）" class="headerlink" title="框架的DI（依赖注入）"></a>框架的DI（依赖注入）</h3><h4 id="IOC和DI的概念"><a href="#IOC和DI的概念" class="headerlink" title="IOC和DI的概念"></a>IOC和DI的概念</h4><ul>
<li>IOC Inverse Of Control，控制反馈，将对象的创建权反转给spring</li>
<li>DI Dependency Injection，依赖注入，在spring创建Bean对象时动态的将依赖对象注入到Bean组件中</li>
</ul>
<h4 id="构造函数注入"><a href="#构造函数注入" class="headerlink" title="构造函数注入"></a>构造函数注入</h4><p>修改实现类添加构造函数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> String name;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserServiceImpl</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"hello~"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> name;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>xml的配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"day1.demo1.UserServiceImpl"</span> <span class="attr">id</span>=<span class="string">"userService"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"zhangsan"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> </span>&#123;</div><div class="line">  ApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"classpath:applicationContext.xml"</span>);</div><div class="line">  UserServiceImpl userService = (UserServiceImpl) applicationContext.getBean(<span class="string">"userService"</span>);</div><div class="line">  System.out.println(userService.getName());</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="属性注入，需要提供属性的set方法"><a href="#属性注入，需要提供属性的set方法" class="headerlink" title="属性注入，需要提供属性的set方法"></a>属性注入，需要提供属性的set方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> String name;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"hello~"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> name;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>xml的配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"day1.demo1.UserServiceImpl"</span> <span class="attr">id</span>=<span class="string">"userService"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"zhangsan"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<p>测试方法同上面的构造函数注入</p>
<h4 id="注入其它引入（java类）"><a href="#注入其它引入（java类）" class="headerlink" title="注入其它引入（java类）"></a>注入其它引入（java类）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> String carName;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCarName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> carName;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCarName</span><span class="params">(String carName)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.carName = carName;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Car car;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"hello~"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> Car <span class="title">getCar</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> car;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCar</span><span class="params">(Car car)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.car = car;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>xml配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"day1.demo1.Car"</span> <span class="attr">id</span>=<span class="string">"car"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"carName"</span> <span class="attr">value</span>=<span class="string">"QQ"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"day1.demo1.UserServiceImpl"</span> <span class="attr">id</span>=<span class="string">"userService"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"car"</span> <span class="attr">ref</span>=<span class="string">"car"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span> </span>&#123;</div><div class="line">  ApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"classpath:applicationContext.xml"</span>);</div><div class="line">  UserServiceImpl userService = (UserServiceImpl) applicationContext.getBean(<span class="string">"userService"</span>);</div><div class="line">  System.out.println(userService.getCar().getCarName());</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="p名称空间注入（Srping-2-5版本开始提供，基本不使用）"><a href="#p名称空间注入（Srping-2-5版本开始提供，基本不使用）" class="headerlink" title="p名称空间注入（Srping 2.5版本开始提供，基本不使用）"></a>p名称空间注入（Srping 2.5版本开始提供，基本不使用）</h4><p>需要先为xml配置文件添加schema <code>xmlns:p=&quot;http://www.springframework.org/schema/p</code>，假如现在UserServiceImpl中有Car和Name两个属性。xml中的注入方式如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"day1.demo1.UserServiceImpl"</span> <span class="attr">id</span>=<span class="string">"userService"</span> <span class="attr">p:car-ref</span>=<span class="string">"car"</span> <span class="attr">p:name</span>=<span class="string">"zhangsan"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="SpEL方式注入（Spring-3-0版本开始提供，基本不使用）"><a href="#SpEL方式注入（Spring-3-0版本开始提供，基本不使用）" class="headerlink" title="SpEL方式注入（Spring 3.0版本开始提供，基本不使用）"></a>SpEL方式注入（Spring 3.0版本开始提供，基本不使用）</h4><p>SpEL：Spring Expression Language是Spring的表达式语言，有一些自己的语法。格式为：#{SpEL}。使用此语法除了可以直接设置值外还可以调用类中的属性可方法</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"day1.demo1.Car"</span> <span class="attr">id</span>=<span class="string">"car"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"carName"</span> <span class="attr">value</span>=<span class="string">"QQ"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"day1.demo1.UserServiceImpl"</span> <span class="attr">id</span>=<span class="string">"userService"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"car"</span> <span class="attr">ref</span>=<span class="string">"car"</span>/&gt;</span></div><div class="line">  <span class="comment">&lt;!--&lt;property name="name" value="#&#123;'abc'.toUpperCase()&#125;"/&gt;--&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"#&#123;car.carName&#125;"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="数组、集合（List，Set，Map）以及Properties的注入"><a href="#数组、集合（List，Set，Map）以及Properties的注入" class="headerlink" title="数组、集合（List，Set，Map）以及Properties的注入"></a>数组、集合（List，Set，Map）以及Properties的注入</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"day1.demo1.UserServiceImpl"</span> <span class="attr">id</span>=<span class="string">"userService"</span>&gt;</span></div><div class="line">  <span class="comment">&lt;!-- arr --&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"arr"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">array</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>a<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>b<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>c<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">array</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">  <span class="comment">&lt;!-- list --&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"list"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">list</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">list</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">  <span class="comment">&lt;!-- set --&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"set"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>a<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>a<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>b<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">  <span class="comment">&lt;!-- map --&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"map"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">map</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"a"</span> <span class="attr">value</span>=<span class="string">"a-v"</span>/&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"b"</span> <span class="attr">value</span>=<span class="string">"b-v"</span>/&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"c"</span> <span class="attr">value</span>=<span class="string">"c-v"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">map</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">  <span class="comment">&lt;!-- properties --&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"pro"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">props</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"name"</span>&gt;</span>张三<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"age"</span>&gt;</span>18<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">props</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div></pre></td></tr></table></figure>
<hr>
<h3 id="引入多个Spring配置文件"><a href="#引入多个Spring配置文件" class="headerlink" title="引入多个Spring配置文件"></a>引入多个Spring配置文件</h3><p>实际开发过程中spring的配置文件可能分散在不同的子工程中，需要在web层进行整合。需要使用到import标签,如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="comment">&lt;!--suppress SpringFacetInspection --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">       <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></div><div class="line">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</div><div class="line"></div><div class="line">    <span class="comment">&lt;!--引入多个配置--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">"applicationContext2.xml"</span>/&gt;</span></div><div class="line">  	<span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">"classpath*:applicationContext-web.xml"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">"classpath*:applicationContext-service.xml"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">"classpath*:applicationContext-dao.xml"</span>/&gt;</span></div><div class="line">    </div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://xxyxpy.pub/2017/08/30/java/spring/spring-01简单使用/" data-id="cjblta93b003y0khqv7i7d4ug" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-java/struts2/struts2-03值栈" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/08/23/java/struts2/struts2-03值栈/">struts2-03值栈</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/08/23/java/struts2/struts2-03值栈/">
            <time datetime="2017-08-23T10:04:55.853Z" itemprop="datePublished">2017-08-23</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/java/">java</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/java/ssh/">ssh</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/java/ssh/struts2/">struts2</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/java/">java</a>, <a class="tag-link" href="/tags/struts2/">struts2</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h3 id="OGNL表达式"><a href="#OGNL表达式" class="headerlink" title="OGNL表达式"></a>OGNL表达式</h3><p>OGNL是Object Graphic Navigation Language（对象图导航语言）的缩写</p>
<ul>
<li>所谓对象图，即以任意一个对象为根，通过OGNL可以访问与这个对象关联的其它对象</li>
<li>通过它简单一致的表达式语法，可以存取对象的任意属性，调用对象的方法，遍历整个对象的结构图，实现字段类型转化等功能。它使用相同的表达式去存取对象的属性</li>
</ul>
<p>OGNL表达式在Struts2中的应用</p>
<ul>
<li><p>Struts2引入OGNL表达式，主要是在jsp页面中获取值栈中的值</p>
</li>
<li><p>使用方法</p>
<blockquote>
<p>先引入Struts2的标签库</p>
<p>&lt;%@ taglib prefix=”s” uri=”/struts-tags” %&gt;</p>
<p>再使用Struts2提供的标签中的标签</p>
<p>&lt;s:property value=”OGNL表达式”/&gt;</p>
</blockquote>
</li>
</ul>
<hr>
<h3 id="值栈（ValueStack）"><a href="#值栈（ValueStack）" class="headerlink" title="值栈（ValueStack）"></a>值栈（ValueStack）</h3><p>值栈就相当天Struts2框架的数据中转站，向值栈存放一些数据，然后在页面中从值栈获取到数据。具有如下特点：</p>
<ul>
<li>ValueStack是Struts2提供的一个接口，实现类为OgnlValueStack</li>
<li>Action是多例的，一个请求就会创建一个Action实例ActionContext对象，此对象代表的是Action的上下文，同时还会创建一个ValueStack对象</li>
<li>创建的ValueStack对象中保存了Action对象和其它相关的对象</li>
<li>Struts2框架把ValueStack对象保存在Request中，属性名为：struts.valueStack 可以通过<code>ValueStack vs = (ValueStack)request.getAttribute(&quot;struts.valueStack&quot;)</code>获取</li>
</ul>
<hr>
<h3 id="值栈的内部结构"><a href="#值栈的内部结构" class="headerlink" title="值栈的内部结构"></a>值栈的内部结构</h3><p>参考：<a href="http://www.cnblogs.com/hlhdidi/p/6185836.html" target="_blank" rel="external">内部数据结构</a></p>
<p>OgnlValueStack对象为值栈的实现类，内部由两部分组成：</p>
<ul>
<li><p>root栈（CompoundRoot，继承list接口） 内部是一个List结构，存储动作相关对象。访问时不需要加#</p>
</li>
<li><p>context栈（OgnlContext，实现 Map接口） 内部一个Map结构，存储各种映射关系（k-v）。访问时需要加#</p>
<blockquote>
<p>context栈中有ValueStack的引用以及root栈的引用，并且context栈被ActionContext持有</p>
<p>默认会将request，session，application，parameters压入context栈中，另外会压入一个key为attr的集合，对此集合进行查找时会顺序检索request、session、application、parameters</p>
</blockquote>
</li>
</ul>
<hr>
<h3 id="获取值栈对象的三种方法"><a href="#获取值栈对象的三种方法" class="headerlink" title="获取值栈对象的三种方法"></a>获取值栈对象的三种方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ValueStack vs1 = (ValueStack) ServletActionContext.getRequest().getAttribute(<span class="string">"struts.valueStack"</span>);</div><div class="line"></div><div class="line">ValueStack vs2 =(ValueStack)ServletActionContext.getRequest().getAttribute(ServletActionContext.STRUTS_VALUESTACK_KEY);</div><div class="line"></div><div class="line">ValueStack vs3 = ActionContext.getContext().getValueStack();</div></pre></td></tr></table></figure>
<hr>
<h3 id="值栈数据的设置和获取"><a href="#值栈数据的设置和获取" class="headerlink" title="值栈数据的设置和获取"></a>值栈数据的设置和获取</h3><p>设置值时主要是使用针对root栈的push和set方法，首先最后操作的数据肯定是会被放在栈顶的。默认框架是将当前访问的Action对象放在了栈顶，在jsp中可以通过<code>&lt;s:debug/&gt;</code>查看值栈的内容</p>
<ul>
<li><p>push方法 <code>valueStack.push(Object obj);</code></p>
<p>此方法底层调用了root对象的push方法，将元素放在了栈顶</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(Object o)</span> </span>&#123;</div><div class="line">        root.push(o);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>set方法 <code>valueStack.set(String key, Object obj);</code></p>
<p>调用此方法会将k-v值放在map集合中并且放到栈顶，如果存入时map集合不存在会新创建集合。如果已经存在map集合则添加到集合中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(String key, Object o)</span> </span>&#123;</div><div class="line">  Map setMap = retrieveSetMap();</div><div class="line">  setMap.put(key, o);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> Map <span class="title">retrieveSetMap</span><span class="params">()</span> </span>&#123;</div><div class="line">  Map setMap;</div><div class="line">  Object topObj = peek();</div><div class="line">  <span class="comment">// 先查看栈顶的是不是一个map集合如果是返回此集合，如果不是则创建map集合并返回</span></div><div class="line">  <span class="keyword">if</span> (shouldUseOldMap(topObj)) &#123;</div><div class="line">    setMap = (Map) topObj;</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    setMap = <span class="keyword">new</span> HashMap();</div><div class="line">    setMap.put(MAP_IDENTIFIER_KEY, <span class="string">""</span>);</div><div class="line">    <span class="comment">// 创建并push到栈顶</span></div><div class="line">    push(setMap);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> setMap;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">shouldUseOldMap</span><span class="params">(Object topObj)</span> </span>&#123;</div><div class="line">  <span class="keyword">return</span> topObj <span class="keyword">instanceof</span> Map &amp;&amp; ((Map) topObj).get(MAP_IDENTIFIER_KEY) != <span class="keyword">null</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>值栈的获取值根据从不同的地方（root栈、context栈）或者值的类型不同获取方法不同</p>
<p>另可参考<a href="http://www.jianshu.com/p/237dcb11770e" target="_blank" rel="external">值栈与ognl</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ValueStack2Action</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPp</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> pp;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPp</span><span class="params">(String pp)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.pp = pp;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">private</span> String pp;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">save</span><span class="params">()</span> </span>&#123;</div><div class="line">        ValueStack vs3 = ActionContext.getContext().getValueStack();</div><div class="line">        pp = <span class="string">"pppp"</span>;</div><div class="line">        <span class="comment">// 向栈顶push值</span></div><div class="line">        vs3.push(<span class="string">"tom"</span>);</div><div class="line">        <span class="comment">// 向栈顶set k-v值</span></div><div class="line">        <span class="comment">// 如果原来顶部是map直接使用添加,如不是则new一个放在顶部</span></div><div class="line">        vs3.set(<span class="string">"name1"</span>, <span class="string">"jack"</span>);</div><div class="line">        MyUser user = <span class="keyword">new</span> MyUser();</div><div class="line">        user.setUname(<span class="string">"hello_name"</span>);</div><div class="line">        vs3.set(<span class="string">"user"</span>, user);</div><div class="line">        <span class="comment">// 存入list集合</span></div><div class="line">        List&lt;MyUser&gt; ulist = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        ulist.add(<span class="keyword">new</span> MyUser(<span class="string">"ua"</span>));</div><div class="line">        ulist.add(<span class="keyword">new</span> MyUser(<span class="string">"ub"</span>));</div><div class="line">        ulist.add(<span class="keyword">new</span> MyUser(<span class="string">"uc"</span>));</div><div class="line">        vs3.set(<span class="string">"ulist"</span>, ulist);</div><div class="line">        </div><div class="line">        <span class="comment">// 设置值到context中</span></div><div class="line">        HttpServletRequest request = ServletActionContext.getRequest();</div><div class="line">        request.setAttribute(<span class="string">"msg"</span>, <span class="string">"request_msg"</span>);</div><div class="line">        request.getSession().setAttribute(<span class="string">"msg"</span>, <span class="string">"session_msg"</span>);</div><div class="line">        <span class="keyword">return</span> SUCCESS;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>jsp页面</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line">&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %&gt;</div><div class="line">&lt;%@ taglib prefix="s" uri="/struts-tags" %&gt;</div><div class="line">&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">    &lt;title&gt;Title&lt;/title&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">&lt;%--访问action中的数据,需要提供set和get方法--%&gt;</div><div class="line">&lt;s:property value="pp"/&gt; &lt;br&gt;</div><div class="line">&lt;%--访问字符串--%&gt;</div><div class="line">&lt;s:property value="[1].top"/&gt; &lt;br&gt;</div><div class="line">&lt;hr&gt;</div><div class="line">&lt;%--访问map中的数据--%&gt;</div><div class="line">&lt;s:property value="[0].top.user.uname"/&gt; &lt;br&gt;</div><div class="line">&lt;s:property value="name1"/&gt; &lt;br&gt;</div><div class="line">&lt;s:property value="user.uname"/&gt; &lt;br&gt;</div><div class="line">&lt;hr&gt;</div><div class="line">&lt;%--处理集合数据--%&gt;</div><div class="line">    &lt;%--单索引--%&gt;</div><div class="line">&lt;s:property value="ulist[0].uname"/&gt; &lt;br&gt;&lt;br&gt;</div><div class="line">    &lt;%--遍历</div><div class="line">        * var编写上，把迭代产生的对象默认压入到context栈中，从context栈取值，加#号</div><div class="line">        * var不编写，默认把迭代产生的对象压入到root栈中</div><div class="line">    --%&gt;</div><div class="line">&lt;s:iterator value="ulist"&gt;</div><div class="line">    &lt;s:property value="uname"/&gt; &lt;br&gt;</div><div class="line">&lt;/s:iterator&gt;</div><div class="line">&lt;br&gt;</div><div class="line">&lt;s:iterator value="ulist" var="u"&gt;</div><div class="line">    &lt;s:property value="#u.uname"/&gt; &lt;br&gt;</div><div class="line">&lt;/s:iterator&gt;</div><div class="line">&lt;hr&gt;</div><div class="line">&lt;%--获取context栈中的内容 使用#--%&gt;</div><div class="line">request.msg:&lt;s:property value="#request.msg"/&gt; &lt;br&gt;</div><div class="line">session.msg:&lt;s:property value="#session.msg"/&gt; &lt;br&gt;</div><div class="line">attr.msg:&lt;s:property value="#attr.msg"/&gt; &lt;br&gt;</div><div class="line">parameter.id:&lt;s:property value="#parameters.id"/&gt;</div><div class="line"></div><div class="line">&lt;hr&gt;</div><div class="line">&lt;%--使用el和jstl--%&gt;</div><div class="line">&lt;c:forEach items="$&#123;ulist&#125;" var="u"&gt;</div><div class="line">    jsp - $&#123;u.uname&#125; &lt;br&gt;</div><div class="line">&lt;/c:forEach&gt;</div><div class="line">&lt;s:debug/&gt;</div><div class="line">&lt;hr&gt;</div><div class="line">N语法[0]：&lt;s:property value="[0]"/&gt;&lt;br&gt;</div><div class="line">N语法[1]：&lt;s:property value="[1]"/&gt;&lt;br&gt;</div><div class="line">N语法[0].top：&lt;s:property value="[0].top"/&gt;&lt;br&gt;</div><div class="line">N语法[1].top：&lt;s:property value="[1].top"/&gt;&lt;br&gt;</div><div class="line">N语法top：&lt;s:property value="top"/&gt;&lt;br&gt;</div><div class="line">N语法取值[0].user.uname：&lt;s:property value="[0].user.uname"/&gt;&lt;br&gt;</div><div class="line">N语法取值top.user.uname：&lt;s:property value="top.user.uname"/&gt;&lt;br&gt;</div><div class="line">N语法取值top.name1：&lt;s:property value="top.name1"/&gt;&lt;br&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<p>注意点：</p>
<blockquote>
<p>1.访问context栈时需要加#号，比如request.msg</p>
<p>2.遍历列表时是否使用临时变量影响遍历时的对象的存储，如果不使用var是存储在root栈，使用时存储在context栈，进而会影响其取值</p>
<p>3.使用el表达式也可以获取到值栈中的数据，为什么？</p>
<p>因为在StrutsPrepareAndExecuteFilter类的doFilter方法中有<code>request = prepare.wrapRequest(request);</code>对原来的request作了包装处理，包装类为：StrutsRequestWrapper。</p>
<p>此类增强了request中的getAttribute方法，主要代码片断为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="keyword">if</span> (!alreadyIn &amp;&amp; !key.contains(<span class="string">"#"</span>)) &#123;</div><div class="line">&gt;   <span class="keyword">try</span> &#123;</div><div class="line">&gt;     <span class="comment">// If not found, then try the ValueStack</span></div><div class="line">&gt;     ctx.put(REQUEST_WRAPPER_GET_ATTRIBUTE, Boolean.TRUE);</div><div class="line">&gt;     ValueStack stack = ctx.getValueStack();</div><div class="line">&gt;     <span class="keyword">if</span> (stack != <span class="keyword">null</span>) &#123;</div><div class="line">&gt;       attribute = stack.findValue(key);</div><div class="line">&gt;     &#125;</div><div class="line">&gt;   &#125; <span class="keyword">finally</span> &#123;</div><div class="line">&gt;     ctx.put(REQUEST_WRAPPER_GET_ATTRIBUTE, Boolean.FALSE);</div><div class="line">&gt;   &#125;</div><div class="line">&gt; &#125;</div><div class="line">&gt;</div></pre></td></tr></table></figure>
<p>4.N语法和top语法</p>
<ul>
<li>规定栈顶的对象为[0]，所以[0]表示从值栈的第0个对象开始取到最后一个对象。同理[N]表示从第N个开始取到最后一个</li>
<li>如果要访问第N个对象使用[N].top,top的意思是取第一个</li>
<li>如果直接使用top则拿到的是栈顶对象效果和[0].top一样</li>
<li>N语法和top语法后面带属性查找时都是从当前符合条件的对象开始向下查找，找到即返回</li>
<li><strong>当N语法和top语法省略时直接调用的是OgnlValueStack中的findValue方法</strong></li>
</ul>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt; N语法[<span class="number">0</span>]：&lt;s:property value=<span class="string">"[0]"</span>/&gt;&lt;br&gt;</div><div class="line">&gt; N语法[<span class="number">1</span>]：&lt;s:property value=<span class="string">"[1]"</span>/&gt;&lt;br&gt;</div><div class="line">&gt; N语法[<span class="number">0</span>].top：&lt;s:property value=<span class="string">"[0].top"</span>/&gt;&lt;br&gt;</div><div class="line">&gt; N语法[<span class="number">1</span>].top：&lt;s:property value=<span class="string">"[1].top"</span>/&gt;&lt;br&gt;</div><div class="line">&gt; N语法top：&lt;s:property value=<span class="string">"top"</span>/&gt;&lt;br&gt;</div><div class="line">&gt; N语法取值[<span class="number">0</span>].user.uname：&lt;s:property value=<span class="string">"[0].user.uname"</span>/&gt;&lt;br&gt;</div><div class="line">&gt; N语法取值top.user.uname：&lt;s:property value=<span class="string">"top.user.uname"</span>/&gt;&lt;br&gt;</div><div class="line">&gt; N语法取值top.name1：&lt;s:property value=<span class="string">"top.name1"</span>/&gt;&lt;br&gt;</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</blockquote>
<hr>
<h3 id="OGNL表达式的特殊符号"><a href="#OGNL表达式的特殊符号" class="headerlink" title="OGNL表达式的特殊符号#$%"></a>OGNL表达式的特殊符号#$%</h3><ul>
<li><p>#符号</p>
<p>首先是可以用来取context栈中的值。另外可用来构建map集合</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %&gt;</div><div class="line">&lt;%@taglib prefix="s" uri="/struts-tags" %&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">    &lt;title&gt;Title&lt;/title&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">&lt;h3&gt;编写表单&lt;/h3&gt;</div><div class="line">&lt;s:form action="" method="POST"&gt;</div><div class="line">    &lt;s:radio name="sex" list="&#123;'男','女'&#125;"&gt;&lt;/s:radio&gt;</div><div class="line">    &lt;s:radio name="sex" list="#&#123;'0':'男','1':'女'&#125;"&gt;&lt;/s:radio&gt;</div><div class="line">&lt;/s:form&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>%符号</p>
<p>强制字符串解析成ognl表达式，假设#request.msg是从文本框中取的值。</p>
<blockquote>
<p>​</p>
</blockquote>
<p>在使用%时如果表达式中的值用’’引起来则不起作用，当作字符串处理。如：</p>
<blockquote>
<p>%{‘#request.msg’}</p>
</blockquote>
</li>
<li><p>$符号</p>
<p>在配置文件中使用ognl表达式，如下载的配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"download1"</span> <span class="attr">class</span>=<span class="string">"cn.demo2.DownloadAction"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span> <span class="attr">type</span>=<span class="string">"stream"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"contentType"</span>&gt;</span>$&#123;contentType&#125;<span class="tag">&lt;/<span class="name">param</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"contentDisposition"</span>&gt;</span>attachment;filename=$&#123;downFilename&#125;<span class="tag">&lt;/<span class="name">param</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">result</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></div></pre></td></tr></table></figure>
<p>​</p>
<p>​</p>
</li>
</ul>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://xxyxpy.pub/2017/08/23/java/struts2/struts2-03值栈/" data-id="cjblta93l004h0khqz5c7nw8v" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-java/struts2/struts2-02拦截器、请求封装以及结果跳转" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/08/17/java/struts2/struts2-02拦截器、请求封装以及结果跳转/">struts2-02拦截器、请求封装以及结果跳转</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/08/17/java/struts2/struts2-02拦截器、请求封装以及结果跳转/">
            <time datetime="2017-08-17T05:43:54.722Z" itemprop="datePublished">2017-08-17</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/java/">java</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/java/ssh/">ssh</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/java/ssh/struts2/">struts2</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/java/">java</a>, <a class="tag-link" href="/tags/struts2/">struts2</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h3 id="在Struts2框架中使用Servlet的api"><a href="#在Struts2框架中使用Servlet的api" class="headerlink" title="在Struts2框架中使用Servlet的api"></a>在Struts2框架中使用Servlet的api</h3><p>JavaWeb中原先使用的是Servlet作为web层框架，换成使用Struts时也提供了Servlet相关api的访问。访问时主要有两种方式：</p>
<h4 id="使用原生的Servlet"><a href="#使用原生的Servlet" class="headerlink" title="使用原生的Servlet"></a>使用原生的Servlet</h4><p>框架中提供了ServletActionContext，该类中提供了一些静态的方法，如：<code>getPageContext()</code>、<code>getRequest()</code>、<code>getResponse()</code>、<code>getServletContext()</code></p>
<p>使用案例： </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo4Action</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        <span class="comment">// get request</span></div><div class="line">        HttpServletRequest request = ServletActionContext.getRequest();</div><div class="line">        <span class="comment">// 向域中存入其它对象</span></div><div class="line">        <span class="comment">// request</span></div><div class="line">        request.setAttribute(<span class="string">"msg"</span>, <span class="string">"request msg"</span>);</div><div class="line">        <span class="comment">// session</span></div><div class="line">        request.getSession().setAttribute(<span class="string">"msg"</span>, <span class="string">"session msg"</span>);</div><div class="line">        <span class="comment">// application</span></div><div class="line">        request.getServletContext().setAttribute(<span class="string">"msg"</span>, <span class="string">"application msg"</span>);</div><div class="line">        ServletActionContext.getServletContext().setAttribute(<span class="string">"msg"</span>, <span class="string">"new application msg"</span>);</div><div class="line">        </div><div class="line">        <span class="keyword">return</span> SUCCESS;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>jsp页面</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">    &lt;title&gt;Title&lt;/title&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">$&#123;sessionScope.msg&#125; &lt;br&gt;</div><div class="line">$&#123;requestScope.msg&#125; &lt;br&gt;</div><div class="line">$&#123;applicationScope.msg&#125; &lt;br&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<p>访问结果</p>
<img title="struts" alt="struts" src="http://oo0vldwkt.bkt.clouddn.com/static/images/java\struts2\001.png">
<h4 id="完全解耦合的方式"><a href="#完全解耦合的方式" class="headerlink" title="完全解耦合的方式"></a>完全解耦合的方式</h4><p>指的是不像上面一样直接操作Request等对象，而是通过框架另外提供的ActionContext类来操作。主要的方法有：</p>
<ul>
<li>static ActionContext getContext()                              – 获取ActionContext对象实例</li>
<li>java.util.Map&lt;java.lang.String,java.lang.Object&gt; getParameters()         – 获取请求参数，相当于request.getParameterMap();</li>
<li>java.util.Map&lt;java.lang.String,java.lang.Object&gt; getSession()          – 获取的代表session域的Map集合，就相当于操作session域。</li>
<li>java.util.Map&lt;java.lang.String,java.lang.Object&gt; getApplication()       – 获取代表application域的Map集合</li>
<li>void put(java.lang.String key, java.lang.Object value)               – 注意：向request域中存入值。</li>
</ul>
<p>使用案例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo3Action</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        <span class="comment">// get action上下文</span></div><div class="line">        ActionContext context = ActionContext.getContext();</div><div class="line">        <span class="comment">// get parameters</span></div><div class="line">        Map&lt;String, Object&gt; parameters = context.getParameters();</div><div class="line">        <span class="comment">// show parameter</span></div><div class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Object&gt; entry : parameters.entrySet())&#123;</div><div class="line">            System.out.println(entry.getKey() + <span class="string">"-"</span> + Arrays.toString((String[]) entry.getValue()));</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 向域中存入其它对象</span></div><div class="line">        <span class="comment">// request</span></div><div class="line">        context.put(<span class="string">"msg"</span>, <span class="string">"request msg"</span>);</div><div class="line">        <span class="comment">// session</span></div><div class="line">        context.getSession().put(<span class="string">"msg"</span>, <span class="string">"session msg"</span>);</div><div class="line">        <span class="comment">// application</span></div><div class="line">        context.getApplication().put(<span class="string">"msg"</span>, <span class="string">"application msg"</span>);</div><div class="line">        </div><div class="line">        <span class="keyword">return</span> SUCCESS;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​</p>
<p>对于ActionContext和ServletActionContext的区别可以查看<a href="http://blog.csdn.net/u013630349/article/details/52807625" target="_blank" rel="external">深入理解 Action 之 ActionContext 和 ServletActionContext</a></p>
<hr>
<h3 id="结果页面的跳转"><a href="#结果页面的跳转" class="headerlink" title="结果页面的跳转"></a>结果页面的跳转</h3><h4 id="两种跳转方式"><a href="#两种跳转方式" class="headerlink" title="两种跳转方式"></a>两种跳转方式</h4><ul>
<li><p>局部结果页面。指的是一个方法返回对应一个页面，如：<code>&lt;result name=&quot;success&quot;&gt;demo3/suc.jsp&lt;/result&gt;</code></p>
</li>
<li><p>全局结果页面。针对当前的package中的action返回相同的name并且都跳转到同一个页面时。当局部和全局配置冲突时优先走局部的配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"demo3"</span> <span class="attr">namespace</span>=<span class="string">"/"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></div><div class="line">  <span class="comment">&lt;!--当前package下面的全局配置,所有的此name应用于此配置--&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">global-results</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>demo3/suc.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">global-results</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"demo3Action2"</span> <span class="attr">class</span>=<span class="string">"com.action3.Demo3Action"</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--&lt;result name="success"&gt;demo3/suc.jsp&lt;/result&gt;--&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"demo4Action"</span> <span class="attr">class</span>=<span class="string">"com.action3.Demo4Action"</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--&lt;result name="success"&gt;demo3/suc.jsp&lt;/result&gt;--&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="结果页面类型"><a href="#结果页面类型" class="headerlink" title="结果页面类型"></a>结果页面类型</h4><p>主要是指action标签中的result标签下的type的属性配置，有以下值：</p>
<ul>
<li>dispatcher       – 转发.type的默认值.Action—&gt;JSP</li>
<li>redirect       – 重定向.    Action—&gt;JSP</li>
<li>chain             – 多个action之间跳转.从一个Action转发到另一个Action. Action—Action</li>
<li>redirectAction   – 多个action之间跳转.从一个Action重定向到另一个Action.    Action—Action</li>
<li>stream         – 文件下载时候使用的</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"demo5Action_*"</span> <span class="attr">class</span>=<span class="string">"com.action3.Demo5Action"</span> <span class="attr">method</span>=<span class="string">"&#123;1&#125;"</span>&gt;</span></div><div class="line">  <span class="comment">&lt;!--redirectAction 多个action间重定向--&gt;</span></div><div class="line">  <span class="comment">&lt;!--&lt;result name="success" type="redirectAction"&gt;demo5Action_update&lt;/result&gt;--&gt;</span></div><div class="line">  <span class="comment">&lt;!--redirectAction 多个action间请求转发--&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span> <span class="attr">type</span>=<span class="string">"chain"</span>&gt;</span>demo5Action_update<span class="tag">&lt;/<span class="name">result</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></div></pre></td></tr></table></figure>
<hr>
<h3 id="数据封装"><a href="#数据封装" class="headerlink" title="数据封装"></a>数据封装</h3><p>之前数据的获取是通过request的方法获取，效率比较低。使用框架后可以实现自动封装到对象。并且支持对集合的封装。Struts2提供了两种数据封装的方式：</p>
<h4 id="属性驱动"><a href="#属性驱动" class="headerlink" title="属性驱动"></a>属性驱动</h4><blockquote>
<p>提供对应属性的set方法进行数据封装</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Regist1Action</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</div><div class="line">    <span class="keyword">private</span> String username;</div><div class="line">    <span class="keyword">private</span> String password;</div><div class="line">    <span class="keyword">private</span> Integer age;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.username = username;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.password = password;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.age = age;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        System.out.println(username + <span class="string">"-"</span> + password + <span class="string">"-"</span> + age);</div><div class="line">        <span class="keyword">return</span> NONE;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>jsp页面</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;h3&gt;属性驱动&lt;/h3&gt;</div><div class="line">&lt;form action="$&#123; pageContext.request.contextPath &#125;/reg/regist1.action" method="post"&gt;</div><div class="line">    姓名:&lt;input type="text" name="username" /&gt;&lt;br/&gt;</div><div class="line">    密码:&lt;input type="password" name="password" /&gt;&lt;br/&gt;</div><div class="line">    年龄:&lt;input type="text" name="age" /&gt;&lt;br/&gt;</div><div class="line">    &lt;input type="submit" value="注册" /&gt;</div><div class="line">&lt;/form&gt;</div></pre></td></tr></table></figure>
<blockquote>
<p>例用ognl表达式封装到JavaBean</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Regist2Action</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</div><div class="line">    <span class="comment">// 不初始化user时会框架会自动的new一个实例出来,并通过setUser方法设置值</span></div><div class="line">    <span class="comment">// 如果初始化好就少调用一次setUser,此时可以不提供setUser方法</span></div><div class="line">    <span class="keyword">private</span> NewUser user = <span class="keyword">new</span> NewUser();</div><div class="line">    </div><div class="line">    <span class="comment">//public NewUser getUser() &#123;</span></div><div class="line">    <span class="comment">//    System.out.println("getUser....");</span></div><div class="line">    <span class="comment">//    return user;</span></div><div class="line">    <span class="comment">//&#125;</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(NewUser user)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"setUser...."</span>);</div><div class="line">        <span class="keyword">this</span>.user = user;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        System.out.println(user);</div><div class="line">        <span class="keyword">return</span> NONE;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NewUser</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> String username;</div><div class="line">    <span class="keyword">private</span> String password;</div><div class="line">    <span class="keyword">private</span> Integer age;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> username;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.username = username;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> password;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.password = password;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> age;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.age = age;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"NewUser&#123;"</span> +</div><div class="line">                <span class="string">"username='"</span> + username + <span class="string">'\''</span> +</div><div class="line">                <span class="string">", password='"</span> + password + <span class="string">'\''</span> +</div><div class="line">                <span class="string">", age="</span> + age +</div><div class="line">                <span class="string">'&#125;'</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>jsp页面</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;h3&gt;属性驱动-封装到javabean对象&lt;/h3&gt;</div><div class="line">&lt;form action="$&#123; pageContext.request.contextPath &#125;/reg/regist2.action" method="post"&gt;</div><div class="line">    姓名:&lt;input type="text" name="user.username" /&gt;&lt;br/&gt;</div><div class="line">    密码:&lt;input type="password" name="user.password" /&gt;&lt;br/&gt;</div><div class="line">    年龄:&lt;input type="text" name="user.age" /&gt;&lt;br/&gt;</div><div class="line">    &lt;input type="submit" value="注册" /&gt;</div><div class="line">&lt;/form&gt;</div></pre></td></tr></table></figure>
<h4 id="模型驱动"><a href="#模型驱动" class="headerlink" title="模型驱动"></a>模型驱动</h4><p>使用模型驱动时必须要实现ModelDriven接口，实现getModel()的方法，在getModel()方法中返回绑定的JavaBean对象。另外此对象必须手动的实例化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Regist3Action</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span> <span class="keyword">implements</span> <span class="title">ModelDriven</span>&lt;<span class="title">NewUser</span>&gt;</span>&#123;</div><div class="line">    NewUser user = <span class="keyword">new</span> NewUser();</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> NewUser <span class="title">getModel</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> user;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        System.out.println(user);</div><div class="line">        <span class="keyword">return</span> NONE;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>jsp页面</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;h3&gt;模型驱动使用ModelDriven接口-封装到javabean对象&lt;/h3&gt;</div><div class="line">&lt;form action="$&#123; pageContext.request.contextPath &#125;/reg/regist3.action" method="post"&gt;</div><div class="line">    姓名:&lt;input type="text" name="username" /&gt;&lt;br/&gt;</div><div class="line">    密码:&lt;input type="password" name="password" /&gt;&lt;br/&gt;</div><div class="line">    年龄:&lt;input type="text" name="age" /&gt;&lt;br/&gt;</div><div class="line">    &lt;input type="submit" value="注册" /&gt;</div><div class="line">&lt;/form&gt;</div></pre></td></tr></table></figure>
<h4 id="封装数据到集合"><a href="#封装数据到集合" class="headerlink" title="封装数据到集合"></a>封装数据到集合</h4><ul>
<li><p>封装到list集合</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Regist4Action</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span> </span>&#123;</div><div class="line">    List&lt;NewUser&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> List&lt;NewUser&gt; <span class="title">getList</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> list;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setList</span><span class="params">(List&lt;NewUser&gt; list)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.list = list;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        System.out.println(Arrays.toString(list.toArray()));</div><div class="line">        <span class="keyword">return</span> NONE;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>jsp页面</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;h3&gt;封装数据到list集合&lt;/h3&gt;</div><div class="line">&lt;form action="$&#123; pageContext.request.contextPath &#125;/reg/regist4.action" method="post"&gt;</div><div class="line">    姓名:&lt;input type="text" name="list[0].username" /&gt;&lt;br/&gt;</div><div class="line">    密码:&lt;input type="password" name="list[0].password" /&gt;&lt;br/&gt;</div><div class="line">    年龄:&lt;input type="text" name="list[0].age" /&gt;&lt;br/&gt;</div><div class="line">    &lt;br&gt;</div><div class="line">    姓名:&lt;input type="text" name="list[1].username" /&gt;&lt;br/&gt;</div><div class="line">    密码:&lt;input type="password" name="list[1].password" /&gt;&lt;br/&gt;</div><div class="line">    年龄:&lt;input type="text" name="list[1].age" /&gt;&lt;br/&gt;</div><div class="line">    &lt;input type="submit" value="注册" /&gt;</div><div class="line">&lt;/form&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>封装数据到map集合</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Regist5Action</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span> </span>&#123;</div><div class="line">    Map&lt;String, NewUser&gt; map;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, NewUser&gt; <span class="title">getMap</span><span class="params">()</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"getMap ..."</span>);</div><div class="line">        <span class="keyword">return</span> map;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMap</span><span class="params">(Map&lt;String, NewUser&gt; map)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"setMap ..."</span>);</div><div class="line">        <span class="keyword">this</span>.map = map;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        System.out.println(map);</div><div class="line">        <span class="keyword">return</span> NONE;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>jsp页面</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>封装数据到map集合<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"$&#123; pageContext.request.contextPath &#125;/reg/regist5.action"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></div><div class="line">    姓名:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"map['first'].username"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></div><div class="line">    密码:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"map['first'].password"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></div><div class="line">    年龄:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"map['first'].age"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span></div><div class="line">    姓名:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"map['second'].username"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></div><div class="line">    密码:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"map['second'].password"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></div><div class="line">    年龄:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"map['second'].age"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"注册"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h3><h4 id="什么是拦截器"><a href="#什么是拦截器" class="headerlink" title="什么是拦截器"></a>什么是拦截器</h4><p>拦截器是可以在方法或对象被访问前后执行的一些操作。比如要访问action类，通过拦截器可以实现访问前后的一些操作，比较典型的应用如页面访问的权限控制。在struts2框架中提供了各种默认的拦截器，可以在struts2的jar包内的struts-default.xml查看关于默认的拦截器与拦截器链的配置</p>
<p>拦截器 采用 责任链 模式</p>
<blockquote>
<p>在责任链模式里,很多对象由每一个对象对其下家的引用而连接起来形成一条链<br>责任链每一个节点，都可以继续调用下一个节点，也可以阻止流程继续执行</p>
<p>在struts2 中可以定义很多个拦截器，将多个拦截器按照特定顺序 组成拦截器栈 （顺序调用 栈中的每一个拦截器 ）</p>
</blockquote>
<p>更多内容访问<a href="http://blog.csdn.net/qjyong/article/details/1824607" target="_blank" rel="external">Struts2拦截器</a></p>
<h4 id="拦截器和过滤器的区别"><a href="#拦截器和过滤器的区别" class="headerlink" title="拦截器和过滤器的区别"></a>拦截器和过滤器的区别</h4><ul>
<li>拦截器是基于JAVA反射机制的，而过滤器是基于函数回调的</li>
<li>过滤器依赖于Servlet容器，而拦截器不依赖于Servlet容器</li>
<li>拦截器只能对Action请求起作用（Action中的方法），而过滤器可以对几乎所有的请求起作用（CSS JSP JS）</li>
</ul>
<h4 id="自定义拦截器"><a href="#自定义拦截器" class="headerlink" title="自定义拦截器"></a>自定义拦截器</h4><ul>
<li><p>首先必须要实现Interceptor接口，重写它的intercept方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoInterceptor</span> <span class="keyword">extends</span> <span class="title">AbstractInterceptor</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">intercept</span><span class="params">(ActionInvocation actionInvocation)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        System.out.println(<span class="string">"before action..."</span>);</div><div class="line">        String result = actionInvocation.invoke();</div><div class="line">        System.out.println(<span class="string">"after action..."</span>);</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>然后在struts.xml中进行配置，将拦截器与action进行关联</p>
<p>支持两种方式的配置，配置时注意必须配置默认栈的拦截器。 因为引入自定义拦截器后默认栈的拦截器就不执行了</p>
<blockquote>
<p>配置方式一</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"interceptor"</span> <span class="attr">namespace</span>=<span class="string">"/"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></div><div class="line">  <span class="comment">&lt;!--定义拦截器方式一--&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">interceptors</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"DemoInterceptor"</span> <span class="attr">class</span>=<span class="string">"com.interceptor.DemoInterceptor"</span>/&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">interceptors</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"interaction"</span> <span class="attr">class</span>=<span class="string">"com.action.interceptor.InterAction"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"DemoInterceptor"</span>/&gt;</span></div><div class="line">    <span class="comment">&lt;!--引入默认栈的拦截器栈--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"defaultStack"</span>/&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></div></pre></td></tr></table></figure>
<blockquote>
<p>配置方式二：定义拦截器栈</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"interceptor"</span> <span class="attr">namespace</span>=<span class="string">"/"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></div><div class="line">  <span class="comment">&lt;!--定义拦截器方式二:定义拦截器栈--&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">interceptors</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"DemoInterceptor"</span> <span class="attr">class</span>=<span class="string">"com.interceptor.DemoInterceptor"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">interceptor-stack</span> <span class="attr">name</span>=<span class="string">"myStack"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"DemoInterceptor"</span>/&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"defaultStack"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">interceptor-stack</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">interceptors</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"interaction"</span> <span class="attr">class</span>=<span class="string">"com.action.interceptor.InterAction"</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--拦截器定义方式二:引入拦截器栈--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"myStack"</span>/&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></div></pre></td></tr></table></figure>
<p>InterAction.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InterAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        System.out.println(<span class="string">"action execute ..."</span>);</div><div class="line">        <span class="keyword">return</span> NONE;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>访问执行结果为</p>
<img title="struts" alt="struts" src="http://oo0vldwkt.bkt.clouddn.com/static/images/java\struts2\002.png">
</li>
</ul>
<h4 id="拦截器设置属性值"><a href="#拦截器设置属性值" class="headerlink" title="拦截器设置属性值"></a>拦截器设置属性值</h4><p>拦截器中定义了一些属性可以在配置文件中进行注入，比如在文件上传拦截器中可以定义允许上传的文件的类型，定义如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--引入默认拦截器--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"defaultStack"</span>&gt;</span></div><div class="line">  <span class="comment">&lt;!--设置上传文件类型,fileUpload为拦截器名称,allowedExtensions为其属性--&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"fileUpload.allowedExtensions"</span>&gt;</span>.jpg,.png,.txt<span class="tag">&lt;/<span class="name">param</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></div></pre></td></tr></table></figure>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://xxyxpy.pub/2017/08/17/java/struts2/struts2-02拦截器、请求封装以及结果跳转/" data-id="cjblta93n004m0khqvsixe7bo" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-java/struts2/struts2-01入门" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/08/16/java/struts2/struts2-01入门/">struts2-01入门</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/08/16/java/struts2/struts2-01入门/">
            <time datetime="2017-08-16T05:38:09.106Z" itemprop="datePublished">2017-08-16</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/java/">java</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/java/ssh/">ssh</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/java/ssh/struts2/">struts2</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/java/">java</a>, <a class="tag-link" href="/tags/struts2/">struts2</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h3 id="框架概述"><a href="#框架概述" class="headerlink" title="框架概述"></a>框架概述</h3><ul>
<li>Struts2是一个基于MVC设计模式的Web层框架，通过前端控制器（过滤器）进行请求拦截过滤</li>
<li>Struts2是Struts1的下一代产品，是在 struts1和WebWork的技术基础上进行了合并的全新的Struts2框架</li>
<li>Struts 2以WebWork为核心，采用拦截器的机制来处理用户的请求，这样的设计也使得业务逻辑控制器能够与ServletAPI完全脱离开，所以Struts 2可以理解为WebWork的更新产品</li>
</ul>
<hr>
<h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><ul>
<li><p>下载开发包</p>
<p>到<a href="https://struts.apache.org/" target="_blank" rel="external">官网</a>去下载，或度盘（<a href="http://pan.baidu.com/s/1dFb8mm1" target="_blank" rel="external">http://pan.baidu.com/s/1dFb8mm1</a> 密码: m3y4）</p>
</li>
<li><p>解压struts-2.3.24-all.zip包，解压后文件如下</p>
<blockquote>
<p>apps    框架提供的一些应用</p>
<p>libs        框架开发的jar包</p>
<p>docs    框架开发文档</p>
<p>src        框架源码</p>
</blockquote>
</li>
<li><p>引入开发的jar包</p>
<p>发布产品中的jar包非常多，但并不是所有的都必须引入，必须引用的jar可以在apps中找到。找到apps目录下面的struts2-blank.war应用，解压后复制WEB-INF/lib目录下所有的jar包</p>
</li>
</ul>
<p>Hello World</p>
<ul>
<li><p>新建Action类</p>
<p>传统web中浏览器发起请求后进入servlet，在struts框架中先被拦截器拦截，然后进行相应的Action类处理。所以Action类是Struts处理请求， 封装数据的核心类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloAction</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">()</span></span>&#123;</div><div class="line">        System.out.println(<span class="string">"hello..."</span>);</div><div class="line">        <span class="keyword">return</span> <span class="string">"ok"</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>配置struts.xml</p>
<p>配置文件名必须是struts.xml,并且位于src目录下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</div><div class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></div><div class="line">	"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"</div><div class="line">	"http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"hello"</span> <span class="attr">class</span>=<span class="string">"com.action.HelloAction"</span> <span class="attr">method</span>=<span class="string">"sayHello"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"ok"</span>&gt;</span>/demo1/suc.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">action</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">package</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></div></pre></td></tr></table></figure>
<p>suc.jsp</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">    &lt;title&gt;Title&lt;/title&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">jump ok..</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>配置web.xml</p>
<p>必须要在web.xml中配置Struts2的前端控制器，只有经过前端控制器的拦截才能进入到Action类中执行。</p>
<p>注意：struts2的不同版本过滤器类可能不同</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span></span></div><div class="line">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"</span></div><div class="line">         <span class="attr">version</span>=<span class="string">"3.1"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>访问</p>
<p>部署好之后访问<a href="http://localhost:端口号/应用名/hello.action" target="_blank" rel="external">http://localhost:端口号/应用名/hello.action</a></p>
</li>
</ul>
<hr>
<h3 id="Struts2的执行流程"><a href="#Struts2的执行流程" class="headerlink" title="Struts2的执行流程"></a>Struts2的执行流程</h3><ol>
<li>在浏览器中访问相应的链接，发送请求到服务器端</li>
<li>请求经过Struts2的核心过滤器（StrutsPrepareAndExecuteFilter）</li>
<li>过滤器拦截完成之后，会根据struts.xml的配置文件找到请求的路径，定位到具体的Action类，通过反射的方式调用相应的方法</li>
<li>方法调用完成之后根据返回值再到struts.xml的配置文件找到跳转或重定向的页面</li>
</ol>
<p>总结：页面–&gt;StrutsPrepereAndExecuteFilter过滤器–&gt;执行一系列拦截器（完成了部分代码）–&gt;执行到目标Action–&gt;返回字符串–&gt;结果页面（result）–&gt;页面跳转</p>
<p>Struts2框架配置文件的加载顺序</p>
<ol>
<li><p>Struts2框架的核心是StrutsPrepareAndExecuteFilter过滤器。查看该类的<code>doFilter</code>方法就能发现该过滤器有两个功能：</p>
<ul>
<li>Prepare        – 预处理，加载核心的配置文件</li>
<li>Execute         –  执行，让部分拦截器执行</li>
</ul>
</li>
<li><p>加载哪些配置文件以及加载顺序</p>
<p>查看Dispatcher类中的init方法会发现如下代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">init_FileManager();</div><div class="line">init_DefaultProperties(); <span class="comment">// [1]</span></div><div class="line">init_TraditionalXmlConfigurations(); <span class="comment">// [2]</span></div><div class="line">init_LegacyStrutsProperties(); <span class="comment">// [3]</span></div><div class="line">init_CustomConfigurationProviders(); <span class="comment">// [5]</span></div><div class="line">init_FilterInitParameters() ; <span class="comment">// [6]</span></div><div class="line">init_AliasStandardObjects() ; <span class="comment">// [7]</span></div></pre></td></tr></table></figure>
<p>init_DefaultProperties();加载org/apache/struts2/default.properties</p>
<p>init_TraditionalXmlConfigurations();加载struts-default.xml,struts-plugin.xml,struts.xml</p>
<p>init_LegacyStrutsProperties();加载自定义的struts.properties.</p>
<p>init_CustomConfigurationProviders();加载用户自定义配置提供者</p>
<p>init_FilterInitParameters();加载web.xml</p>
</li>
<li><p>需要重点关注的配置文件</p>
<p>default.properties 在org/apache/struts2/目录下，代表的是配置的是Struts2的常量的值</p>
<p>struts-default.xml 在Struts2的核心包下，代表的是Struts2核心功能的配置（Bean、拦截器、结果类型等）</p>
<p>struts.xml 重点中的重点配置，代表WEB应用的默认配置，在工作中，基本就配置它就可以了！！（可以配置常量，达到对默认值覆盖的目的）</p>
<p>web.xml 配置前端控制器（可以配置常量）</p>
<p>注意：</p>
<ul>
<li>default.properties、struts-default.xml以及struts-plugin.xml是框架的默认配置，不用修改。</li>
<li>struts-default.xml、struts.xml以及web.xml这三个配置文件可以自己修改struts2的常量。但是有一个特点：后加载的配置文件修改的常量的值，会覆盖掉前面修改的常量的值</li>
</ul>
</li>
<li><p>总结</p>
<ul>
<li>先加载default.properties文件，在org/apache/struts2/default.properties文件，都是常量。</li>
<li>又加载struts-default.xml配置文件，在核心的jar包最下方，struts2框架的核心功能都是在该配置文件中配置的。</li>
<li>再加载struts.xml的配置文件，在src的目录下，代表用户自己配置的配置文件</li>
<li><p>最后加载web.xml的配置文件</p>
</li>
<li><p>后加载的配置文件会覆盖掉之前加载的配置文件（在这些配置文件中可以配置常量）</p>
</li>
</ul>
</li>
</ol>
<hr>
<h3 id="struts-xml配置文件配置说明"><a href="#struts-xml配置文件配置说明" class="headerlink" title="struts.xml配置文件配置说明"></a>struts.xml配置文件配置说明</h3><ol>
<li>&lt;package&gt;标签，如果要配置&lt;action&gt;的标签，必须要先配置&lt;package&gt;标签，代表包的概念<ul>
<li>name 包的名称，要求是唯一的，管理action配置</li>
<li>extends 继承，可以继承其他的包，只要继承了，那么该包就包含了其他包的功能，一般都是继承struts-default。比如在Apackage中定义了包级错误页跳转，B包想也走这个配置的话需要在extends中写上A包的name</li>
<li>namespace 名称空间，一般与&lt;action&gt;标签中的name属性共同决定访问路径（通俗话：怎么来访问action），常见的配置有：namespace=”/“，根名称空间；namespace=”/aaa”，带有名称的名称空间；abstract 抽象的。这个属性基本很少使用，值如果是true，那么编写的包是被继承的</li>
</ul>
</li>
<li>&lt;action&gt;标签，代表配置action类包含的属性<ul>
<li>name 和package标签的namespace属性一起来决定访问路径的</li>
<li>class   配置Action类的全路径（默认值是ActionSupport类）</li>
<li>method Action类中执行的方法，如果不指定，默认值是execute</li>
</ul>
</li>
<li>&lt;result&gt;标签，action类中方法执行，返回的结果跳转的页面。<a href="http://www.cnblogs.com/apem/p/3502447.html" target="_blank" rel="external">result参数详解</a><ul>
<li>name   结果页面逻辑视图名称</li>
<li>type   结果类型（默认值是转发，也可以设置其他的值如重定向）</li>
</ul>
</li>
</ol>
<p>Struts2常量配置</p>
<ol>
<li><p>可以配置常量的页面</p>
<ul>
<li>struts.xml 一般在此页面配置，在根节点struts的下一级配置。<code>&lt;constant name=&quot;key&quot; value=&quot;value&quot;&gt;&lt;/constant&gt;</code></li>
<li>web.xml 比较少在此页面配置。如果配置需要在StrutsPrepareAndExecuteFilter下面配置init-param节点，在其中配置初始化参数</li>
</ul>
</li>
<li><p>需要了解的常量 </p>
<p>eg：<code>&lt;constant name=&quot;struts.devMode&quot; value=&quot;true&quot; /&gt;</code></p>
<ul>
<li>struts.i18n.encoding=UTF-8          – 指定默认编码集,作用于HttpServletRequest的setCharacterEncoding方法 </li>
<li>struts.action.extension=action   – 该属性指定需要Struts 2处理的请求后缀，该属性的默认值是action，即所有匹配*.action的请求都由Struts2处理。如果用户需要指定多个请求后缀，则多个后缀之间以英文逗号（,）隔开</li>
<li>struts.serve.static.browserCache=true       – 设置浏览器是否缓存静态内容,默认值为true(生产环境下使用),开发阶段最好关闭 </li>
<li>struts.configuration.xml.reload=false       – 当struts的配置文件修改后,系统是否自动重新加载该文件,默认值为false(生产环境下使用) </li>
<li>struts.devMode = false               – 开发模式下使用,这样可以打印出更详细的错误信息 </li>
<li>struts.enable.DynamicMethodInvocation = true 是否开启动态方法访问</li>
</ul>
</li>
</ol>
<hr>
<h3 id="指定多个配置文件"><a href="#指定多个配置文件" class="headerlink" title="指定多个配置文件"></a>指定多个配置文件</h3><p>在大部分应用里，随着应用规模的增加，系统中Action的数量也会大量增加，导致struts.xml配置文件变得非常臃肿。为了避免struts.xml文件过于庞大、臃肿，提高struts.xml文件的可读性，我们可以将一个struts.xml配置文件分解成多个配置文件，然后在struts.xml文件中包含其他配置文件。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">"struts2/struts-sysadmin.xml"</span>/&gt;</span></div><div class="line"><span class="comment">&lt;!--引用外部的配置文件--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">"com/action/struts_part1.xml"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">"struts-part2.xml"</span>/&gt;</span></div></pre></td></tr></table></figure>
<hr>
<h3 id="Action类的编写"><a href="#Action类的编写" class="headerlink" title="Action类的编写"></a>Action类的编写</h3><ul>
<li>直接定义类，无继承无接口实现</li>
<li>实现Action接口。此接口中定义了五个常量，和一个方法execute</li>
<li>继承ActionSupport类，一般开发中多用此方案。此类中也实现了上项的Action接口</li>
</ul>
<hr>
<h3 id="Action类的访问"><a href="#Action类的访问" class="headerlink" title="Action类的访问"></a>Action类的访问</h3><p>关于访问的后缀名上面也提到过，默认是.action如果要修改需要配置一下常量值。如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--设置访问的后缀名,默认为action和空,添加do--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.action.extension"</span> <span class="attr">value</span>=<span class="string">"do,action,,"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></div></pre></td></tr></table></figure>
<ol>
<li><p>通过action标签中的name属性配置</p>
<p>配置此属性后访问时会查询到method属性上定义的方法执行。</p>
<p>访问代码： <code>&lt;a href=&quot;${pageContext.request.contextPath}/addBook.action&quot;&gt;添加图书&lt;/a&gt;</code></p>
<p>配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"demo2"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"addBook"</span> <span class="attr">class</span>=<span class="string">"cn.demo2.BookAction"</span> <span class="attr">method</span>=<span class="string">"add"</span>&gt;</span><span class="tag">&lt;/<span class="name">action</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"deleteBook"</span> <span class="attr">class</span>=<span class="string">"cn.demo2.BookAction"</span> <span class="attr">method</span>=<span class="string">"delete"</span>&gt;</span><span class="tag">&lt;/<span class="name">action</span>&gt;</span>	<span class="tag">&lt;/<span class="name">package</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>通过通配符访问</p>
<p>此种方式在开发过程中最为常用。通配符是指使用*代表任意的字符。</p>
<p>使用通配符的方式可以简化配置文件的代码编写，而且扩展和维护比较容易。</p>
<p>访问代码：<code>&lt;a href=&quot;${pageContext.request.contextPath}/order_add.action&quot;&gt;添加订单&lt;/a&gt;</code></p>
<p><code>add</code>即表示通配的内容，对应的访问的是相应action中的add方法。</p>
<p>配置</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;action name="order_*" class="cn.demo2.OrderAction" method="&#123;1&#125;"&gt;&lt;/action&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>通过动态方法访问</p>
<p>如果要开启动态方法访问必须要开启一个常量值，把<code>struts.enable.DynamicMethodInvocation</code>设置为true</p>
<p>访问代码：<code>&lt;a href=&quot;${pageContext.request.contextPath}/product!add.action&quot;&gt;添加商品&lt;/a&gt;</code></p>
<p>配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"product"</span> <span class="attr">class</span>=<span class="string">"cn.demo2.ProductAction"</span>&gt;</span><span class="tag">&lt;/<span class="name">action</span>&gt;</span></div></pre></td></tr></table></figure>
<p>​</p>
</li>
</ol>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://xxyxpy.pub/2017/08/16/java/struts2/struts2-01入门/" data-id="cjblta93j004e0khqsx7jv5ls" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-java/hibernate/hibernate-07HQL和QBC查询" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/08/15/java/hibernate/hibernate-07HQL和QBC查询/">hibernate-07HQL和QBC查询</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/08/15/java/hibernate/hibernate-07HQL和QBC查询/">
            <time datetime="2017-08-15T08:15:47.817Z" itemprop="datePublished">2017-08-15</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/java/">java</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/java/ssh/">ssh</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/java/ssh/hibernate/">hibernate</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/hiberante/">hiberante</a>, <a class="tag-link" href="/tags/java/">java</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h3 id="Hibernate框架的查询方式"><a href="#Hibernate框架的查询方式" class="headerlink" title="Hibernate框架的查询方式"></a>Hibernate框架的查询方式</h3><ol>
<li>唯一标识OID查询。session.get(对象.class,OID)</li>
<li>对象导航方式，由一方加载另一方时</li>
<li>HQL检索方式</li>
<li>QBC检索方式</li>
<li>SQL检索方式（不常用）</li>
</ol>
<hr>
<h3 id="HQL查询"><a href="#HQL查询" class="headerlink" title="HQL查询"></a>HQL查询</h3><h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><p>HQL(Hibernate Query Language) 是面向对象的查询语言, 它和 SQL 查询语言有些相似。在hibernate的各种查询方式中hql查询使用的最为广泛。</p>
<p>HQL与SQL的关系</p>
<ul>
<li>HQL 查询语句是面向对象的,Hibernate负责解析HQL查询语句, 然后根据对象-关系映射文件中的映射信息, 把 HQL 查询语句翻译成相应的 SQL 语句. </li>
<li>HQL 查询语句中的主体是域模型中的类及类的属性</li>
<li>SQL 查询语句是与关系数据库绑定在一起的. SQL查询语句中的主体是数据库表及表的字段</li>
</ul>
<h4 id="HQL查询演示"><a href="#HQL查询演示" class="headerlink" title="HQL查询演示"></a>HQL查询演示</h4><ul>
<li><p>基本查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run1</span><span class="params">()</span> </span>&#123;</div><div class="line">  Session session = HibernateUtils.openSession();</div><div class="line">  Query query = session.createQuery(<span class="string">"from Customer "</span>);</div><div class="line">  List&lt;Customer&gt; list = query.list();</div><div class="line">  <span class="keyword">for</span> (Customer c : list) &#123;</div><div class="line">    System.out.println(c);</div><div class="line">  &#125;</div><div class="line">  session.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>也可以直接链式编程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">List&lt;Customer&gt; list = session.createQuery(<span class="string">"from Customer "</span>).list();</div></pre></td></tr></table></figure>
</li>
<li><p>使用别名查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">session.createQuery(<span class="string">"from Customer c"</span>).list();</div><div class="line">session.createQuery(<span class="string">"select c from Customer c"</span>).list();</div></pre></td></tr></table></figure>
</li>
<li><p>排序查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">session.createQuery(<span class="string">"from Customer order by cust_id"</span>).list();<span class="comment">// 升序</span></div><div class="line">session.createQuery(<span class="string">"from Customer order by cust_id desc"</span>).list();<span class="comment">// 降序</span></div><div class="line">session.createQuery(<span class="string">"select c from Customer c order by c.cust_name desc"</span>).list();</div></pre></td></tr></table></figure>
</li>
<li><p>分页查询</p>
<p>不同数据库的分页查询可以自动判断</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run5</span><span class="params">()</span> </span>&#123;</div><div class="line">  Session session = HibernateUtils.openSession();</div><div class="line">  Query query = session.createQuery(<span class="string">"from Customer c order by c.cust_name asc"</span>);</div><div class="line">  query.setFirstResult(<span class="number">1</span>);    <span class="comment">// 第0条开始</span></div><div class="line">  query.setMaxResults(<span class="number">3</span>);     <span class="comment">// 获取3条数据</span></div><div class="line">  List&lt;Customer&gt; list = query.list();</div><div class="line">  <span class="keyword">for</span> (Customer c : list) &#123;</div><div class="line">    System.out.println(c);</div><div class="line">  &#125;</div><div class="line">  session.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>带条件查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run6</span><span class="params">()</span> </span>&#123;</div><div class="line">  Session session = HibernateUtils.openSession();</div><div class="line">  Query query = session.createQuery(<span class="string">"from Customer c where c.cust_name like ? and id &gt; ?"</span>);</div><div class="line">  <span class="comment">//query.setString(0, "%e%");      // 索引从0开始</span></div><div class="line">  <span class="comment">//query.setLong(1, 5);            // 索引从0开始</span></div><div class="line">  <span class="comment">//通用的设置值方法</span></div><div class="line">  query.setParameter(<span class="number">0</span>, <span class="string">"%e%"</span>);</div><div class="line">  query.setParameter(<span class="number">1</span>, <span class="number">5L</span>);</div><div class="line">  List&lt;Customer&gt; list = query.list();</div><div class="line">  <span class="keyword">for</span> (Customer c : list) &#123;</div><div class="line">    System.out.println(c);</div><div class="line">  &#125;</div><div class="line">  session.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>投影查询,只查询几个字段,返回object数组</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run7</span><span class="params">()</span> </span>&#123;</div><div class="line">  Session session = HibernateUtils.openSession();</div><div class="line">  Query query = session.createQuery(<span class="string">"select c.cust_name,c.cust_id from Customer c "</span>);</div><div class="line">  <span class="comment">//List&lt;Customer&gt; list = query.list(); // 使用customer类型接收会报错</span></div><div class="line">  List&lt;Object[]&gt; list = query.list();</div><div class="line">  <span class="keyword">for</span> (Object[] objects : list) &#123;</div><div class="line">    System.out.println(Arrays.toString(objects));</div><div class="line">  &#125;</div><div class="line">  session.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>投影查询，只查询几个字段。</p>
<p>用JavaBean接收，没有查询出来的列在封装的对象中都是null</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run8</span><span class="params">()</span> </span>&#123;</div><div class="line">  Session session = HibernateUtils.openSession();</div><div class="line">  Query query = session.createQuery(<span class="string">"select new Customer(c.cust_name,c.cust_level) from Customer c "</span>);</div><div class="line">  List&lt;Customer&gt; list = query.list(); <span class="comment">// 此时可以使用customer类型接收</span></div><div class="line">  <span class="keyword">for</span> (Customer c : list) &#123;</div><div class="line">    System.out.println(c);</div><div class="line">  &#125;</div><div class="line">  session.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>聚合函数查询</p>
<p>主要有：count(),sum(),avg(),max(),min()</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run9</span><span class="params">()</span> </span>&#123;</div><div class="line">  Session session = HibernateUtils.openSession();</div><div class="line">  Query query = session.createQuery(<span class="string">"select count(*) from Customer c "</span>);</div><div class="line">  <span class="comment">//Query query = session.createQuery("select count(c) from Customer c ");</span></div><div class="line">  Long l = (Long) query.uniqueResult();</div><div class="line">  System.out.println(<span class="string">"total:"</span> + l);</div><div class="line">  session.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="QBC查询"><a href="#QBC查询" class="headerlink" title="QBC查询"></a>QBC查询</h3><p>Query By Criteria  按条件进行查询</p>
<h4 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h4><ul>
<li><p>简单查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run1</span><span class="params">()</span> </span>&#123;</div><div class="line">  Session session = HibernateUtils.openSession();</div><div class="line">  Criteria criteria = session.createCriteria(Customer.class);</div><div class="line">  List&lt;Customer&gt; list = criteria.list();</div><div class="line">  <span class="keyword">for</span> (Customer c : list)&#123;</div><div class="line">    System.out.println(c);</div><div class="line">  &#125;</div><div class="line">  session.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>排序查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run2</span><span class="params">()</span> </span>&#123;</div><div class="line">  Session session = HibernateUtils.openSession();</div><div class="line">  Criteria criteria = session.createCriteria(Customer.class);</div><div class="line">  criteria.addOrder(Order.desc(<span class="string">"cust_id"</span>));</div><div class="line">  List&lt;Customer&gt; list = criteria.list();</div><div class="line">  <span class="keyword">for</span> (Customer c : list)&#123;</div><div class="line">    System.out.println(c);</div><div class="line">  &#125;</div><div class="line">  session.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>分页查询，与HQL分页设置相同</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run3</span><span class="params">()</span> </span>&#123;</div><div class="line">  Session session = HibernateUtils.openSession();</div><div class="line">  Criteria criteria = session.createCriteria(Customer.class);</div><div class="line">  criteria.setFirstResult(<span class="number">1</span>);</div><div class="line">  criteria.setMaxResults(<span class="number">3</span>);</div><div class="line">  List&lt;Customer&gt; list = criteria.list();</div><div class="line">  <span class="keyword">for</span> (Customer c : list)&#123;</div><div class="line">    System.out.println(c);</div><div class="line">  &#125;</div><div class="line">  session.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>其它各种条件查询</p>
<blockquote>
<p>Restrictions.eq         – 相等</p>
<p>Restrictions.gt        – 大于号</p>
<p>Restrictions.ge        – 大于等于</p>
<p>Restrictions.lt        – 小于</p>
<p>Restrictions.le        – 小于等于</p>
<p>Restrictions.between    – 在之间</p>
<p>Restrictions.like          – 模糊查询</p>
<p>Restrictions.in        – 范围</p>
<p>Restrictions.and       – 并且</p>
<p>Restrictions.or        – 或者</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run4</span><span class="params">()</span> </span>&#123;</div><div class="line">  Session session = HibernateUtils.openSession();</div><div class="line">  Criteria criteria = session.createCriteria(Customer.class);</div><div class="line">  criteria.add(Restrictions.like(<span class="string">"cust_name"</span>, <span class="string">"%e%"</span>));</div><div class="line">  criteria.add(Restrictions.ge(<span class="string">"cust_id"</span>, <span class="number">5L</span>));</div><div class="line">  List&lt;Customer&gt; list = criteria.list();</div><div class="line">  <span class="keyword">for</span> (Customer c : list)&#123;</div><div class="line">    System.out.println(c);</div><div class="line">  &#125;</div><div class="line">  session.close();</div><div class="line">  **以下为伪代码**</div><div class="line">  <span class="comment">// in</span></div><div class="line">  List&lt;Long&gt; params = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">  params.add(<span class="number">1L</span>);</div><div class="line">  params.add(<span class="number">3L</span>);</div><div class="line">  params.add(<span class="number">5L</span>);</div><div class="line">  criteria.add(Restrictions.in(<span class="string">"cust_id"</span>, params));</div><div class="line">  <span class="comment">// or</span></div><div class="line">  criteria.add(Restrictions.or(Restrictions.eq(<span class="string">"cust_id"</span>, <span class="number">1L</span>), </div><div class="line">                Restrictions.eq(<span class="string">"cust_id"</span>, <span class="number">3L</span>)));</div><div class="line">  <span class="comment">// null判断</span></div><div class="line">  criteria.add(Restrictions.isNull(<span class="string">"cust_level"</span>));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>聚合查询</p>
<p>使用<code>criteria.setProjection()</code>方法实现聚合查询，传入Projection接口。</p>
<p><code>Projections</code>类封装了各种取合方式的接口实现类的构造，使用时直接使用<code>Projections</code>类调用方法返回相应的实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run9</span><span class="params">()</span> </span>&#123;</div><div class="line">  Session session = HibernateUtils.openSession();</div><div class="line">  Criteria criteria = session.createCriteria(Customer.class);</div><div class="line">  criteria.setProjection(Projections.count(<span class="string">"cust_id"</span>));</div><div class="line">  Long l = (Long) criteria.uniqueResult();</div><div class="line">  System.out.println(l);</div><div class="line">  <span class="comment">// 使用count*后又做明细查询前需要先清除掉projection</span></div><div class="line">  criteria.setProjection(<span class="keyword">null</span>);</div><div class="line">  List&lt;Customer&gt; list = criteria.list();</div><div class="line">  <span class="keyword">for</span>(Customer c : list)&#123;</div><div class="line">    System.out.println(c);</div><div class="line">  &#125;</div><div class="line">  session.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="离线条件查询"><a href="#离线条件查询" class="headerlink" title="离线条件查询"></a>离线条件查询</h4><p>离线条件查询使用的是DetachedCriteria接口进行查询，离线条件查询对象在创建的时候，不需要使用Session对象，只是在查询的时候使用Session对象即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run10</span><span class="params">()</span> </span>&#123;</div><div class="line">  <span class="comment">// 创建离线查询对象</span></div><div class="line">  DetachedCriteria criteria = DetachedCriteria.forClass(Customer.class);</div><div class="line">  Session session = HibernateUtils.openSession();</div><div class="line">  criteria.add(Restrictions.between(<span class="string">"cust_id"</span>, <span class="number">1L</span>, <span class="number">5000L</span>));</div><div class="line">  List&lt;Customer&gt; list = criteria.getExecutableCriteria(session).list();</div><div class="line">  <span class="keyword">for</span>(Customer c : list)&#123;</div><div class="line">    System.out.println(c);</div><div class="line">  &#125;</div><div class="line">  session.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<h3 id="SQL查询"><a href="#SQL查询" class="headerlink" title="SQL查询"></a>SQL查询</h3><p>在Hibernate中使用sql方式进行查询应用场景较少。Sql查询时可以将结果绑定到实体或Object数组。</p>
<p>封装到对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run2</span><span class="params">()</span></span>&#123;</div><div class="line">  Session session = HibernateUtils.openSession();</div><div class="line">  <span class="comment">//创建sql查询接口</span></div><div class="line">  SQLQuery sqlQuery = session.createSQLQuery(<span class="string">"select * from cst_customer"</span>);</div><div class="line">  sqlQuery.addEntity(Customer.class);</div><div class="line">  List&lt;Customer&gt; list = sqlQuery.list();</div><div class="line">  <span class="keyword">for</span> (Customer c : list)&#123;</div><div class="line">    System.out.println(c);</div><div class="line">  &#125;</div><div class="line">  session.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>封装到Object数组</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run1</span><span class="params">()</span></span>&#123;</div><div class="line">  Session session = HibernateUtils.openSession();</div><div class="line">  <span class="comment">//创建sql查询接口</span></div><div class="line">  SQLQuery sqlQuery = session.createSQLQuery(<span class="string">"select * from cst_customer"</span>);</div><div class="line">  List&lt;Object[]&gt; list = sqlQuery.list();</div><div class="line">  <span class="keyword">for</span> (Object[] objs : list)&#123;</div><div class="line">    System.out.println(Arrays.toString(objs));</div><div class="line">  &#125;</div><div class="line">  session.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<h3 id="HQL多表查询"><a href="#HQL多表查询" class="headerlink" title="HQL多表查询"></a>HQL多表查询</h3><ol>
<li><p>多表的查询进来使用HQL语句进行查询，HQL语句和SQL语句的查询语法比较类似。</p>
<ul>
<li><p>内连接查询</p>
<ul>
<li><p>显式内连接</p>
<p> select * from customers c inner join orders o on c.cid = o.cno;</p>
</li>
<li><p>隐式内连接</p>
<p> select * from customers c,orders o where c.cid = o.cno;</p>
</li>
</ul>
</li>
<li><p>外连接查询</p>
<ul>
<li><p>左外连接</p>
<p> select * from customers c left join orders o on c.cid = o.cno;</p>
</li>
<li><p>右外连接</p>
<p> select * from customers c right join orders o on c.cid = o.cno;</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>HQL的多表查询</p>
<p>非迫切返回结果是Object[]</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run1</span><span class="params">()</span> </span>&#123;</div><div class="line">  Session session = HibernateUtils.openSession();</div><div class="line">  <span class="comment">// 客户和联系人的关联方式</span></div><div class="line">  Query query = session.createQuery(<span class="string">"from Customer c join c.linkmans"</span>);</div><div class="line">  <span class="comment">// 默认返回的是数组</span></div><div class="line">  List&lt;Object[]&gt; list = query.list();</div><div class="line">  <span class="keyword">for</span> (Object[] objs : list) &#123;</div><div class="line">    System.out.println(Arrays.toString(objs));</div><div class="line">  &#125;</div><div class="line">  session.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>迫切连接返回的结果是对象，把客户的信息封装到客户的对象中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run2</span><span class="params">()</span> </span>&#123;</div><div class="line">  Session session = HibernateUtils.openSession();</div><div class="line">  <span class="comment">// 客户和联系人的关联方式</span></div><div class="line">  <span class="comment">// 使用fetch 迫切连接</span></div><div class="line">  Query query = session.createQuery(<span class="string">"from Customer c join fetch c.linkmans"</span>);</div><div class="line">  List&lt;Customer&gt; list = query.list();</div><div class="line">  <span class="comment">//手动解决数据重复问题,使用set集合</span></div><div class="line">  Set&lt;Customer&gt; set = <span class="keyword">new</span> HashSet&lt;&gt;(list);</div><div class="line">  <span class="keyword">for</span> (Customer c : list) &#123;</div><div class="line">    System.out.println(c);</div><div class="line">  &#125;</div><div class="line">  session.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>内连接查询</p>
<p>内连接使用 inner join ，默认返回的是Object数组</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Session session = HibernateUtils.getCurrentSession();</div><div class="line">Transaction tr = session.beginTransaction();</div><div class="line">List&lt;Object[]&gt; list = session.createQuery(<span class="string">"from Customer c inner join c.linkmans"</span>).list();</div><div class="line"><span class="keyword">for</span> (Object[] objects : list) &#123;</div><div class="line">   System.out.println(Arrays.toString(objects));</div><div class="line">&#125;</div><div class="line">tr.commit();</div></pre></td></tr></table></figure>
<p>迫切内连接:inner join fetch ，返回的是实体对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Session session = HibernateUtils.getCurrentSession();</div><div class="line">Transaction tr = session.beginTransaction();</div><div class="line">List&lt;Customer&gt; list = session.createQuery(<span class="string">"from Customer c inner join fetch c.linkmans"</span>).list();</div><div class="line">Set&lt;Customer&gt; set = <span class="keyword">new</span> HashSet&lt;Customer&gt;(list);</div><div class="line"><span class="keyword">for</span> (Customer customer : set) &#123;</div><div class="line">   System.out.println(customer);</div><div class="line">&#125;</div><div class="line">tr.commit();</div></pre></td></tr></table></figure>
</li>
<li><p>左外连接查询</p>
<p>左外连接:    封装成Object数组，和内连接相同</p>
<p>迫切左外连接 <code>left join fetch</code>，封装成对象，和内连接相同。<br>​</p>
</li>
</ol>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://xxyxpy.pub/2017/08/15/java/hibernate/hibernate-07HQL和QBC查询/" data-id="cjblta932003i0khq7gmdelje" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-java/hibernate/hibernate-06映射关系之多对多" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/08/15/java/hibernate/hibernate-06映射关系之多对多/">hibernate-06映射关系之多对多</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/08/15/java/hibernate/hibernate-06映射关系之多对多/">
            <time datetime="2017-08-15T06:32:17.159Z" itemprop="datePublished">2017-08-15</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/java/">java</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/java/ssh/">ssh</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/java/ssh/hibernate/">hibernate</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/hiberante/">hiberante</a>, <a class="tag-link" href="/tags/java/">java</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h3 id="多对多单向关联"><a href="#多对多单向关联" class="headerlink" title="多对多单向关联"></a>多对多单向关联</h3><p>用户和角色是典型的多对多关系。通过数据库去描述时必须引入第三张关系表，表中保存两者的主键。</p>
<p>单向关联时从用户出发加载出角色。</p>
<p>User.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Integer id;</div><div class="line">    <span class="keyword">private</span> String userName;</div><div class="line">    <span class="keyword">private</span> Set&lt;Role&gt; roles = <span class="keyword">new</span> HashSet&lt;&gt;();</div><div class="line">	...省略get,set</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Role.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Role</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Integer id;</div><div class="line">    <span class="keyword">private</span> String roleName;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>User.hbm.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.domain2"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"User"</span> <span class="attr">table</span>=<span class="string">"user_p"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"userName"</span>/&gt;</span></div><div class="line">        </div><div class="line">        <span class="comment">&lt;!-- 多对多，table表示中间表 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"roles"</span> <span class="attr">table</span>=<span class="string">"user_role_p"</span> <span class="attr">cascade</span>=<span class="string">"save-update"</span>&gt;</span></div><div class="line">            <span class="comment">&lt;!-- user_id为中间表列，user_p的主键 --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"user_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></div><div class="line">            <span class="comment">&lt;!-- role_id为中间表列，role_p的主键 --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">many-to-many</span> <span class="attr">column</span>=<span class="string">"role_id"</span> <span class="attr">class</span>=<span class="string">"Role"</span>&gt;</span><span class="tag">&lt;/<span class="name">many-to-many</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Role.hbm.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.domain2"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"Role"</span> <span class="attr">table</span>=<span class="string">"role_p"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"roleName"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></div></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</div><div class="line">  Session session = HibernateUtils.openSession();</div><div class="line">  session.beginTransaction();</div><div class="line">  User user = <span class="keyword">new</span> User();</div><div class="line">  user.setUserName(<span class="string">"张三"</span>);</div><div class="line">  Role role1 = <span class="keyword">new</span> Role();</div><div class="line">  role1.setRoleName(<span class="string">"admin"</span>);</div><div class="line">  Role role2 = <span class="keyword">new</span> Role();</div><div class="line">  role2.setRoleName(<span class="string">"manager"</span>);</div><div class="line">  user.getRoles().add(role1);</div><div class="line">  user.getRoles().add(role2);</div><div class="line">  session.save(user);</div><div class="line">  session.getTransaction().commit();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<img title="06映射关系多对多01" alt="06映射关系多对多01" src="http://oo0vldwkt.bkt.clouddn.com/static/images/java\hibernate\06映射关系多对多01.png">
<h3 id="多对多双向关联"><a href="#多对多双向关联" class="headerlink" title="多对多双向关联"></a>多对多双向关联</h3><p>单向关联时通过用户可以获取角色，双向关联时通过角色同样可以获取用户。需要在角色中添加用户的引用，User相关设置不变。</p>
<p>Role.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Role</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Integer id;</div><div class="line">    <span class="keyword">private</span> String roleName;</div><div class="line">    <span class="keyword">private</span> Set&lt;User&gt; users = <span class="keyword">new</span> HashSet&lt;&gt;();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Role.hbm.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.domain2"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"Role"</span> <span class="attr">table</span>=<span class="string">"role_p"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"roleName"</span>/&gt;</span></div><div class="line">        </div><div class="line">        <span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"users"</span> <span class="attr">table</span>=<span class="string">"user_role_p"</span> <span class="attr">cascade</span>=<span class="string">"save-update"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"role_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">many-to-many</span> <span class="attr">column</span>=<span class="string">"user_id"</span> <span class="attr">class</span>=<span class="string">"User"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></div></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</div><div class="line">  Session session = HibernateUtils.openSession();</div><div class="line">  session.beginTransaction();</div><div class="line">  User user = <span class="keyword">new</span> User();</div><div class="line">  user.setUserName(<span class="string">"张三"</span>);</div><div class="line">  Role role1 = <span class="keyword">new</span> Role();</div><div class="line">  role1.setRoleName(<span class="string">"admin"</span>);</div><div class="line">  role1.getUsers().add(user);</div><div class="line">  Role role2 = <span class="keyword">new</span> Role();</div><div class="line">  role2.setRoleName(<span class="string">"manager"</span>);</div><div class="line">  role2.getUsers().add(user);</div><div class="line">  user.getRoles().add(role1);</div><div class="line">  user.getRoles().add(role2);</div><div class="line">  session.save(user);</div><div class="line">  session.getTransaction().commit();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在一方不放弃外键维护时执行上面的测试代码会报错。原因是双方都在维护中间表，插入重复数据时违反主键约束。</p>
<img title="06映射关系多对多02" alt="06映射关系多对多02" src="http://oo0vldwkt.bkt.clouddn.com/static/images/java\hibernate\06映射关系多对多02.png">
<p>修改Role.hbm.xml，添加inverse=”true”。表示角色放弃外键维护</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.domain2"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"Role"</span> <span class="attr">table</span>=<span class="string">"role_p"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"roleName"</span>/&gt;</span></div><div class="line">        </div><div class="line">        <span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"users"</span> <span class="attr">table</span>=<span class="string">"user_role_p"</span> <span class="attr">cascade</span>=<span class="string">"save-update"</span> <span class="attr">inverse</span>=<span class="string">"true"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"role_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">many-to-many</span> <span class="attr">column</span>=<span class="string">"user_id"</span> <span class="attr">class</span>=<span class="string">"User"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></div></pre></td></tr></table></figure>
<p>重新测试后结果正常</p>
<img title="06映射关系多对多03" alt="06映射关系多对多03" src="http://oo0vldwkt.bkt.clouddn.com/static/images/java\hibernate\06映射关系多对多03.png">
        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://xxyxpy.pub/2017/08/15/java/hibernate/hibernate-06映射关系之多对多/" data-id="cjblta92x003c0khqxc82233m" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-java/hibernate/hibernate-05映射关系之一对多" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/08/14/java/hibernate/hibernate-05映射关系之一对多/">hibernate-05映射关系之一对多</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/08/14/java/hibernate/hibernate-05映射关系之一对多/">
            <time datetime="2017-08-14T06:48:52.630Z" itemprop="datePublished">2017-08-14</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/java/">java</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/java/ssh/">ssh</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/java/ssh/hibernate/">hibernate</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/hiberante/">hiberante</a>, <a class="tag-link" href="/tags/java/">java</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h3 id="一对多单向关联"><a href="#一对多单向关联" class="headerlink" title="一对多单向关联"></a>一对多单向关联</h3><p>之前说了多对一的关联，多对一反过来正好是一对多关联。一对多时加载一方可以将多方加载出来。比如现在查询部门，可以通过部门查询到下面所有的用户。</p>
<p>单向关联时一方中持有多方的引用 ，使用set集合。</p>
<p>User.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Integer id;</div><div class="line">    <span class="keyword">private</span> String userName;</div><div class="line">  	...省略get,set</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>User.hbm.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.domain2"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"User"</span> <span class="attr">table</span>=<span class="string">"user_p"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"userName"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Dept.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dept</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Integer id;</div><div class="line">    <span class="keyword">private</span> String deptName;</div><div class="line">    <span class="keyword">private</span> Set&lt;User&gt; users = <span class="keyword">new</span> HashSet&lt;&gt;();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Dept.hbm.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.domain2"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"Dept"</span> <span class="attr">table</span>=<span class="string">"dept_p"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"deptName"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"users"</span> <span class="attr">cascade</span>=<span class="string">"save-update"</span>&gt;</span></div><div class="line">              <span class="comment">&lt;!-- 多方user表中的部门id列名 --&gt;</span></div><div class="line">              <span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"deptid"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></div><div class="line">              <span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">"User"</span>&gt;</span><span class="tag">&lt;/<span class="name">one-to-many</span>&gt;</span></div><div class="line">          <span class="tag">&lt;/<span class="name">set</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></div></pre></td></tr></table></figure>
<p>测试</p>
<p>首先会插入部门表生成部门id数据，然后插入用户表。最后再根据用update更新关联关系字段。插入3条记录，生成的sql语句有5条。这其实是一种损耗性能的，正常情况下只需要3条语句就行了。后面会讲到通过配置inverse属性来解决此问题</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</div><div class="line">  Session session = HibernateUtils.openSession();</div><div class="line">  session.beginTransaction();</div><div class="line">  User user = <span class="keyword">new</span> User();</div><div class="line">  user.setUserName(<span class="string">"张三"</span>);</div><div class="line">  User user2 = <span class="keyword">new</span> User();</div><div class="line">  user2.setUserName(<span class="string">"李四"</span>);</div><div class="line">  Dept dept = <span class="keyword">new</span> Dept();</div><div class="line">  dept.setDeptName(<span class="string">"市场部"</span>);</div><div class="line">  dept.getUsers().add(user);</div><div class="line">  dept.getUsers().add(user2);</div><div class="line">  session.save(dept);</div><div class="line">  session.getTransaction().commit();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<img title="映射关系一对多01" alt="映射关系一对多01" src="http://oo0vldwkt.bkt.clouddn.com/static/images/java\hibernate\05映射关系一对多01.png">
<h3 id="一对多双向关联"><a href="#一对多双向关联" class="headerlink" title="一对多双向关联"></a>一对多双向关联</h3><p>双向关联与单向关联的区别是通过多方来加载一方，即多方中持有一方的引用。在用户和部门中表现为用户中持有部门的引用。所以只需要修改User类以及其配置文件。</p>
<p>User.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Integer id;</div><div class="line">    <span class="keyword">private</span> String userName;</div><div class="line">    <span class="keyword">private</span> Dept dept;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>User.hbm.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.domain2"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"User"</span> <span class="attr">table</span>=<span class="string">"user_p"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"userName"</span>/&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">many-to-one</span> <span class="attr">name</span>=<span class="string">"dept"</span> <span class="attr">class</span>=<span class="string">"Dept"</span> <span class="attr">column</span>=<span class="string">"deptid"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></div></pre></td></tr></table></figure>
<p>测试</p>
<p>与上面不同的是需要在user对象中添加入dept的引用，同样插入3条数据生成5条sql语句。</p>
<p>另外有一点不同的是在插入user数据时同时插入了deptid值，这是由于user中持有了dept引用</p>
<img title="映射关系一对多02" alt="映射关系一对多02" src="http://oo0vldwkt.bkt.clouddn.com/static/images/java\hibernate\05映射关系一对多02.png">
<h3 id="inverse控制反转"><a href="#inverse控制反转" class="headerlink" title="inverse控制反转"></a>inverse控制反转</h3><p>inverse英文即反转的意思。inverse属性表达的是是否反转外键的控制权，默认值是false，即不反转由本方维护。</p>
<p>看到上面双向一对多时明显生成了两条多余的update语句，为什么会生成5条sql呢？我们可以分析一下部门保存时都发生了啥</p>
<blockquote>
<p>1 保存部门，生成部门id主键。一条sql</p>
<p>2 由于设置了级联保存，继续插入user表数据，生成两条user表的insert。user对象中持有了dept，hibernate框架会在部门保存之后回写生成的id值。所以在user数据插入时是可以得到部门id的，这也是为什么在user表insert时有deptid列。两条sql</p>
<p>3 由于部门中默认的是维护外键关系的，所以在user表数据插入成功之后进行外键维护。维护的方式是根据2中得到的user表的主键和1中得到的dept表的主键进行更新。两条sql</p>
</blockquote>
<p>明显第3步是多余的，因为在第2步中deptid已经插入成功了。只要让部门放弃对于外键的维护更新语句就不再用了，所以需要将inverse属性设置为true。设置后再保存发现只有3条insert语句</p>
<p>Dept.hbm.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.domain2"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"Dept"</span> <span class="attr">table</span>=<span class="string">"dept_p"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"deptName"</span>/&gt;</span></div><div class="line">        </div><div class="line">        <span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"users"</span> <span class="attr">cascade</span>=<span class="string">"save-update"</span> <span class="attr">inverse</span>=<span class="string">"true"</span>&gt;</span></div><div class="line">            <span class="comment">&lt;!-- 多方user表中的部门id列名 --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"deptid"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">"User"</span>&gt;</span><span class="tag">&lt;/<span class="name">one-to-many</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></div></pre></td></tr></table></figure>
<img title="映射关系一对多03" alt="映射关系一对多03" src="http://oo0vldwkt.bkt.clouddn.com/static/images/java\hibernate\05映射关系一对多03.png">
<h3 id="cascade和inverse"><a href="#cascade和inverse" class="headerlink" title="cascade和inverse"></a>cascade和inverse</h3><p>可参考<a href="http://blog.csdn.net/hon_3y/article/details/71323215" target="_blank" rel="external">inverse、cascade属性详解</a></p>
<p>inverse的作用上面已经讲过，表示是否放弃外键的维护权。如果让一方维护外键会造成多余的update语句，所以一般一方都放弃维护，由多方维护外键。因为外键就在多的一方，所以让多方维护外键不会造成多生成sql的情况。</p>
<p>cascade表示级联操作，配置多个时可以用逗号隔开。有如下取值</p>
<ul>
<li>none                 – 不使用级联</li>
<li>save-update           – 级联保存或更新</li>
<li>delete               – 级联删除</li>
<li>delete-orphan             – 孤儿删除.(注意：只能应用在一对多关系可以将一的一方认为是父方.将多的一方认为是子方.孤儿删除:在解除了父子关系的时候.将子方记录就直接删除)</li>
<li>all                 – 除了delete-orphan的所有情况.（包含save-update delete）</li>
<li>all-delete-orphan          – 包含了除delete-orphan的所有情况.（包含save-update delete delete-orphan）</li>
</ul>
<p><strong>cascade和inverse是相互独立的，cascade不影响inverse</strong></p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://xxyxpy.pub/2017/08/14/java/hibernate/hibernate-05映射关系之一对多/" data-id="cjblta930003g0khq5729s78d" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-java/hibernate/hibernate-04映射关系之多对一" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/08/14/java/hibernate/hibernate-04映射关系之多对一/">hibernate-04映射关系之多对一</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/08/14/java/hibernate/hibernate-04映射关系之多对一/">
            <time datetime="2017-08-14T05:53:28.150Z" itemprop="datePublished">2017-08-14</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/java/">java</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/java/ssh/">ssh</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/java/ssh/hibernate/">hibernate</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/hiberante/">hiberante</a>, <a class="tag-link" href="/tags/java/">java</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h3 id="多对一单向关联"><a href="#多对一单向关联" class="headerlink" title="多对一单向关联"></a>多对一单向关联</h3><p>多对一关联使用的场景非常多，比如用户对部门、客户对订单、学生对班级等等。维护映射关系的思路是在多方添加维护关联关系的字段，比如在用户表中添加部门的id。</p>
<p>User.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Integer id;</div><div class="line">    <span class="keyword">private</span> String userName;</div><div class="line">    <span class="comment">// 用户与部门，多对一</span></div><div class="line">    <span class="keyword">private</span> Dept dept;</div><div class="line">  	...省略get,set</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>User.hbm.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.domain2"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"User"</span> <span class="attr">table</span>=<span class="string">"user_p"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"userName"</span>/&gt;</span></div><div class="line">        </div><div class="line">        <span class="tag">&lt;<span class="name">many-to-one</span> <span class="attr">name</span>=<span class="string">"dept"</span> <span class="attr">column</span>=<span class="string">"deptid"</span> <span class="attr">class</span>=<span class="string">"Dept"</span> <span class="attr">cascade</span>=<span class="string">"all"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Dept.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dept</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Integer id;</div><div class="line">    <span class="keyword">private</span> String deptName;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Dept.hbm.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.domain2"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"Dept"</span> <span class="attr">table</span>=<span class="string">"dept_p"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"deptName"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></div></pre></td></tr></table></figure>
<p>测试</p>
<p>首先会插入部门表生成部门id数据，然后插入用户表插入时用到了刚刚生成的部门id。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</div><div class="line">  Session session = HibernateUtils.openSession();</div><div class="line">  session.beginTransaction();</div><div class="line">  User user = <span class="keyword">new</span> User();</div><div class="line">  user.setUserName(<span class="string">"张三"</span>);</div><div class="line">  User user2 = <span class="keyword">new</span> User();</div><div class="line">  user2.setUserName(<span class="string">"李四"</span>);</div><div class="line">  Dept dept = <span class="keyword">new</span> Dept();</div><div class="line">  dept.setDeptName(<span class="string">"市场部"</span>);</div><div class="line">  user.setDept(dept);</div><div class="line">  user2.setDept(dept);</div><div class="line">  session.save(user);</div><div class="line">  session.save(user2);</div><div class="line">  session.getTransaction().commit();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<img title="映射关系多对一01" alt="映射关系多对一01" src="http://oo0vldwkt.bkt.clouddn.com/static/images/java\hibernate\04映射关系多对一01.png">

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://xxyxpy.pub/2017/08/14/java/hibernate/hibernate-04映射关系之多对一/" data-id="cjblta92x003b0khqeufavofq" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-java/hibernate/hibernate-03映射关系之一对一" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/08/09/java/hibernate/hibernate-03映射关系之一对一/">hibernate-03映射关系之一对一</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/08/09/java/hibernate/hibernate-03映射关系之一对一/">
            <time datetime="2017-08-09T09:24:25.278Z" itemprop="datePublished">2017-08-09</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/java/">java</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/java/ssh/">ssh</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/java/ssh/hibernate/">hibernate</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/hiberante/">hiberante</a>, <a class="tag-link" href="/tags/java/">java</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h3 id="映射关系分类"><a href="#映射关系分类" class="headerlink" title="映射关系分类"></a>映射关系分类</h3><p>Hibernate学习最主要的是要掌握映射关系的配置。映射关系一般分为一对一、一对多、多对一以及多对多，同时有些关系中还包含有单向关联和双向关联。</p>
<p>假定现在有用户、用户扩展信息、部门以及角色表。对应的关系有：</p>
<p>用户-用户扩展信息：一对一</p>
<p>用户-部门：多对一</p>
<p>部门-用户：一对多</p>
<p>用户-角色：多对多</p>
<h3 id="一对一单向关联（主键）"><a href="#一对一单向关联（主键）" class="headerlink" title="一对一单向关联（主键）"></a>一对一单向关联（主键）</h3><p>对于用户信息比较多的情况，需要将用户信息拆表存储。这样就可以保证查询主要信息时效率比较高。拆表存储后两个表的关系表现为一对一。两个表之间的关系可以使用外键（即扩展表中持有用户表的id），也可以使用同一个主键。</p>
<p>使用同一主键时可以是一个表先生成主键然后再用到另外一个表中，当然也可以都设置成assigned，自己先成uuid去设置为主键。</p>
<p>User.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Integer id;</div><div class="line">    <span class="keyword">private</span> String userName;</div><div class="line">    <span class="comment">// 用户与用户扩展信息，一对一</span></div><div class="line">    <span class="keyword">private</span> UserInfo userInfo;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> id;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.id = id;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> UserInfo <span class="title">getUserInfo</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> userInfo;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserInfo</span><span class="params">(UserInfo userInfo)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.userInfo = userInfo;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> userName;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserName</span><span class="params">(String userName)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.userName = userName;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>UserInfo.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Integer id;</div><div class="line">    <span class="keyword">private</span> String gender;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getGender</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> gender;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGender</span><span class="params">(String gender)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.gender = gender;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> id;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.id = id;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>User.hbm.xml，这里设置的user表的主键为foreign生成策略，forgeign会取得另外一个关联对象的标识</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version='1.0' encoding='UTF-8'?&gt;</div><div class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC</span></div><div class="line">        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</div><div class="line">        "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</div><div class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.domain2"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"User"</span> <span class="attr">table</span>=<span class="string">"user_p"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"foreign"</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"property"</span>&gt;</span>userInfo<span class="tag">&lt;/<span class="name">param</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">generator</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"userName"</span>/&gt;</span></div><div class="line">        <span class="comment">&lt;!-- 一对一 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">one-to-one</span> <span class="attr">name</span>=<span class="string">"userInfo"</span> <span class="attr">class</span>=<span class="string">"UserInfo"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></div></pre></td></tr></table></figure>
<p>UserInfo.hbm.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version='1.0' encoding='UTF-8'?&gt;</div><div class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC</span></div><div class="line">        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</div><div class="line">        "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</div><div class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.domain2"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"UserInfo"</span> <span class="attr">table</span>=<span class="string">"userinfo_p"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"gender"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></div></pre></td></tr></table></figure>
<p>测试一下保存用户</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</div><div class="line">  Session session = HibernateUtils.openSession();</div><div class="line">  session.beginTransaction();</div><div class="line">  User user = <span class="keyword">new</span> User();</div><div class="line">  user.setUserName(<span class="string">"张三"</span>);</div><div class="line">  UserInfo userInfo = <span class="keyword">new</span> UserInfo();</div><div class="line">  userInfo.setGender(<span class="string">"男"</span>);</div><div class="line">  user.setUserInfo(userInfo);</div><div class="line">  session.save(user);</div><div class="line">  session.getTransaction().commit();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>结果</p>
<img title="映射关系01" alt="映射关系01" src="http://oo0vldwkt.bkt.clouddn.com/static/images/java\hibernate\03映射关系01.png">
<img title="映射关系02" alt="映射关系02" src="http://oo0vldwkt.bkt.clouddn.com/static/images/java\hibernate\03映射关系02.png">
<hr>
<h3 id="一对一双向关联（主键）"><a href="#一对一双向关联（主键）" class="headerlink" title="一对一双向关联（主键）"></a>一对一双向关联（主键）</h3><p>单向关联由User找到UserInfo，双向关联指的是互相持有。由UserInfo也能找到User。通过主键关联时两个关联方还是保持相同的主键值。</p>
<p>User相关的类及配置文件不变，UserInfo的类及配置文件变化如下：</p>
<p>UserInfo.java添加User属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Integer id;</div><div class="line">    <span class="keyword">private</span> String gender;</div><div class="line">    <span class="keyword">private</span> User user;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getGender</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> gender;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGender</span><span class="params">(String gender)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.gender = gender;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> id;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.id = id;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> user;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(User user)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.user = user;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>UserInfo.hbm.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version='1.0' encoding='UTF-8'?&gt;</div><div class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC</span></div><div class="line">        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</div><div class="line">        "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</div><div class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.domain2"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"UserInfo"</span> <span class="attr">table</span>=<span class="string">"userinfo_p"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"gender"</span>/&gt;</span></div><div class="line">        <span class="comment">&lt;!-- 一对一双向 --&gt;</span></div><div class="line">        <span class="comment">&lt;!--cascade="all" 必须添加，表示级联--&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">one-to-one</span> <span class="attr">name</span>=<span class="string">"userInfo"</span> <span class="attr">class</span>=<span class="string">"UserInfo"</span> <span class="attr">cascade</span>=<span class="string">"all"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></div></pre></td></tr></table></figure>
<p>测试：保存方式和上面的单向关联相同。这里测试下先查询UserInfo，然后根据UserInfo显示User中的UserName</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 一对一双向关联</div><div class="line"> */</div><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> </span>&#123;</div><div class="line">  Session session = HibernateUtils.openSession();</div><div class="line">  UserInfo userInfo = session.get(UserInfo.class, <span class="number">11</span>);</div><div class="line">  System.out.println(userInfo.getUser().getUserName());</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>查询结果中可以发现查询语句是一个join查询，根据id查询出了两张表中的数据。结果如下：</p>
<img title="映射关系03" alt="映射关系03" src="http://oo0vldwkt.bkt.clouddn.com/static/images/java\hibernate\03映射关系03.png">
<hr>
<h3 id="一对一单向关联（外键）"><a href="#一对一单向关联（外键）" class="headerlink" title="一对一单向关联（外键）"></a>一对一单向关联（外键）</h3><p>上面的关联方式两者用的相同的主键维护。还可以通过外键进行维护，比如在User表添加一列持有UserInfo的主键，然后将这一列设置为不可重复（unique）。</p>
<p>User.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Integer id;</div><div class="line">    <span class="keyword">private</span> String userName;</div><div class="line">    <span class="comment">// 用户与用户扩展信息，一对一</span></div><div class="line">    <span class="keyword">private</span> UserInfo userInfo;</div><div class="line">    省略get，set方法</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>UserInfo.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Integer id;</div><div class="line">    <span class="keyword">private</span> String gender;</div><div class="line">    省略get，set方法</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>User.hbm.xml，cascade=”all” 必须添加，表示级联</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.domain2"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"User"</span> <span class="attr">table</span>=<span class="string">"user_p"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"userName"</span>/&gt;</span></div><div class="line">        </div><div class="line">        <span class="tag">&lt;<span class="name">many-to-one</span> <span class="attr">name</span>=<span class="string">"userInfo"</span> <span class="attr">column</span>=<span class="string">"userInfoId"</span> <span class="attr">unique</span>=<span class="string">"true"</span> <span class="attr">cascade</span>=<span class="string">"all"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></div></pre></td></tr></table></figure>
<p>UserInfo.hbm.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.domain2"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"UserInfo"</span> <span class="attr">table</span>=<span class="string">"userinfo_p"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"gender"</span>/&gt;</span></div><div class="line">        </div><div class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></div></pre></td></tr></table></figure>
<p>测试：保存User时自动保存UserInfo</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">* 一对一单向关联，外建</div><div class="line">*/</div><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span> </span>&#123;</div><div class="line">  Session session = HibernateUtils.openSession();</div><div class="line">  session.beginTransaction();</div><div class="line">  User user = <span class="keyword">new</span> User();</div><div class="line">  user.setUserName(<span class="string">"张三"</span>);</div><div class="line">  UserInfo userInfo = <span class="keyword">new</span> UserInfo();</div><div class="line">  userInfo.setGender(<span class="string">"男"</span>);</div><div class="line">  user.setUserInfo(userInfo);</div><div class="line">  session.save(user);</div><div class="line">  session.getTransaction().commit();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>结果：可以看到User表中添加了一列存储UserInfo表中的主键，而且生成了唯一索引和外键</p>
<img title="映射关系04" alt="映射关系04" src="http://oo0vldwkt.bkt.clouddn.com/static/images/java\hibernate\03映射关系04.png">
<hr>
<h3 id="一对一双向关联（外键）"><a href="#一对一双向关联（外键）" class="headerlink" title="一对一双向关联（外键）"></a>一对一双向关联（外键）</h3><p>这个和上面讲到的单向关联唯一的区别就是在UserInfo中也持有User。User相关的类及配置不变，只需要修改UserInfo即可</p>
<p>UserInfo.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Integer id;</div><div class="line">    <span class="keyword">private</span> String gender;</div><div class="line">    <span class="keyword">private</span> User user;</div><div class="line">    省略get，set方法</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>UserInfo.hbm.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.domain2"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"UserInfo"</span> <span class="attr">table</span>=<span class="string">"userinfo_p"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"gender"</span>/&gt;</span></div><div class="line">        </div><div class="line">        <span class="comment">&lt;!-- property-ref属性为关系字段的名称 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">one-to-one</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">class</span>=<span class="string">"User"</span> <span class="attr">property-ref</span>=<span class="string">"userInfo"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></div></pre></td></tr></table></figure>
<p>测试：保存时还和单向关联一样，只不过是在查询时可以通过只查询UserInfo得到User</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">* 一对一双向关联，外建</div><div class="line">*/</div><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span> </span>&#123;</div><div class="line">  Session session = HibernateUtils.openSession();</div><div class="line">  session.beginTransaction();</div><div class="line">  User user = <span class="keyword">new</span> User();</div><div class="line">  user.setUserName(<span class="string">"张三"</span>);</div><div class="line">  UserInfo userInfo = <span class="keyword">new</span> UserInfo();</div><div class="line">  userInfo.setGender(<span class="string">"男"</span>);</div><div class="line">  user.setUserInfo(userInfo);</div><div class="line">  session.save(user);</div><div class="line">  session.getTransaction().commit();</div><div class="line">&#125;</div></pre></td></tr></table></figure>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://xxyxpy.pub/2017/08/09/java/hibernate/hibernate-03映射关系之一对一/" data-id="cjblta92v00390khq2s5cvs8m" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-java/hibernate/hibernate-02缓存和事务" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/08/08/java/hibernate/hibernate-02缓存和事务/">hibernate-02缓存和事务</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/08/08/java/hibernate/hibernate-02缓存和事务/">
            <time datetime="2017-08-08T08:38:11.264Z" itemprop="datePublished">2017-08-08</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/java/">java</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/java/ssh/">ssh</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/java/ssh/hibernate/">hibernate</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/hiberante/">hiberante</a>, <a class="tag-link" href="/tags/java/">java</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h3 id="持久化对象的状态"><a href="#持久化对象的状态" class="headerlink" title="持久化对象的状态"></a>持久化对象的状态</h3><p>当java类与数据库中的某个表建立了映射关系时，这个类就称为持久化类。所以持久化类=java类+hbm配置文件。</p>
<p>Hibernate为了管理持久化类的状态，将持久化类分为三种状态：</p>
<ul>
<li><p>瞬时态（Transient Object）：没有持久化标识OID（主键），没有被纳入到Session对象的管理</p>
<p>获得瞬时态对象<code>User user = new User();</code></p>
<p>瞬时态对象转换为持久态，调用<code>Session</code>的<code>save</code>或<code>saveOrUpdate</code>方法</p>
<p>瞬时态对象转换为脱管态，为此对象设置OID<code>user.setId(1);</code></p>
</li>
<li><p>持久态（Persistent Object）：有持久化标识OID，已被纳入到Session对象的管理。<strong>具有自动更新数据库的能力</strong></p>
<p>获得持久态对象，调用<code>Session</code>的<code>get</code>或<code>load</code>方法</p>
<p>持久态转换成瞬时态，调用<code>Session</code>的<code>delete</code>方法。相当于把这条记录干没了</p>
<p>持久态转换成脱管态，调用<code>Session</code>的<code>close、evict、clear</code>方法</p>
</li>
<li><p>脱管态（Detached Object）：有持久化标识OID，没有被纳入到Session对象的管理</p>
<p>获得脱管态对象<code>User user = new User();user.setId(1);</code></p>
<p>脱管态转换成持久态，调用<code>Session</code>的<code>save</code>或<code>saveOrUpdate</code>或<code>lock</code>方法</p>
<p>脱管态转换成瞬时态<code>user.setId(null);</code></p>
</li>
</ul>
<p>Person类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> String pid;</div><div class="line">    <span class="keyword">private</span> String pname;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPid</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> pid;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPid</span><span class="params">(String pid)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.pid = pid;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPname</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> pname;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPname</span><span class="params">(String pname)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.pname = pname;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Person.hbm.xml映射文件，由于hibernate.cfg.xml中配置的<code>&lt;property name=&quot;hibernate.hbm2ddl.auto&quot;&gt;update&lt;/property&gt;</code>所以可以自动生成数据库表结构。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8" ?&gt;</div><div class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC</span></div><div class="line">        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</div><div class="line">        "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</div><div class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"com.domain.Person"</span> <span class="attr">table</span>=<span class="string">"t_person"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"pid"</span> <span class="attr">column</span>=<span class="string">"pid"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"uuid"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"pname"</span> <span class="attr">column</span>=<span class="string">"pname"</span> <span class="attr">length</span>=<span class="string">"30"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Junit测试方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run2</span><span class="params">()</span></span>&#123;</div><div class="line">  Session session = HibernateUtils.openSession();</div><div class="line">  Transaction transaction = session.beginTransaction();</div><div class="line">  Person p = <span class="keyword">new</span> Person();</div><div class="line">  <span class="comment">//瞬时态</span></div><div class="line">  p.setPname(<span class="string">"pppp"</span>);</div><div class="line">  <span class="comment">//持久态,保存之后即有了主键值</span></div><div class="line">  session.save(p);</div><div class="line">  transaction.commit();</div><div class="line">  session.close();</div><div class="line">  System.out.println(p.getPid());</div><div class="line">  <span class="comment">//脱管态session关闭</span></div><div class="line">  p.setPname(<span class="string">"ccc"</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 自动更新数据的能力,使用的是快照机制</div><div class="line"> */</div><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run3</span><span class="params">()</span></span>&#123;</div><div class="line">  Session session = HibernateUtils.openSession();</div><div class="line">  Transaction transaction = session.beginTransaction();</div><div class="line">  User3 user3 = session.get(User3.class, <span class="number">1</span>);</div><div class="line">  user3.setName(<span class="string">"哈哈"</span>);</div><div class="line">  <span class="comment">//无需调用session.update(user3)即可完成更新</span></div><div class="line">  transaction.commit();</div><div class="line">  session.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h3><p>缓存其实就是一块连续的内存空间，用于存储数据。再次使用时从内存中读取，提高程序的性能。</p>
<p><strong>Hibernate框架提供的两种缓存</strong></p>
<ul>
<li>一级缓存：自带的不可卸载的。生命周期和Session一致，称为Session级别的缓存</li>
<li>二级缓存：默认关闭，需要手动配置才可以使用。二级缓存可以在多个Session中共享数据，称为SessionFactory级别的缓存。</li>
</ul>
<h4 id="Session对象的缓存"><a href="#Session对象的缓存" class="headerlink" title="Session对象的缓存"></a>Session对象的缓存</h4><p>在Session接口中有一系列的java集合，这些集合构成了Session级别的缓存，将对象存放到一级缓存中只要session没有结束生命周期那么对象在Session中就一直放着。</p>
<p>证明一缓存的存在。思路：两次查询同一行数据，<strong>只有一条sql语句</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">  * 证明session中的一级缓存存在</div><div class="line">  * 使用两次查询同一个id,会发现只执行一次sql</div><div class="line">  */</div><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run44</span><span class="params">()</span></span>&#123;</div><div class="line">  Session session = HibernateUtils.openSession();</div><div class="line">  Person p = session.get(Person.class, <span class="string">"8ae5bae15dc1246f015dc124714e0000"</span>);</div><div class="line">  System.out.println(p.getPname());</div><div class="line">  Person pp = session.get(Person.class, <span class="string">"8ae5bae15dc1246f015dc124714e0000"</span>);</div><div class="line">  System.out.println(pp.getPname());</div><div class="line">  session.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>结果：</p>
<img title="缓存和事务_01" alt="缓存和事务_01" src="http://oo0vldwkt.bkt.clouddn.com/static/images/java\hibernate\02缓存和事务_01.png">
<p>缓存的手动控制</p>
<ul>
<li>Session.clear()，清空缓存</li>
<li>Session.evict(Object entity)，从一级缓存中清除指定的实体对象</li>
<li>Session.flush()，刷出缓存</li>
</ul>
<h3 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h3><p>关于事务的详细说明可以<a href="http://xxyxpy.pub/2017/08/01/java/web/web-05%E4%BA%8B%E5%8A%A1/">查看</a></p>
<h4 id="丢失更新问题"><a href="#丢失更新问题" class="headerlink" title="丢失更新问题"></a>丢失更新问题</h4><h5 id="什么是丢失更新？"><a href="#什么是丢失更新？" class="headerlink" title="什么是丢失更新？"></a>什么是丢失更新？</h5><p>如果不考虑隔离性，会产生写入数据丢失的问题。这一类问题就是丢失更新</p>
<p>例如：两个事务同时操作一条记录，A事务修改完成提交，B事务无论是否提供都会使A事务的操作丢失</p>
<h5 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h5><ul>
<li><p>悲观锁。数据库的一种锁机制，在当前操作的sql语句后面添加<code>for update</code>，当A事务进行操作时，其他事务不能操作。只有当A事务提交或回滚释放后其他事务才可以操作。</p>
<p>Hibernate中使用悲观锁<code>session.get(Customer.class, 1,LockMode.UPGRADE);</code></p>
</li>
<li><p>乐观锁。采用版本号的机制来解决。给表添加一个字段<code>version</code>，默认值是0。当A事务操作完该记录时会检查版本号，如果和当前的不同不提交事务，只有相同时才提交事务。并且把版本号+1。</p>
<p>Hibernate中使用乐观锁要先在JavaBean中添加一个属性如<code>Integer version</code>，然后再在实体的配置文件中添加</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--乐观锁--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">version</span> <span class="attr">name</span>=<span class="string">"version"</span>/&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="绑定本地Session"><a href="#绑定本地Session" class="headerlink" title="绑定本地Session"></a>绑定本地Session</h4><p>在之前的<a href="http://xxyxpy.pub/2017/08/01/java/web/web-05%E4%BA%8B%E5%8A%A1/">web事务</a>中讲到了在service中开启事务，将Connection绑定到ThreadLocal对象中以保证事务的一致性。在Hibernate框架中使用Session来开启事务，所以需要传递Session对象，同样的也是通过绑定到ThreadLocal来实现。</p>
<p>想实现自动绑定功能需要在hibernate.cfg.xml中添加如下内容：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--开启绑定本地session--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.current_session_context_class"</span>&gt;</span>thread<span class="tag">&lt;/<span class="name">property</span>&gt;</span></div></pre></td></tr></table></figure>
<p>假设现在在service层执行两步操作，保存两个客户。考虑这个操作是一个事务，要么同时成功，要么同时失败。这里使用的工具类即为上一篇的HibernateUtils类，只是为说明问题，customer和user类就不贴了。伪代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Customer c1, Customer c2)</span> </span>&#123;</div><div class="line">  Session currentSession = HibernateUtils.getCurrentSession();</div><div class="line">  Transaction tr = currentSession.beginTransaction();</div><div class="line">  CustomerDao dao = <span class="keyword">new</span> CustomerDao();</div><div class="line">  <span class="keyword">try</span> &#123;</div><div class="line">    dao.save1(c1);</div><div class="line">    <span class="keyword">int</span> res = <span class="number">10</span> / <span class="number">0</span>;</div><div class="line">    dao.save2(c2);</div><div class="line">    tr.commit();</div><div class="line">  &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">    e.printStackTrace();</div><div class="line">    tr.rollback();</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://xxyxpy.pub/2017/08/08/java/hibernate/hibernate-02缓存和事务/" data-id="cjblta92s00360khqho2e9sco" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <nav id="page-nav">
        <a class="extend prev" rel="prev" href="/page/2/">&laquo; 上一页</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/4/">下一页 &raquo;</a>
    </nav>


<style>
	.widget-title {
	        font-size: 1.3em;
	        font-weight: 700;
	    }
</style></section>
            
                
<aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">最新文章</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/12/25/linux/vps相关/" class="thumbnail">
    
    
        <span style="background-image:url(http://swiftlet.net/wp-content/uploads/2017/04/20170416204714_50373.jpg)" alt="vps相关" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/linux/">linux</a></p>
                            <p class="item-title"><a href="/2017/12/25/linux/vps相关/" class="title">vps相关</a></p>
                            <p class="item-date"><time datetime="2017-12-25T05:31:12.282Z" itemprop="datePublished">2017-12-25</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/12/21/linux/linux/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/linux/">linux</a></p>
                            <p class="item-title"><a href="/2017/12/21/linux/linux/" class="title">linux</a></p>
                            <p class="item-date"><time datetime="2017-12-21T01:22:22.788Z" itemprop="datePublished">2017-12-21</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/12/20/linux/docker/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/linux/">linux</a></p>
                            <p class="item-title"><a href="/2017/12/20/linux/docker/" class="title">docker</a></p>
                            <p class="item-date"><time datetime="2017-12-20T01:59:03.718Z" itemprop="datePublished">2017-12-20</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/12/15/java/tool/java_other/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/java/">java</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/java/tool/">tool</a></p>
                            <p class="item-title"><a href="/2017/12/15/java/tool/java_other/" class="title">java_other</a></p>
                            <p class="item-date"><time datetime="2017-12-15T10:14:54.963Z" itemprop="datePublished">2017-12-15</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/11/28/java/spring/spring boot点滴/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/spring/">spring</a></p>
                            <p class="item-title"><a href="/2017/11/28/java/spring/spring boot点滴/" class="title">spring boot点滴</a></p>
                            <p class="item-date"><time datetime="2017-11-28T09:24:59.869Z" itemprop="datePublished">2017-11-28</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">标签云</h3>
        <div class="widget tagcloud">
            <a href="/tags/Intellij/" style="font-size: 10px;">Intellij</a> <a href="/tags/activemq/" style="font-size: 10px;">activemq</a> <a href="/tags/annotaion/" style="font-size: 10px;">annotaion</a> <a href="/tags/ashx/" style="font-size: 10px;">ashx</a> <a href="/tags/cookie/" style="font-size: 10px;">cookie</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/el/" style="font-size: 10px;">el</a> <a href="/tags/filter/" style="font-size: 10px;">filter</a> <a href="/tags/hexo/" style="font-size: 12px;">hexo</a> <a href="/tags/hiberante/" style="font-size: 18px;">hiberante</a> <a href="/tags/io/" style="font-size: 10px;">io</a> <a href="/tags/java/" style="font-size: 20px;">java</a> <a href="/tags/jdbc/" style="font-size: 14px;">jdbc</a> <a href="/tags/jdk/" style="font-size: 10px;">jdk</a> <a href="/tags/jsp/" style="font-size: 10px;">jsp</a> <a href="/tags/jstl/" style="font-size: 10px;">jstl</a> <a href="/tags/linux/" style="font-size: 16px;">linux</a> <a href="/tags/listener/" style="font-size: 10px;">listener</a> <a href="/tags/mail/" style="font-size: 10px;">mail</a> <a href="/tags/mongodb/" style="font-size: 10px;">mongodb</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/nexT/" style="font-size: 10px;">nexT</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/rabbitmq/" style="font-size: 10px;">rabbitmq</a> <a href="/tags/redis/" style="font-size: 10px;">redis</a> <a href="/tags/request/" style="font-size: 10px;">request</a> <a href="/tags/response/" style="font-size: 10px;">response</a> <a href="/tags/session/" style="font-size: 10px;">session</a> <a href="/tags/solr/" style="font-size: 10px;">solr</a> <a href="/tags/spring/" style="font-size: 14px;">spring</a> <a href="/tags/spring-boot/" style="font-size: 10px;">spring boot</a> <a href="/tags/sqlserver/" style="font-size: 10px;">sqlserver</a> <a href="/tags/struts2/" style="font-size: 14px;">struts2</a> <a href="/tags/vps/" style="font-size: 10px;">vps</a> <a href="/tags/web/" style="font-size: 16px;">web</a> <a href="/tags/事务/" style="font-size: 10px;">事务</a> <a href="/tags/回文数/" style="font-size: 10px;">回文数</a> <a href="/tags/套路/" style="font-size: 12px;">套路</a> <a href="/tags/泛型/" style="font-size: 10px;">泛型</a> <a href="/tags/激活码/" style="font-size: 10px;">激活码</a>
        </div>
    </div>

    
        
    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">专题内容</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://hexo.io">Hexo</a>
                    </li>
                
            </ul>
        </div>
    </div>



    <div class="widget-wrap widget-list">
        <h3 class="widget-title">链接</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://hexo.io">Hexo</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>

            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2017 xxyxpy<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
        </div>
    </div>
</footer>
        


    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>